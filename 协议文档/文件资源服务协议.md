# 文件资源服务协议

## 基本信息

端口号：14003
内容范围：文件资源的上传与获取

## 协议内容

### 获取外网POST上传信息

```http
[POST]/file_resource/post/file
```
说明：
1. 获取外网POST上传信息

#### 修改更新记录

| 对应版本     | 说明            |
| -------- | ------------- |
| V1.3.3.1 | 获取外网POST上传信息传 |

#### 请求报文参数

#### RequestBoyd

| 参数名           | 类型      | 必填   | 说明                                       |
| ------------- | ------- | ---- | ---------------------------------------- |
| fileName      | String  | 是    | 文件上传名，可包含路径                              |
| fileType      | String  | 是    | 文件类型，Content-Type                        |
| fileSize      | Long    | 是    | 文件内容长度                                   |
| fileSignature | String  | 是    | 文件的签名值MD5,Base64编码                       |
| userId        | Long    | 是    | 是哪一个用户上传的文件                              |
| workId        | Long    | 是    | 工作站ID，用户在哪个工作站中上传的                       |
| tenantId      | Long    | 是    | 租户id                                     |
| expires       | Long    | 是    | URL的有效期，UNIX时间（为空时默认30分钟）                |
| redirect      | String  | 是    | 成功后跳转的地址                                 |
| CreateTime    | Date    | 否    | 创建时间                                     |
| filePerm      | Integer | 是    | 是否公开，0:私有（获取资源时url具有时效性，且有权限的验证，在获取资源的时候会进行验证），1公开（表示任何地方、时间都可以根据url获取资源） |

#### 回复报文参数

| 参数名                     | 类型     | 必填   | 说明                       |
| ----------------------- | ------ | ---- | ------------------------ |
| url                     | String | 是    | 操作的URL                   |
| OSSAccessKeyId          | String | 是    | Bucket 拥有者的Access Key Id |
| policy                  | String | 是    | Base64编码的JSON内容          |
| Signature               | String | 是    | 签名                       |
| key                     | String | 是    | 上传文件路径                   |
| success_action_redirect | String | 是    | 文件上传成功后的跳转地址             |
| fileId                  | Long   | 是    | 文件ID                     |
| callback                | String | 是    | 回调地址                     |



### 获取内网PUT上传地址

```http
[PUT]/file_resource/upload/url
```
说明：
1. 获取内网PUT上传地址

#### 修改更新记录

| 对应版本     | 说明          |
| -------- | ----------- |
| V1.3.3.1 | 获取内网PUT上传地址 |

#### 请求报文参数

#### RequestBoyd

| 参数名           | 类型                  | 必填   | 说明                           |
| ------------- | ------------------- | ---- | ---------------------------- |
| fileId        | Long                | 是    | 文件ID                         |
| fileName      | String              | 是    | 文件上传名，可包含路径                  |
| fileType      | String              | 是    | 文件类型，Content-Type            |
| fileSize      | Long                | 是    | 文件内容长度                       |
| fileSignature | String              | 是    | 文件的签名值MD5,Base64编码           |
| userId        | Long                | 是    | 是哪一个用户上传的文件                  |
| workId        | Long                | 是    | 工作站ID，用户在哪个工作站中上传的           |
| tenantId      | Long                | 是    | 租户id                         |
| expires       | Long                | 是    | URL的有效期，UNIX时间（为空时默认30分钟）    |
| attachHeader  | Map<String, String> | 是    | 附加头信息，这文件被下载时如带的信息内容，支持内容如下表 |
| CreateTime    | Date                | 否    | 创建时间                         |
| publicRead    | Boolean             | 是    | 是否公开，false:私有，true公开:默认false |

#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明          |
| --------- | ------ | ---- | ----------- |
| uploadUrl | String | 是    | 上传地址（put请求） |
| fileId    | Long   | 是    | 文件资源唯一标识    |


### 获取外网下载地址

```http
[GET]/file_resource/download/url
```
说明：
1. 获取下载地址

#### 修改更新记录

| 对应版本     | 说明     |
| -------- | ------ |
| V1.3.3.1 | 获取下载地址 |
| V1.3.4.1 | 增加内容类型 |

#### 请求报文参数

#### RequestParam

| 参数名             | 类型      | 必填   | 说明                                   |
| --------------- | ------- | ---- | ------------------------------------ |
| file_id         | Long    | 是    | 文件ID                                 |
| tenant_id       | Long    | 是    | 租户号                                  |
| timeout_express | Integer | 否    | URL有效时间，单位秒，默认30分钟，publicread的资源本值无效 |

#### 回复报文参数

| 参数名          | 类型     | 必填   | 说明          |
| ------------ | ------ | ---- | ----------- |
| file_id      | Long   | 是    | 文件资源ID      |
| url          | String | 是    | 文件下载地址      |
| express_time | Long   | 是    | URL有效时间，单位秒 |
| content_type | String | 是    | 内容类型        |


### 获取内网下载地址

```http
[GET]/file_resource/download/internal/url
```
说明：
1. 获取内网下载地址

#### 修改更新记录

| 对应版本     | 说明       |
| -------- | -------- |
| V1.3.3.1 | 获取内网下载地址 |
| V1.3.4.1 | 增加内容类型   |

#### 请求报文参数

#### RequestParam

| 参数名             | 类型                 | 必填   | 说明                                   |
| --------------- | ------------------ | ---- | ------------------------------------ |
| file_id         | Long               | 是    | 文件ID                                 |
| attach_header   | Map<String,String> | 否    | 获取URL进行操作时返回的Header内容                |
| timeout_express | Long               | 否    | URL的有效期，UNIX时间（自UTC时间1970年1月1号开始的秒数） |

#### 回复报文参数

| 参数名          | 类型     | 必填   | 说明           |
| ------------ | ------ | ---- | ------------ |
| download_url | String | 是    | 下载文件资源的URL地址 |
| content_type | String | 是    | 内容类型         |

### 资源文件是否存在

```http
[GET]/file_resource/resource/exist
```
说明：
1. 资源文件是否存在

#### 修改更新记录

| 对应版本     | 说明       |
| -------- | -------- |
| V1.3.3.1 | 资源文件是否存在 |

#### 请求报文参数

#### RequestParam

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| file_id | Long | 是    | 文件ID |

#### 回复报文参数

| 参数名      | 类型      | 必填   | 说明       |
| -------- | ------- | ---- | -------- |
| is_exist | Boolean | 是    | 是否存在资源文件 |

