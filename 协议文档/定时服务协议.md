# 定时服务协议

## 基本信息

端口号：8017
RedisDB：15
包含后台计划的，偷偷摸摸要干的事件

## 开放协议

### 患者信息同步协议启动

```url
[POST]/schedule_service/patient/start
```

####修改更新记录

|  对应业务 | 说明 |
|-----------|------|
| V1.3.3 | 新增 |

#### 请求报文参数

| 参数名       | 类型      | 必填   | 说明             |
| --------- | ------- | ---- | -------------- |
| 无     |   |     |  |


#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明          |
| --------- | ---------- | ---- | ----------- |
| 无 |      |      |   |




##任务列表

### 患者服务同步ES补偿

####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增  |

相关表： 患者信息表(adm_patient)

根据患者信息表中的pati_es_sync获取未同步到ES中的患者信息，在每天的12点和24点进行同步一次。




###视光厂商有效期过期提醒

####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增  |

相关表： 商品厂商表(erp_goods_mfr)

根据厂商表的 证件有效期到期时间（mfr_remind_time），进行提醒，如产生则消息，则调用消息服务发送消息机制发送消息
对于每一项，提醒过，则不再提醒

发送对象：拥有厂商管理权限的所有员工
消息内容： 参考原型，询问产品经理


###角膜地形图文件分析


| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3.1 | 新增  |

相关表： 
角膜地形图文件上传表(check_cornea_topog_file)
角膜地形图报告表(check_cornea_topog)

步骤：
1.找到角膜地形图文件上传表(check_cornea_topog_file)中上传成功，且未处理的记录
2.从oss服务器中下载文件
3.分析文件，分析好的数据新增到 角膜地形图报告表(check_cornea_topog)


###复诊通知


| 对应版本 | 说明                      |
| -------- | ------------------------- |
| V1.3.6 | 根据emr_treatment表中随访具体时间来通知患者  |

对于有具体复诊时间的
发送复诊通知