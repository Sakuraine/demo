# 通知服务协议

## 基本信息

端口号：14005

## 协议内容

### 微信公众号验证

```url
[GET]/notify/wechat/check/accessToken
```

说明：
1. 通过appId和appSecret验证公众号的合法性。
2. 如果验证失败则返回对应错误的原因或者accessToken为null

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.3.2 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名    | 长度   | 类型     | 必填   | 说明         |
| ------ | ---- | ------ | ---- | ---------- |
| appId  |      | String | 是    | 微信公众号开发者ID |
| secret |      | String | 是    | 微信公众号开发者密码 |

#### 回复报文参数

| 参数名         | 类型     | 必填   | 说明          |
| ----------- | ------ | ---- | ----------- |
| accessToken | String | 是    | 微信公众号的token |


### 获取微信公众号模板

```url
[GET]/notify/wechat/check/template
```

说明：
1. 获取微信公众号消息模板

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.3.2 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 长度   | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- | ---- |
| tenantId |      | Long | 是    | 租户ID |

#### 回复报文参数

| 参数名          | 类型         | 必填   | 说明          |
| ------------ | ---------- | ---- | ----------- |
| templateList | ObjectList | 是    | 微信公众号消息模板列表 |

微信公众号消息模板列表

| 参数名             | 类型     | 必填   | 说明          |
| --------------- | ------ | ---- | ----------- |
| templateId      | String | 是    | 微信模板ID      |
| title           | String | 是    | 模板标题        |
| primaryIndustry | String | 是    | 模板所属行业的一级行业 |
| deputyIndustry  | String | 是    | 模板所属行业的二级行业 |
| content         | String | 是    | 模板内容        |
| example         | String | 是    | 模板实例        |



### 短信签名的申请

```url
[POST]/notify/sms/sign/apply
```

说明：
1. 短信签名的申请
2. 短信签名的规则一.不能包含【】； **二**.不能是“云片网”；**三**. 3-8个字；四.不能是纯英文和数字
3. 一个租户只允许有一个签名，如果新申请签名，旧签名失效


#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| sms_name  | String | 是    | 签名内容 |
| sms_phone | String | 是    | 通知手机 |

#### 回复报文参数

| 参数名         | 类型      | 必填   | 说明                     |
| ----------- | ------- | ---- | ---------------------- |
| sign_id     | Long    | 是    | 签名id                   |
| apply_state | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败 |

### 签名的获取

```url
[GET]/notify/sms/sign/info
```

说明：
1. 签名的获取

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |



#### 回复报文参数

| 参数名          | 类型      | 必填   | 说明                     |
| ------------ | ------- | ---- | ---------------------- |
| sign         | String  | 是    | 签名内容                   |
| success_sign | String  | 否    | 如果当前的签名是审核中，则返回之前成功的签名 |
| apply_status | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败 |
| reason       | String  | 否    | 审核结果解释,错误时的解释          |


### 签名的获取(用于定时任务签名的校验)

```url
[GET]/notify/sms/sign/check
```

说明：
1. 签名的获取

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |



#### 回复报文参数

| 参数名          | 类型      | 必填   | 说明                     |
| ------------ | ------- | ---- | ---------------------- |
| sign         | String  | 是    | 签名内容                   |
| apply_status | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败 |
| reason       | String  | 否    | 审核结果解释,错误时的解释          |

### 模板的申请

```url
[POST]/notify/sms/template/apply
```

说明：
1. 模板的申请
2. 模板内容需要带签名,如【盼盼世界】

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody

| 参数名          | 类型      | 必填   | 说明                                  |
| ------------ | ------- | ---- | ----------------------------------- |
| sign_id      | Long    | 是    | 签名id                                |
| smst_content | String  | 是    | 模板内容                                |
| smst_tpltype | Integer | 是    | 模板类型，1-验证码类，2-通知类                   |
| smst_biztype | Integer | 是    | 模板业务类型，见数据库文档表notify_sms_template注3 |

#### 回复报文参数

| 参数名         | 类型      | 必填   | 说明                     |
| ----------- | ------- | ---- | ---------------------- |
| smst_id     | Long    | 是    | 模板id                   |
| smst_tpl_id | Long    | 否    | 云片上的模板id               |
| apply_state | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败 |


### 模板的获取

```url
[GET]/notify/sms/template/list
```

说明：
1. 模板的申请

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestParam

| 参数名      | 类型   | 必填   | 说明                       |
| -------- | ---- | ---- | ------------------------ |
| tenantId | Long | 否    | 租户ID，为0取默认模板，否则获取对应的模板数据 |


#### 回复报文参数

| 参数名           | 类型         | 必填   | 说明   |
| ------------- | ---------- | ---- | ---- |
| template_list | ObjectList | 是    | 模板列表 |

#### 模板列表
| 参数名          | 类型      | 必填   | 说明                                  |
| ------------ | ------- | ---- | ----------------------------------- |
| smst_id      | Long    | 是    | 模板id                                |
| smst_tpl_id  | Long    | 否    | 云片上的模板id                            |
| smst_content | String  | 是    | 模板内容                                |
| smst_tpltype | Integer | 是    | 模板类型                                |
| smst_biztype | Integer | 是    | 模板业务类型，见数据库文档表notify_sms_template注3 |
| apply_status | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败              |
| reason       | String  | 否    | 审核结果解释                              |


### 根据模板id的获取模板

```url
[GET]/notify/sms/template/{temp_id}
```

说明：
1. 根据模板id的获取模板

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 否    | 租户ID |

#### PathVariable

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| temp_id | Long | 是    | 模板Id |



#### 回复报文参数

| 参数名         | 类型      | 必填   | 说明                     |
| ----------- | ------- | ---- | ---------------------- |
| smst_id     | Long    | 是    | 模板id                   |
| smst_tpl_id | Long    | 否    | 云片上的模板id               |
| apply_state | Integer | 是    | 当前审核状态;0-申请中，1-成功，2-失败 |



### 发送签名申请成功或失败的短信接口

```url
[POST]/notify/sms/sign/message
```

说明：
1. 发送签名申请成功或失败的短信接口

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| sign_id | Long | 是    | 签名id |

#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |



### 添加超级管理员消息

```url
[POST]/notify/sms/send/tenant/init
```

说明：
1. 添加超级管理员消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型     | 必填   | 说明        |
| ----------- | ------ | ---- | --------- |
| phone       | String | 是    | 超级管理员手机号码 |
| name        | String | 是    | 超级管理员姓名   |
| tenant_name | String | 是    | 租户名称      |
| password    | String | 是    | 初始化密码     |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |


### 添加普通管理员消息

```url
[POST]/notify/sms/send/admin/add
```

说明：
1. 添加普通管理员消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型     | 必填   | 说明      |
| ----------- | ------ | ---- | ------- |
| phone       | String | 是    | 管理员手机号码 |
| name        | String | 是    | 管理员姓名   |
| tenant_name | String | 是    | 租户名称    |
| password    | String | 是    | 管理员密码   |
| super_admin | String | 是    | 超级管理员姓名 |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 添加用户消息

```url
[POST]/notify/sms/send/user/add
```

说明：
1. 添加用户消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型     | 必填   | 说明       |
| ----------- | ------ | ---- | -------- |
| phone       | String | 是    | 接收方的手机号码 |
| name        | String | 是    | 管理员姓名    |
| tenant_name | String | 是    | 租户名称     |
| password    | String | 是    | 密码       |
| admin_name  | String | 是    | 管理员姓名    |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 用户注册通过审核发送消息

```url
[POST]/notify/sms/send/user/register
```

说明：
1. 用户注册通过审核发送消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型     | 必填   | 说明       |
| ----------- | ------ | ---- | -------- |
| phone       | String | 是    | 接收方的手机号码 |
| name        | String | 是    | 管理员姓名    |
| tenant_name | String | 是    | 租户名称     |
| admin_name  | String | 是    | 管理员姓名    |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 发送验证码

```url
[POST]/notify/sms/send/auth/code
```

说明：
1. 发送验证码

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名       | 类型      | 必填   | 说明       |
| --------- | ------- | ---- | -------- |
| phone     | String  | 是    | 接收方的手机号码 |
| auth_code | String  | 是    | 验证码      |
| period    | Integer | 是    | 单位分钟     |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 排队提醒消息

```url
[POST]/notify/sms/send/queue/remind
```

说明：
1. 排队提醒消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型      | 必填   | 说明       |
| ----------- | ------- | ---- | -------- |
| phone       | String  | 是    | 接收方的手机号码 |
| name        | String  | 是    | 预约人姓名    |
| tenant_name | String  | 是    | 租户名称     |
| dept_name   | String  | 是    | 科室名称     |
| doctor_name | String  | 是    | 医生名字     |
| current_no  | String  | 是    | 当前就诊序号   |
| source_no   | String  | 是    | 预约的就诊号   |
| wait_size   | Integer | 是    | 前面的候诊人数  |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 停诊消息

```url
[POST]/notify/sms/send/treament/close
```

说明：
1. 停诊消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型        | 必填   | 说明                  |
| ----------- | --------- | ---- | ------------------- |
| phone       | String    | 是    | 接收方的手机号码            |
| name        | String    | 是    | 预约人姓名               |
| tenant_name | String    | 是    | 租户名称                |
| dept_name   | String    | 是    | 科室名称                |
| doctor_name | String    | 是    | 医生名字                |
| close_date  | LocalDate | 是    | 停诊日期                |
| source_no   | String    | 是    | 预约的就诊号              |
| m_ora       | Integer   | 是    | 上下午标志0-全天，1-上午，2-下午 |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 排班提醒消息

```url
[POST]/notify/sms/send/schedule/remind
```

说明：
1. 排班提醒消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名         | 类型     | 必填   | 说明       |
| ----------- | ------ | ---- | -------- |
| phone       | String | 是    | 接收方的手机号码 |
| name        | String | 是    | 排班人员姓名   |
| tenant_name | String | 是    | 租户名称     |
| week        | String | 是    | 手动排班的周数  |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |


### 复诊消息提醒

```url
[POST]/notify/sms/send/review/remind
```

说明：
1. 排班提醒消息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.5.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名   | 类型     | 必填   | 说明       |
| ----- | ------ | ---- | -------- |
| phone | String | 是    | 接收方的手机号码 |
| name  | String | 是    | 复诊人姓名    |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| message_id | String | 是    | 发送的消息ID |

### 获取微信公众号jsapiSinature信息

```url
[POST]/notify/wechat/jsapi/signature
```

说明：
1. 获取微信公众号jsapiSinature信息

#### 修改更新记录

| 对应业务        | 说明   |
| ----------- | ---- |
| WEBV1.3.6.1 | 新增   |

#### 请求报文参数

#### RequestHeader

| 参数名      | 类型   | 必填   | 说明   |
| -------- | ---- | ---- | ---- |
| tenantId | Long | 是    | 租户ID |

#### RequestBody
| 参数名  | 类型     | 必填   | 说明       |
| ---- | ------ | ---- | -------- |
| url  | String | 是    | 当前页面的url |

#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明       |
| --------- | ------ | ---- | -------- |
| appId     | String | 是    | 公众号的唯一标识 |
| nonceStr  | String | 是    | 生成签名的随机串 |
| timestamp | String | 是    | 生成签名的时间戳 |
| url       | String | 是    | 当前页面的url |
| signature | String | 是    | 签名       |

### 微信公众号消息群发

```url
[POST]/notify/wechat/send/message
```

说明：
1. 微信公众号消息群发（根据openid的指定列表群发消息）

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.9 | 新增   |

#### 请求报文参数

#### RequestBody
| 参数名         | 类型         | 必填   | 说明                 |
| ----------- | ---------- | ---- | ------------------ |
| openid_list | ObjectList | 是    | 需要给发送消息的openid列表   |
| text        | String     | 是    | 需要群发的消息内容，目前只能是纯文字 |
| tenant_id   | Long       | 是    | 租户ID               |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明       |
| ---------- | ------ | ---- | -------- |
| message_id | String | 是    | 公众号的唯一标识 |