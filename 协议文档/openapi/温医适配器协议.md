##### 获取病人配镜单

> [GET]/theeye/interface/get_sale_record

医院端获取收费和未收费，根据PID查询配镜记录

###### 请求报文参数

| 参数名 | 类型    | 必填 | 说明                           |
| ------ | ------- | ---- | ------------------------------ |
| PID    | Integer | 是   | 病人id                         |
| result | Integer | 否   | 0：未收费 1：已收费   空为全部 |

###### 回复报文ObjectList参数

| 参数名               | 类型    | 必填 | 说明     |
| -------------------- | ------- | ---- | -------- |
| PID                  | Integer | 是   | 病人id   |
| SaleTime             | String  | 是   | 配镜时间 |
| PlatformSaleRecordID | Integer | 是   | 配镜单号 |
| State                | String  | 是   | 状态     |

##### 获取病人配镜单详情

> [GET]/theeye/interface/sale_record_item

根据extKeyId来查询配镜单详情

###### 请求报文参数

| 参数名   | 类型    | 必填 | 说明     |
| -------- | ------- | ---- | -------- |
| extKeyId | Integer | 是   | 配镜单id |

###### 回复报文ObjectList参数

| 参数名      | 类型          | 必填 | 说明     |
| ----------- | ------------- | ---- | -------- |
| id          | Integer       | 是   | 细目id   |
| ProductName | string        | 是   | 商品名称 |
| ProductCode | string        | 是   | 商品编码 |
| UnitPrice   | decimal(16,2) | 是   | 销售单价 |
| Number      | int           | 是   | 数量     |
| TotalPrice  | decimal(16,2) | 是   | 总价     |
| Comment     | string        | 是   | 备注     |

##### 订单收费预校验

> [POST]/theeye/interface/pay_pre_check

医院端开始收费前，向平台发送预校验请求，请求通过了才开始收费
失败情况： 价格被调整， 单据状态不对

###### 请求报文参数

| 参数名 | 类型    | 必填 | 说明                    |
| ------ | ------- | ---- | ----------------------- |
| PID    | Integer | 否   | 病人id                  |
| empi   | String  | 否   | 平台上医院的患者主索引  |
| ExtKey | Integer | 是   | 外部订单id 就是配镜单id |

###### 回复报文Data参数

| 参数名           | 类型 | 必填 | 说明 |
| ---------------- | ---- | ---- | ---- |
| 返回成功与否状态 |      |      |      |

##### 收费成功通知

> [POST]/theeye/interface/pay_success

医院端向平台端发送某订单的收费成功通知
收费成功通知收到后，修改配镜单状态

###### 请求报文参数

| 参数名 | 类型    | 必填 | 说明                    |
| ------ | ------- | ---- | ----------------------- |
| PID    | Integer | 否   | 病人id                  |
| empi   | String  | 否   | 平台上医院的患者主索引  |
| ExtKey | Integer | 是   | 外部订单id 就是配镜单id |
| Result | String  | 是   | 1成功 0失败             |
| Msg    | String  | 否   | 操作结果描述            |

###### 回复报文Data参数

| 参数名           | 类型 | 必填 | 说明 |
| ---------------- | ---- | ---- | ---- |
| 返回成功与否状态 |      |      |      |

##### 配镜单退费

> [POST]/theeye/interface/pay_return

业务场景：

   用户要退费，柜台人员如果认为条件满足，收回物资，修改配镜单为待退费状态。不须通知收费端。然后患者到收费处退费。然后收费处开始退费流程

退费过程：

1. 医院端调用平台退费接口
2. 平台端收到开始退费请求后，检查该单据可以开始退费条件。如果条件满足，则直接修改订单为退费成功,并返回医院端退费成功。如果不满足退费条件，则返回退费失败。
3. 如果医院端收到退费失败结果，则不继续进行退费
4. 如果医院端收到退费成功结果，开始处理退费，退费成功后无须再通知平台。
5. 如果在退费过程中因某些原因退费失败了，需要通知平台退费失败
6. 平台端收到医院端退费失败通知后，把状态改为退费失败状态

医院端开始退费，向平台提交退费请求
检查该单据可以开始退费条件。如果条件满足，则直接修改订单为退费成功,并返回医院端退费成功。如果不满足退费条件，则返回退费失败。

补充说明：因售后还没做，暂时做个假接口

###### 请求报文参数

| 参数名 | 类型    | 必填 | 说明                    |
| ------ | ------- | ---- | ----------------------- |
| PID    | Integer | 是   | 病人id                  |
| empi   | String  | 否   | 平台上医院的患者主索引  |
| ExtKey | Integer | 是   | 外部订单id 就是配镜单id |

###### 回复报文参数

| 参数名           | 类型 | 必填 | 说明 |
| ---------------- | ---- | ---- | ---- |
| 返回成功与否状态 |      |      |      |

##### 配镜单退费通知

> [POST]/theeye/interface/pay_return_notify

如果在退费过程中因某些原因退费失败了，需要通知平台退费失败
平台端收到医院端退费失败通知后，把配镜单状态改为退费失败状态

补充说明：因售后还没做，暂时做个假接口

###### 请求报文参数

| 参数名 | 类型    | 必填 | 说明                    |
| ------ | ------- | ---- | ----------------------- |
| PID    | Integer | 是   | 病人id                  |
| empi   | String  | 否   | 平台上医院的患者主索引  |
| ExtKey | Integer | 是   | 外部订单id 就是配镜单id |
| Result | Integer | 是   | 1成功 0失败             |

###### 回复报文参数

| 参数名           | 类型 | 必填 | 说明 |
| ---------------- | ---- | ---- | ---- |
| 返回成功与否状态 |      |      |      |

##### 视光批发

> [POST]/theeye/interface/wholesale

框架公司调用视光批发接口把商品批发给隐形公司
平台这边其实是入库的过程

###### 请求报文参数

这里字段的命名习惯参照医院的表结构设计

| 参数名    | 类型       | 必填 | 说明         |
| --------- | ---------- | ---- | ------------ |
| manucode  | String     | 是   | 供应商编码   |
| usercode  | String     | 是   | 入库员工工号 |
| incomment | String     | 否   | 入库备注     |
| items     | ObjectList | 是   | 入库商品列表 |

入库商品列表说明

| 参数名         | 类型    | 必填 | 说明                     |
| -------------- | ------- | ---- | ------------------------ |
| productcode    | String  | 是   | 商品编码                 |
| provideid      | String  | 否   | 供货单号                 |
| number         | Integer | 是   | 入库数量                 |
| purchase_price | Double  | 是   | 入库时进价               |
| comment        | String  | 否   | 备注                     |
| validdate      | String  | 否   | 有效期 格式 yyyy-mm-dd   |
| manudate       | String  | 否   | 生产日期 格式 yyyy-mm-dd |
| batchno        | String  | 是   | 生产批号                 |
| registerno     | String  | 是   | 注册证号                 |

###### 回复报文参数

| 参数名 | 类型 | 必填 | 说明 |
| ------ | ---- | ---- | ---- |
| 无     |      |      |      |

##### 定做查询

> [GET]/theeye/interface/custom_query2

###### 请求报文参数

| 参数名               | 类型    | 必填 | 说明         |
| -------------------- | ------- | ---- | ------------ |
| PlatformSaleRecordID | Integer | 是   | 平台配镜单号 |

###### 回复报文参数

| 参数名      | 类型    | 必填 | 说明                            |
| ----------- | ------- | ---- | ------------------------------- |
| productcode | String  | 是   | 商品编码                        |
| number      | Integer | 是   | 数量                            |
| optometry   | String  | 否   | 定做参数                        |
| memo        | String  | 否   | 定做备注                        |
| odos        | Integer | 否   | 眼别：默认:0;0-无眼别;1-OD;2-OS |
| itemId      | Long    | 是   | 定做件的id                      |



##### 定做批发预校验

> [POST]/theeye/interface/wholesale_custom_check2

###### 请求报文参数

| 参数名    | 类型       | 必填 | 说明         |
| --------- | ---------- | ---- | ------------ |
| manucode  | String     | 是   | 供应商编码   |
| usercode  | String     | 是   | 入库员工工号 |
| incomment | String     | 否   | 入库备注     |
| items     | ObjectList | 是   | 入库商品列表 |

入库商品列表说明

| 参数名               | 类型    | 必填 | 说明                            |
| -------------------- | ------- | ---- | ------------------------------- |
| productcode          | String  | 是   | 商品编码                        |
| provideid            | String  | 否   | 供货单号                        |
| number               | Integer | 是   | 入库数量                        |
| odos                 | Integer | 否   | 眼别：默认:0;0-无眼别;1-OD;2-OS |
| purchase_price       | Double  | 是   | 入库时进价                      |
| comment              | String  | 否   | 备注                            |
| validdate            | String  | 否   | 有效期 格式 yyyy-mm-dd          |
| manudate             | String  | 否   | 生产日期 格式 yyyy-mm-dd        |
| batchno              | String  | 是   | 生产批号                        |
| registerno           | String  | 是   | 注册证号                        |
| PlatformSaleRecordID | Integer | 是   | 平台配镜单号                    |
| itemId               | Long    | 是   | 定做件的id                      |

###### 回复报文参数

| 参数名 | 类型 | 必填 | 说明 |
| ------ | ---- | ---- | ---- |
| 无     |      |      |      |

可能的错误信息：
  供应商和商品不匹配
  数量超过需求量

##### 定做批发

> [POST]/theeye/interface/wholesale_custom2

###### 请求报文参数

| 参数名    | 类型       | 必填 | 说明         |
| --------- | ---------- | ---- | ------------ |
| manucode  | String     | 是   | 供应商编码   |
| usercode  | String     | 是   | 入库员工工号 |
| incomment | String     | 否   | 入库备注     |
| items     | ObjectList | 是   | 入库商品列表 |

入库商品列表说明

| 参数名               | 类型    | 必填 | 说明                            |
| -------------------- | ------- | ---- | ------------------------------- |
| productcode          | String  | 是   | 商品编码                        |
| provideid            | String  | 否   | 供货单号                        |
| number               | Integer | 是   | 入库数量                        |
| odos                 | Integer | 否   | 眼别：默认:0;0-无眼别;1-OD;2-OS |
| purchase_price       | Double  | 是   | 入库时进价                      |
| comment              | String  | 否   | 备注                            |
| validdate            | String  | 否   | 有效期 格式 yyyy-mm-dd          |
| manudate             | String  | 否   | 生产日期 格式 yyyy-mm-dd        |
| batchno              | String  | 是   | 生产批号                        |
| registerno           | String  | 是   | 注册证号                        |
| PlatformSaleRecordID | Integer | 是   | 平台配镜单号                    |
| itemId               | Long    | 是   | 定做件的id                      |

###### 回复报文参数

| 参数名 | 类型 | 必填 | 说明 |
| ------ | ---- | ---- | ---- |
| 无     |      |      |      |