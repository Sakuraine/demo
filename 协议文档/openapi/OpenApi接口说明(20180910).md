[TOC]

# OpenApi接口说明文档

版本：V1.0(20190910)

**简要描述：** 

此文档为租户或第三方平台介绍如何接入医疗平台的一系列基本步骤。

**说明**:

租户或第三方平台，这里简称为用户。

## 一、接入准备及相关说明

1、用户接入医疗平台，首先需要准备一组密钥对，并且将公钥上传到医疗平台。密钥对生成方法用户可自行选择，例如利用ssh、openssl等软件或者互联网上在线生成工具，甚至自行代码生成均可。

2、用户将生成的公钥通过管理系统上传到医疗平台，获取由平台返回给用户的一个公钥所对应的key。

**调用API必须遵循以下规则：**

|   约定   |                                            说明                                           |
|----------|-------------------------------------------------------------------------------------------|
| 传输方式 | 为保证安全性，采用HTTPS传输                                                               |
| 提交方式 | 查询类采用POST方式提交，资源操作类使用POST、GET、PUT、DELETE对应CRUD                      |
| 数据格式 | 提交和返回数据都为JSON格式                                                                |
| 字符编码 | 统一采用UTF-8字符编码                                                                     |
| 签名算法 | 算法默认使用RSA，由接入端生成密钥的时候指定。但允许用户通过参数传递。接入端向平台提供公钥 |
| 签名要求 | 认证接口使用签名                                                                          |
| 判断逻辑 | 先判返回码，再处理返回内容                                                                |

* 时间
标准北京时间，时区为东八区；如果商户的系统时间为非标准北京时间。参数值必须根据商户系统所在时区先换算成标准北京时间， 例如商户所在地为0时区的伦敦，当地时间为2014年11月11日0时0分0秒，换算成北京时间为2014年11月11日8时0分0秒。

* 时间戳
标准北京时间，时区为东八区，自1970年1月1日 0点0分0秒以来的毫秒数。备注：格式13位

* 交易金额
交易金额默认为人民币交易，接口中参数支付金额单位为【分】，参数值不能带小数。

* 货币类型
CNY：人民币

**以下为统一返回报文结构**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**全局错误码**

|    值     | HTTP状态码 |        含义        |                 说明                 |
|-----------|------------|--------------------|--------------------------------------|
| 1000      | 200        | 调用成功           |                                      |
| 1001      | 200        | 非法参数           | 请求的参数不符合所调用的API的要求    |
| 1002      | 200        | 内部服务器错误     | 平台系统内部错误，请联系平台技术支持 |
| 1003      | 200        | 解析JSON字符串失败 | 无法解析请求中提交的JSON字符串       |
| 1004/1005 | 200/401    | Token无效          | 请求中包含的Token无效或过期          |
| 1004/1005 | 200/401    | Token不能为空      | 认证以为的API调用，必须包含Token     |

## 二、签名认证

用户在接入平台Openapi前，需要通过平台的签名认证，通过认证成功后返回的token才能顺利调用平台提供给用户的接口。

**签名步骤：**
1. 首先对需要签名的数据进行字典排序
2. 将排序后的数据拼成字符串并取hash值
3. 用私钥将字符串进行RSA-SHA1签名
4. 将生成的签名再进行Base64计算

***参考示例：***

java版步骤如下

1、用户将接入准备完成后将获取到的key值与当前请求时间戳timestamp进行字典序排序，并将排序结果拼接成排序字符串 A。


排序示例（java版）
```java
    //封装排序参数
	string A = "";
	Map<string, Object> signDataMap = new HashMap();
    signDataMap.put("key", docKey);
    signDataMap.put("timestamp", timestamp);
    //加入List用Collections的sort方法排序
    List<string> keys = new ArrayList<>(signDataMap.keySet());
    Collections.sort(keys);
    for (string key : keys) {
        A += signDataMap.get(key);
    }
```

2、用户取得排序后的字符串A所对应的**Hash值**，即字符串B

取Hash值示例（java版）
```java
	//定义字典字符串和Hash值对象
   string A = "";
   string B = "";
   try {
        final MessageDigest mDigest = MessageDigest.getInstance("SHA1");
        mDigest.update(A.getBytes());
        B = bytesToHexstring(mDigest.digest());
    } catch (NoSuchAlgorithmException e) {
        B = string.valueOf(A.hashCode());
    }
```

3、用户使用接入准备中生成的私钥对Hash值进行RSA2加密，并对其进行Base64编码即能成为[签名认证](#签名认证协议)接口中的sign参数。RSA2加密请参见[加密算法](http://blog.csdn.net/u010837811/article/details/51541911)。

4、进行base64编码

## 三、API接口

**备注说明**

1、除签名验证协议`https://api.best-seeing.com/v1.0/auth/token`以外，用户在访问任何接口协议时必须要在Http**请求头**里面加入**Token信息**

***参考示例***

```
Accept:*/*
Accept-Encoding:gzip, deflate
Accept-Language:zh-CN,zh;q=0.8
token: 2597318629358407
Content-Type: application/json
Cache-Control: no-cache
```

2、对于 **PUT、DELETE、GET** 三种类型的单一资源对象的HTTP请求操作，请求操作的资源对象ID以URL中的**Path路径表示**。

***参考示例***

例如：对于一个 ID 是 001 的病人进行信息修改 即PUT请求操作，其请求地址为`https://api.best-seeing.com/v1.0/patient/001`

## 四、基础接口

### 签名认证协议

**简要描述：**

此协议是租户或第三方平台接入医疗平台API所必要的身份校验。通过校验后的用户可以获取认证token，继而正常使用医疗平台提供的各项API服务。

**使用说明：**

1. 用户需要将公钥上传到医疗平台，上传成功会获取到该公钥对应的key值。
2. 用户根据协议提供接口必需的请求参数，包括业务参数和签名数据。签名算法详见 [签名算法](#二、签名认证)。

**请求URL：**

- https://api.best-seeing.com/v1.0/auth/token

**请求方式：**

- POST 

**请求参数说明：** 

| 参数名    | 必选 | 类型   | 说明                                                  |
| --------- | ---- | ------ | ----------------------------------------------------- |
| key       | 是   | string | 租户与平台对接key，由平台分配                         |
| algorithm | 否   | string | 加密算法类型，目前仅支持RSA2，传 "RSA"                |
| sign      | 是   | string | 签名数据，对key和timestamp以及algorithm进行签名       |
| timestamp | 是   | long   | 请求时间戳，服务器只处理时间戳在当前时间1分钟内的请求 |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data对象

| 参数名  |  类型  |                 说明                 |
|---------|--------|--------------------------------------|
| token   | string | 授权token                            |
| expires | long   | token过期时间，截止该时间则token失效 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{"token":"334081f8-dc24-4b15-be1a-127e06172046", "expires":259200}
}
```

**错误码**

|  值  | HTTP状态码 |        含义        |                             说明                            |
|------|------------|--------------------|-------------------------------------------------------------|
| 2001 |        200 | 找不到租户         | key对应的租户拥有者不存在或已失效                           |
| 2002 |        200 | 找不到租户对接信息 | key对应的授权记录不存在                                     |
| 2003 |        200 | 加密算法不支持     | 签名的算法不在平台的支持列表中                              |
| 2004 |        200 | 用户签名不正确     | 请求的sign签名参数可能为空或者格式有误                      |
| 2005 |        200 | 时间戳有误         | 请求时间戳验证了请求的时效性，时间戳在1分钟内的请求方为有效 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

### 获取页面访问Token协议

**简要描述：**

为线下系统内使用或打开平台页面时使用；访问线上系统需要特定的token，而本协议用于获取这个token。注意这个token的默认有效期为60s，请尽快使用。

**使用说明：**

提供必要的参数

**请求URL：**

- https://api.best-seeing.com/v1.1/auth/sso

**请求方式：**

- POST

**请求参数说明：**

|      参数名      | 必选 |  类型  |         说明         |
|------------------|------|--------|----------------------|
| userJobNumber    | 是   | string | 线下员工（医生）工号 |
| hospitalDeptCode | 是   | string | 线下部门编码         |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**data参数说明：**

|   参数名    |  类型  |              说明             |
|-------------|--------|-------------------------------|
| accessToken | string | 返回授权需要使用的accessToken |
| expiresIn   | long   | access token：60秒有效期      |
| deptId      | long   | 线上部门ID                    |
| tenantId    | long   | 租户ID                        |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{
		"accessToken":"2YotnFZFEjr1zCsicMWpAA",
		"expiresIn ":60，
		"deptId":123131,
		"tenantId":839289191,
	}
}
```

**错误码**

|  值  | HTTP状态码 |              说明              |
|------|------------|--------------------------------|
| 6202 |        200 | 要授权的员工（医生）信息不存在 |
| 6204 |        200 | 科室不存在                     |

**备注**

- 更多返回错误代码请看首页的错误代码描述

## 五、电子病历相关

### 基础信息接口

#### 病人信息同步

**简要描述：**

对某个患者的信息进行新增或修改操作，其中包含了患者的默认联系人信息。

**使用说明：**

用户提供所有必需的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/patient

**请求方式：**
- POST

**请求参数说明：** 

| 参数名  |  类型  | 必填 |          说明          |
|---------|--------|------|------------------------|
| patient | object | 是   | 传入的病人信息对象集合 |

patient内容说明

|      参数名       |     类型     | 必填 |                      说明                     |
|-------------------|--------------|------|-----------------------------------------------|
| hospitalPatientId | string       | 是   | 线下患者id                                    |
| systemCode        | string       | 否   | 医院系统代码,如果为空则用租户号               |
| name              | string       | 是   | 姓名                                          |
| gender            | string       | 是   | 性别代码;0-未知;1-男;2-女;9-未指名            |
| birthday          | Date         | 是   | 出生日期                                      |
| birthPlace        | string       | 否   | 出生地                                        |
| nationality       | int          | 否   | 国籍                                          |
| ethnicity         | string       | 否   | 民族                                          |
| maritalStatus     | string       | 否   | 婚姻状况代码                                  |
| profession        | string       | 否   | 职业（数据中心数据字典）                      |
| standardCulture   | string       | 否   | 文化程度代码 standard culture(统一编码)       |
| phone             | string       | 否   | 电话号码                                      |
| email             | string       | 否   | 电子邮箱                                      |
| cardType          | string       | 是   | 证件类型，见《统一编码-证件类别》             |
| cardNumber        | string       | 否   | 证件号                                        |
| idCardNumber      | string       | 否   | 身份证号                                      |
| province          | string       | 否   | 省、自治区、直辖市、特别行政区（API数据字典） |
| city              | string       | 否   | 市、自治州（API数据字典）                     |
| county            | string       | 否   | 县(市)、区、旗（API数据字典）                 |
| town              | string       | 否   | 乡、镇、街道 中                               |
| address           | string       | 否   | 详细地址                                      |
| postCode          | string       | 否   | 邮政编码                                      |
| costType          | Integer      | 是   | 费别：1-自费，2-医保                          |
| nsuranceName      | string       | 否   | 医保类别名称                                  |
| nsuranceCodes     | List<string> | 否   | 医保类别代码（API数据字典）                   |
| treatmentName     | string       | 否   | 医疗待遇名称                                  |
| treatmentCode     | string       | 否   | 医疗待遇代码（API数据字典）                   |
| contactName       | string       | 否   | 联系人姓名                                    |
| contactPhone      | string       | 否   | 联系人手机号码                                |
| contactRelation   | Integer      | 否   | 联系人与患者关系，见API数据字典               |

婚姻状况

| 值 |      值含义      | 说明 |
|----|------------------|------|
| 10 | 未婚             |      |
| 20 | 已婚             |      |
| 21 | 初婚             |      |
| 22 | 再婚             |      |
| 23 | 复婚             |      |
| 30 | 丧偶             |      |
| 40 | 离婚             |      |
| 90 | 未说明的婚姻状况 |      |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

|  参数名   | 类型 |  说明  |
|-----------|------|--------|
| patientId | long | 患者id |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |   含义   |               说明               |
|------|------------|----------|----------------------------------|
| 6301 |        200 | 数据异常 | 线下id和身份证信息混乱导致的异常 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

### 查询类接口

#### 获取电子病历单点登录参数(温州眼视光医院专用)

**简要描述：**
此接口用于获取打开电子病历url中所需要的参数，例如就诊号，部门，病人id等。温州眼视光医院专用，正常使用请让`获取页面单点登录Token协议`代替。

**使用说明：**
提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/auth/sso

**请求方式：**
- POST


**请求参数说明：**

| 参数名             | 必选 | 类型   | 说明                           |
| ------------------ | ---- | ------ | ------------------------------ |
| userJobNumber      | 是   | string | 线下员工（医生）工号           |
| userAgent          | 是   | string | CEF系统中特殊的user-agent      |
| hospitalPid        | 是   | string | 线下患者id                     |
| hospitalDeptCode   | 是   | string | 线下部门编码                   |
| hospitalDiagnoseId | 否   | string | 线下诊断流水号（即线下诊断id） |
| hospitalTreatId    | 是   | string | 线下就诊id                     |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**data参数说明：**

|   参数名    |  类型  |                        说明                        |
|-------------|--------|----------------------------------------------------|
| accessToken | string | 返回授权需要使用的accessToken                      |
| expiresIn   | long   | access token 多长时间后过期，单位ms ，即默认18小时 |
| pid         | long   | 线上患者ID                                         |
| deptId      | long   | 线上部门ID                                         |
| diagnoseId  | long   | 线上诊断记录id                                     |
| treatId     | long   | 线上就诊记录id                                     |
| tenantId    | long   | 租户ID                                             |

**返回示例**

```java
{
"code":1000,
"msg":"调用成功",
"data":{
		"accessToken":"2YotnFZFEjr1zCsicMWpAA",
		"expiresIn ":7200，
		"pid ":1221,
		"deptId":123131,
		"tenantId":839289191,
		"diagnoseId ":12123323
	}
}
```

**错误码**

|  值  | HTTP状态码 |              说明              |
|------|------------|--------------------------------|
| 6202 |        200 | 要授权的员工（医生）信息不存在 |
| 6204 |        200 | 科室不存在                     |
| 6103 |        200 | 患者信息不存在                 |

**备注**

- 更多返回错误代码请看首页的错误代码描述

#### 获取病历文件下载地址  

**简要描述：**
应用场景为在结束就诊后，线下系统需要打印病人的小病历时，通过该接口获取相关的病历pdf，以便线下系统打印使用。

**使用说明：**
提供必要的参数 pdfUrl

**请求URL：**
- https://api.best-seeing.com/v1.1/emr/pdf/download

**请求方式：**
- POST


**请求参数说明：**

|     参数名      | 必选 |  类型  |       说明       |
|-----------------|------|--------|------------------|
| hospitalTreatId | 是   | string | 线下就诊记录的id |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回结果 |

data数据内容

| 参数名 |  类型  |     说明     |
|--------|--------|--------------|
| pdfUrl | string | 下载文件地址 |

**返回示例**

```java
{
"code":1000,
"msg":"调用成功",
"data":{}
}
```

**错误码**

|  值  | HTTP状态码 |       含义       |
|------|------------|------------------|
| 6302 |        200 | 就诊没有结束     |
| 6318 |        200 | 病历信息不存在   |
| 6319 |        200 | 主诉信息不存在   |
| 6329 |        200 | 现病史信息不存在 |

#### 获取病人当天就诊记录 

**简要描述：**
应用场景为线下进行就诊记录查询，显示病历是否打印标志

**使用说明：**
提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/{hospitalPatientId}/treatments

**请求方式：**
- GET


**请求PATH变量参数说明：**

| 参数名            | 必选 | 类型   | 说明       |
| ----------------- | ---- | ------ | ---------- |
| hospitalPatientId | 是   | string | 线下患者ID |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | Object | 返回数据 |

**data参数说明：**

|   参数名   | 类型 |     说明     |
|------------|------|--------------|
| treatments | list | 返回数据列表 |

|      参数名       |  类型  |                 说明                 |
|-------------------|--------|--------------------------------------|
| hospitalTreatId   | string | 线下就诊Id                           |
| hospitalPatientId | string | 病人id                               |
| isPrint           | int    | 是否打印病历标志，0：未打印  1：打印 |

**错误码**

| 值 | HTTP状态码 | 含义 | 说明 |
|----|------------|------|------|
|    |            |      |      |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 查询就诊记录列表  


**简要描述：** 

- 查询病历信息，根据就诊病人id和就诊时间

**请求URL：** 
- https://api.best-seeing.com/v1.0/emr/treatments
  
**请求方式：**
- POST 

**参数：** 

|      参数名       | 必选 |  类型  |                说明               |
|-------------------|------|--------|-----------------------------------|
| hospitalPatientId | 是   | string | 线下病人id                        |
| patientId         | 是   | id     | 线上病人id ，与参数线下病人二选一 |
| startTime         | 是   | date   | 开始时间                          |
| endTime           | 是   | date   | 结束时间                          |

**返回参数:**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

|   参数名   | 必选 | 类型 |    说明    |
|------------|------|------|------------|
| treatments | 是   | list | 线上就诊id |

treatments 对象如下

|      参数名       | 必选 |  类型  |      说明      |
|-------------------|------|--------|----------------|
| treatId           | 是   | long   | 线上就诊id     |
| hospitalTreatId   | 否   | string | 线下就诊id     |
| patientId         | 是   | long   | 线上pid        |
| hospitalPatientId | 是   | string | 线下病人id     |
| patientName       | 是   | string | 病人姓名       |
| age               | 是   | int    | 年龄           |
| gender            | 是   | int    | 性别           |
| deptId            | 是   | long   | 线上就诊科室id |
| deptName          | 是   | string | 就诊科室名称   |
| doctorId          | 是   | long   | 线上医生id     |
| doctorName        | 是   | string | 线上医生名称   |
| time              | 是   | date   | 就诊时间       |


**返回示例**

``` java
  {
    "error_code": 0,
    "data": []
  }
```

**返回参数说明** 

| 参数名 | 类型 | 说明 |
|--------|------|------|
|        |      |      |


**备注** 

- 更多返回错误代码请看首页的错误代码描述



#### 获取病历信息列表  


**简要描述：** 

- 根据病人id查询一个病人病历信息列表

**请求URL：** 
- `https://api.best-seeing.com/v1.0/emr/order/treatments`
  
**请求方式：**
- POST 

**参数：** 

|      参数名       | 必选 |  类型  |        说明       |
|-------------------|------|--------|-------------------|
| hospitalPatientId | 是   | string | 线下患者id 二选一 |
| patientId         | 是   | long   | 线上患者id 二选一 |

**返回参数说明** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

|      参数名      | 类型 |   说明   |
|------------------|------|----------|
| emrOnceTreatList | list | 病历列表 |

emrOnceTreatList里的内容

| 参数名          | 类型   | 说明       |
| --------------- | ------ | ---------- |
| treatId         | long   | 线上就诊id |
| hospitalTreatId | string | 线下就诊id |
| doctorId        | long   | 线上医生id |
| doctorName      | long   | 线上医生id |
| treatTime       | date   | 就诊时间   |
| emrContext      | object | 病历对象   |

emrContext对象

|      参数名       |  类型  |     说明     |
|-------------------|--------|--------------|
| compContent       | string | 主诉         |
| illnContent       | string | 现病史       |
| hisIllnContent    | string | 既往史       |
| emrSpecText       | string | 专科检查文本 |
| diagName          | string | 诊断         |
| emrTreaSuggestion | string | 处理意见     |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

### 操作类

#### 挂号信息同步 ####

**简要描述：**
应用场景为患者云下挂号，为接入用户提供了患者本次挂号及就诊信息的同步。（具体同步的信息包含患者基本信息、挂号信息、科室和医生的信息）
说明：本接口的患者基本信息用于每次就诊记录留档的患者基本信息更新，并不涉及患者基本信息表的更新。
**使用说明：**
提供必要的参数

**请求URL：**
- ` https://api.best-seeing.cn/v1.0/emr/book

**请求方式：**
- POST

**请求参数说明：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
| hospitalPid | String | 是 | 线下患者id|
|book|object|是|挂号信息|

book内容说明

| 参数名      | 类型     | 必填   | 说明                        |
| -------- | ------ | ---- | ------------------------- |
|hospitalVisitId| string | 是| 病人医院挂号id |
| visitSourceType    | String | 是| 病人来源 0：挂号 1：绿色通道 2：方便门诊     |
| acceptDeptId    | String | 否|线上科室或部门id    |
| acceptVisitUserNo    | String | 否 | 接诊医生工号    |
|acceptDeptCode|String |是|线下接诊科室或部门|
|visitSerialNo|String |是|就诊序号|
 **返回参数说明：** 

|参数名|类型|说明|
|:-------|:-------|:-------|
| code | number| 状态码 |
| msg | string| 状态信息 |
| data |object  | 返回数据 |

data内容

|参数名|类型|必填|说明|
|:-------|:-------|:-------|
| visitId    | long    |是| 平台门诊号  |



 **返回示例**

```
{
"code":1000,
"msg":"调用成功",
"data":{}
}
```

**错误码**

| 值    | HTTP状态码 |含义     |
| ---- | ------ | ------ |
| 6206 | 200 | 挂号医生不存在 |
| 6208 | 200 | 挂号科室不存在 |
|6103  |200  |患者信息不存在|


 **备注** 

- 更多返回错误代码请看首页的错误代码描述




#### 就诊信息同步

**简要描述：**
应用场景为患者云下完成分诊后，为线上同步患者本次挂号、预检、分诊、就诊信息。

**使用说明：**
提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/treatment/triage

**请求方式：**
- POST

**请求参数说明：** 

|   参数名    |  类型  | 必选 |              说明              |
|-------------|--------|------|--------------------------------|
| patient     | object | 是   | 患者信息                       |
| book        | object | 是   | 挂号信息                       |
| preview     | object | 否   | 预检信息                       |
| cycloplegic | object | 否   | 睫麻后预检信息，目前温医不使用 |
| treatment   | object | 是   | 就诊信息                       |


patient内容说明

|      参数名       |     类型     | 必填 |                      说明                     |
|-------------------|--------------|------|-----------------------------------------------|
| hospitalPatientId | string       | 是   | 线下患者id                                    |
| systemCode        | string       | 否   | 医院系统代码,如果为空则用租户号               |
| name              | string       | 是   | 姓名                                          |
| gender            | string       | 是   | 性别代码(API数据字典)                         |
| birthday          | Date         | 是   | 出生日期                                      |
| birthPlace        | string       | 否   | 出生地                                        |
| nationality       | string       | 否   | 国籍                                          |
| ethnicity         | string       | 否   | 民族                                          |
| maritalStatus     | string       | 否   | 婚姻状况代码 marital status(API数据字典)      |
| profession        | string       | 否   | 职业（数据中心数据字典）                      |
| standardCulture   | string       | 否   | 文化程度代码 standard  culture(统一编码)      |
| phone             | string       | 是   | 电话号码                                      |
| email             | string       | 否   | 电子邮箱                                      |
| cardType          | string       | 是   | 证件类型，见《统一编码-证件类别》             |
| cardNumber        | string       | 否   | 证件号                                        |
| idCardNumber      | string       | 否   | 身份证号                                      |
| province          | string       | 否   | 省、自治区、直辖市、特别行政区（API数据字典） |
| city              | string       | 否   | 市、自治州（API数据字典）                     |
| county            | string       | 否   | 县(市)、区、旗（API数据字典）                 |
| town              | string       | 否   | 乡、镇、街道 中                               |
| address           | string       | 否   | 详细地址                                      |
| postCode          | string       | 否   | 邮政编码                                      |
| costType          | Integer      | 是   | 费别：1-自费，2-医保                          |
| nsuranceName      | string       | 否   | 医保类别名称                                  |
| nsuranceCodes     | List<string> | 否   | 医保类别代码（API数据字典）                   |
| treatmentName     | string       | 否   | 医疗待遇名称                                  |
| treatmentCode     | string       | 否   | 医疗待遇代码（API数据字典）                   |
| contactName       | string       | 否   | 联系人姓名                                    |
| contactPhone      | string       | 否   | 联系人手机号码                                |
| contactRelation   | Integer      | 否   | 联系人与患者关系，见API数据字典               |

book内容说明

| 参数名            | 类型   | 必填 | 说明                                     |
| ----------------- | ------ | ---- | ---------------------------------------- |
| hospitalVisitId   | string | 是   | 病人医院挂号id                           |
| visitSourceType   | string | 是   | 病人来源 0：挂号 1：绿色通道 2：方便门诊 |
| acceptDeptId      | long   | 否   | 线上科室或部门id                         |
| acceptVisitUserNo | string | 否   | 挂号医生工号                             |
| acceptDeptCode    | string | 是   | 线下挂号科室或部门                       |
| visitSerialNo     | string | 是   | 就诊序号                                 |

preview内容说明

|      参数名       | 必选 |   类型   |              说明              |
|-------------------|------|----------|--------------------------------|
| hospitalVisitId   | 是   | string   | 医院挂号id                     |
| visitId           | 否   | long     | 平台挂号id                     |
| previewId         | 否   | long     | 预检id，医院不一定有，有则更新 |
| hospitalPatientId | 是   | string   | 医院病人id                     |
| odSphere          | 否   | double   | 验光OD-球镜                    |
| odCylinder        | 否   | double   | 验光OD-柱镜                    |
| odAxis            | 否   | double   | 验光OD-轴向                    |
| odMemo            | 否   | string   | od备注                         |
| osSphere          | 否   | double   | 验光Os-球镜                    |
| osCylinder        | 否   | double   | 验光Os-柱镜                    |
| osAxis            | 否   | double   | 验光Os-轴向                    |
| osMemo            | 否   | string   | os备注                         |
| pdMemo            | 否   | string   | 瞳距备注                       |
| farPd             | 否   | double   | 瞳距-远用                      |
| nearPd            | 否   | double   | 瞳距-近用                      |
| odPd              | 否   | double   | 瞳距单眼-od                    |
| osPd              | 否   | double   | 瞳距单眼-os                    |
| checkTime         | 否   | datetime | 预检时间                       |
| checkUserId       | 否   | long     | 线上系统预检人（医生或护士）id |
| checkJobNumber    | 是   | string   | 线下预检人（医生或护士）id     |

treatment内容说明

|       参数名        |  类型  | 必选 |                        说明                        |
|---------------------|--------|------|----------------------------------------------------|
| hospitalTreatId     | string | 是   | 线下就诊id                                         |
| treatDrId           | long   | 否   | 线上医生id                                         |
| hospitalDrId        | string | 是   | 线下医生id                                         |
| treatDeptId         | long   | 否   | 线上科室id                                         |
| hospitalTreatDeptId | string | 是   | 线下就诊科室id                                     |
| treatVisitTime      | date   | 否   | 接诊时间                                           |
| treatSourceType     | int    | 否   | 病人来源 1：普通挂号 2：散瞳 3：综合眼光 4：低视力 |
| treatDirectionType  | int    | 否   | 病人去向 0：离院 1：去其他专科 2：去检查 3：其他   |

**cycloplegic内容说明**

|     参数名     | 必选 |   类型   |              说明              |
|----------------|------|----------|--------------------------------|
| prevOdSphere   | 否   | long     | OD-球镜                        |
| prevOdCylinder | 否   | long     | OD-柱镜                        |
| prevOdAxis     | 否   | long     | OD-轴向                        |
| prevOdMemo     | 否   | string   | OD-备注                        |
| prevOsSphere   | 否   | long     | OS-球镜                        |
| prevOsCylinder | 否   | long     | OS-柱镜                        |
| prevOsAxis     | 否   | long     | OS-轴向                        |
| prevOsMemo     | 否   | string   | OS-备注                        |
| checkTime      | 是   | datetime | 预检时间                       |
| checkUserId    | 否   | long     | 线上系统预检人（医生或护士）id |
| checkJobNumber | 是   | string   | 线下预检人（医生或护士）id     |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**data格式说明**

| 参数名  | 类型 |  说明  |
|---------|------|--------|
| visitId | long | 挂号id |
| treatId | long | 就诊id |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{
    "visitId":192929229192,
    "treatId":93938911210012
  }
}
```

**错误码**

|  值  | HTTP状态码 |      含义      |              说明              |
|------|------------|----------------|--------------------------------|
| 6201 |        200 | 就诊信息不存在 | 更新分诊信息未找到就诊信息     |
| 6203 |        200 | 预检人不存在   | 更新预检信息时未找到预检人信息 |
| 6206 |        200 | 挂号医生不存在 | 更新挂号未找到医生信息         |
| 6207 |        200 | 就诊医生不存在 | 挂号时未找到医生信息           |
| 6208 |        200 | 挂号科室不存在 | 挂号时未找到科室信息           |
| 6209 |        200 | 就诊科室不存在 | 就诊时未找到科室信息           |
| 6103 |        200 | 患者信息不存在 | 患者信息不存在                 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 开始就诊

**简要描述：**

应用场景为医生在云下接诊，更新就诊记录的接诊医生和部门以及就诊记录状态

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.cn/v1.0/emr/treatment/start

**请求方式：**
- POST

**请求参数说明：** 

|       参数名       |  必选  | 类型 |                   说明                   |
|--------------------|--------|------|------------------------------------------|
| treatId            | long   | 否   | 线上就诊id                               |
| hospitalTreatId    | string | 是   | 线下医院就诊id                           |
| acceptDepartmentId | string | 是   | 线下接诊科室或部门，需要传平台已有的科室 |
| acceptUserId       | string | 是   | 线下接诊医生工号                         |
| acceptTime         | Date   | 是   | 接诊时间                                 |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      含义      |           说明           |
|------|------------|----------------|--------------------------|
| 6201 |        200 | 就诊信息不存在 | 开始就诊时未找到就诊信息 |
| 6204 |        200 | 科室不存在     | 就诊科室信息不存在       |
| 6202 |        200 | 医生不存在     | 就诊医生不存在           |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 医生诊断同步  

**简要描述：**

应用场景为医生云下同步诊断，全量接口，每次提交的内容做为本次就诊的所有诊断内容。

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/diagnose/commit

**请求方式：**
- POST

**请求参数说明：** 

|           参数名            | 必选 |   类型   |                  说明                  |
|-----------------------------|------|----------|----------------------------------------|
| treatId                     | 否   | long     | 线上就诊Id                             |
| hospitalTreatId             | 是   | string   | 线下就诊id                             |
| createTime                  | 否   | datetime | 线下开立诊断时间，不传则用当前时间     |
| modifyTime                  | 否   | datetime | 线下修改诊断时间，不传则用当前时间     |
| hospitalCreateUserJobNumber | 是   | string   | 线下开立诊断的用户工号                 |
| hospitalModifyUserJobNumber | 否   | string   | 线下修改诊断的用户工号，不传则为创立人 |
| diagnoses                   | 是   | list     | 诊断列表                               |

diagnoses列表对象内容

|          参数名          | 必选 |  类型  |                                   说明                                   |
|--------------------------|------|--------|--------------------------------------------------------------------------|
| hospitalDiagnoseRecordId | 是   | string | 线下诊断流水号                                                           |
| diagnosePreviewName      | 否   | string | 前缀内容                                                                 |
| hospitalDiagnoseId       | 是   | string | 线下诊断id                                                               |
| diagnoseIcd              | 是   | string | ICD编码                                                                  |
| diagnoseAttach           | 否   | string | 附加码                                                                   |
| diagnoseSufxName         | 否   | string | 后缀内容                                                                 |
| diagnoseName             | 是   | string | 诊断名称，有线下诊断id可不传                                             |
| diagnoseMaster           | 是   | int    | 主诊断标识 是否主诊断，默认：0：否 1：是                                 |
| diagnoseResourceType     | 否   | int    | 诊断来源：哪儿录入的默认为1,类型；1-基本病历；2-双眼视首诊；3-双眼视随访 |
| hospitalDeptId           | 是   | string | 线下开立部门id                                                           |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |


**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |        含义        |           说明           |
|------|------------|--------------------|--------------------------|
| 6201 |        200 | 就诊信息不存在     | 就诊信息不存在           |
| 6210 |        200 | 开立诊断科室不存在 | 开立诊断的科室不存在     |
| 6211 |        200 | 诊断不存在         | 平台诊断库并不含有该诊断 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 眼压预检数据同步

**简要描述：**

应用场景为线下同步眼压预检数据到线上。

**使用说明：**

同一次就诊的多次眼压预检数据上传信息，将会以最后一次数据为准。如果多次上传的数据为相同数据（眼压数据、护士、部门、检查时间,线下眼压id相同，则视为相同数据），则只保存第一次数据。

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/IOP

**请求方式：**
- POST

**请求参数说明：** 

| 参数名           | 必选 | 类型   | 说明                               |
| ---------------- | ---- | ------ | ---------------------------------- |
| hospitalIopId    | 是   | String | 线下眼压id                         |
| hospitalTreatId  | 是   | string | 线下就诊id，与线上就诊id二选一     |
| treatId          | 是   | long   | 线上就诊Id，与线下就诊id二选一     |
| hospitalDoctorId | 是   | string | 线下开立眼压数据医生，与线上二选一 |
| doctorId         | 是   | long   | 线上开立眼压数据医生，与线下二选一 |
| hospitalDeptId   | 是   | string | 线下操作部门id，与线上二选一       |
| deptId           | 是   | long   | 线上操作部门id，与线下二选一       |
| osIop            | 否   | string | 左眼眼压                           |
| odIop            | 否   | string | 右眼眼压                           |
| checkTime        | 是   | long   | 检查时间,单位ms的时间戳            |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |


**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

#### 眼压预检数据删除

**简要描述：**

应用场景为删除眼压预检数据。

**使用说明：**

提供必要的参数

**请求URL：**

- https://api.best-seeing.com/v1.0/emr/deleteIop

**请求方式：**

- POST

**请求参数说明：** 

| 参数名        | 必选 | 类型   | 说明       |
| ------------- | ---- | ------ | ---------- |
| hospitalIopId | 是   | String | 线下眼压id |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```



#### 药品医嘱（处方）上传（温州眼视光医院专用）

**简要描述：**

向线上同步药品医嘱，增量接口，一个处方多次提交时，向同一个处方中添加药品医嘱内容。
线上处方是需要收费的，本协议只上传处方数据内容，并不参于收费流程（即不关心是否已经收费）。

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/prescriptions

**请求方式：**
- POST

**请求参数说明：** 

|        参数名        | 必选 |    类型    |        说明        |
|----------------------|------|------------|--------------------|
| treatId              | 否   | long       | 线上就诊Id         |
| hospitalTreatId      | 是   | string     | 线下就诊id         |
| hospitalDepartmentId | 是   | string     | 开立处方部门线下id |
| doctorId             | 是   | string     | 线下开立处方的医生 |
| createTime           | 是   | Long       | 处方开立的时间     |
| prescriptions        | 是   | objectList | 处方列表           |

prescriptions内容

|     参数名     | 必选 |    类型    |                  说明                  |
|----------------|------|------------|----------------------------------------|
| presId         | 否   | long       | 处方id                                 |
| hospitalPresId | 是   | string     | 线下处方id                             |
| inpaId         | 否   | long       | 住院id                                 |
| presType       | 是   | int        | 处方来源，1：门诊处方  2：出院带病处方 |
| presAttr       | 否   | string     | 处方属性                               |
| presCosts      | 是   | decimal    | 费用                                   |
| presCharges    | 是   | decimal    | 实付费用                               |
| adviceInfos    | 是   | objectList | 医嘱信息                               |

adviceInfos中对象定义

|        参数名         | 必选 |   类型   |                             说明                            |
|-----------------------|------|----------|-------------------------------------------------------------|
|hospitalTreatId     |是   |string   |  线下就诊id |
| hospitalOrderId       | 是   | string   | 线下医嘱Id                                                  |
| orderId               | 否   | long     | 平台医嘱id                                                  |
| departmentId          | 否   | long     | 开立部门id                                                  |
| hospitalDepartmentId  | 是   | string   | 线下开立部门id                                              |
| doctorId              | 是   | string   | 线下医嘱开立的医生                                          |
| createTime            | 是   | datetime | 医嘱开立时间                                                |
| nurseId               | 否   | string   | 线下医嘱校对护士id                                          |
| handleTime            | 否   | datetime | 医嘱校对时间                                                |
| performDeptId         | 否   | long     | 线上医嘱执行科室id                                          |
| hospitalPerformDeptId | 是   | string   | 线下医嘱执行科室id                                          |
| type                  | 是   | string   | 医嘱类别:见api数据字典医嘱类别                              |
| status                | 是   | int      | 医嘱状态默认: 1：录入 2：确认 3：执行 4：停止 5：取消       |
| terminationUserId     | 否   | string   | 线下医嘱停止人id                                            |
| terminationTime       | 否   | datetime | 医嘱停止时间                                                |
| adviceClass           | 是   | int      | 医嘱类型：默认：1：门诊处方 2：住院医嘱 3：出院带药处方     |
| grouId                | 否   | long     | 医嘱组id                                                    |
| orderText             | 否   | string   | 医嘱正文                                                    |
| isGroup               | 是   | int      | 是否医嘱组 默认：0：否1：是                                 |
| chargeStatus          | 否   | int      | 收费状态                                                    |
| ordeBilling           | 是   | int      | 医嘱计价。默认0。0：正常计价1：自带药2：需手工计价3：不计价 |
| code                  | 是   | string   | 药品编码                                                    |
| name                  | 是   | string   | 药品名称                                                    |
| spec                  | 是   | string   | 规格                                                        |
| packSpec              | 是   | string   | 包装规格                                                    |
| packAmount            | 是   | int      | 包装数量                                                    |
| packUnits             | 是   | string   | 包装单位                                                    |
| units                 | 是   | string   | 最小单位                                                    |
| freqId                | 否   | long     | 频率id，传入平台的频率表的id                                |
| freqDescribe          | 是   | string   | 频率基本描述                                                |
| freqCount             | 是   | int      | 频率次数                                                    |
| freqInterval          | 否   | int      | 频率间隔                                                    |
| freqUnit              | 否   | string   | 频率间隔单位                                                |
| freqDetail            | 否   | string   | 执行时间详细描述                                            |
| days                  | 否   | int      | 执行天数                                                    |
| dosage                | 是   | double   | 一次使用剂量                                                |
| usageUnits            | 是   | string   | 一次使用单位                                                |
| dosePerUnit           | 否   | double   | 最小单位剂量                                                |
| doseUnits             | 是   | string   | 剂量单位                                                    |
| administration        | 是   | string   | 给药途径                                                    |
| usagPlace             | 否   | string   | 给药部位                                                    |
| duration              | 否   | double   | 持续时间                                                    |
| durationUnits         | 否   | string   | 持续时间单位                                                |
| userDescription       | 否   | string   | 用法描述                                                    |
| totalAmount           | 否   | double   | 包装数量总量                                                |
| price                 | 否   | decimal  | 单价                                                        |
| costs                 | 否   | decimal  | 费用                                                        |
| charge                | 否   | decimal  | 实付费用                                                    |
| stIndicator           | 否   | int      | 皮试标志                                                    |
| memo                  | 否   | string   | 备注                                                        |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

#### 药品处方删除（温州眼视光医院专用）

**简要描述：**

删除整个处方，包含处方下的药品医嘱。
线上处方是需要收费与退费的，本协议只上报删除处方，并不参于收退费流程（即不关心是否已经收退费）。

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/prescriptions/delete_with_ids

**请求方式：**
- POST

**请求参数说明：** 

| 参数名                  | 必选 | 类型     | 长度 | 说明           |
| ----------------------- | ---- | -------- | ---- | -------------- |
| hospitalTreatId         | 否   | string   | 32   | 线下就诊id     |
| hospitalPrescriptionIds | 是   | string[] |      | 线下处方id集合 |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |        含义        |                      说明                      |
|------|------------|--------------------|------------------------------------------------|
| 6201 |        200 | 就诊信息不存在     | 要查询的就诊信息不存在                         |
| 6311 |        200 | 药品处方信息不存在 | 传递的药品处方参数含有未在本次就诊里的药品处方 |


#### 药品处方上传[2018.09.30未提供]

**请求URL：**
- https://api.best-seeing.com/v1.1/emr/prescriptions

**请求方式：**
- POST

说明：
1. 本协议同时保存处方与医嘱，且不考虑一个处方有多少个医嘱的问题。
2. 医嘱正文可以不传，也可以将医嘱自行拼接成一定格式的文本
3. 此协议以处方为单位，全量更新
4. 线下和线上不会同时操作，线下同步的数据不允许修改，也不会在web页面展示


**请求报文参数**

| 参数名             | 长度 | 类型         | 必选 | 说明                                      |
| ------------------ | ---- | ------------ | ---- | ----------------------------------------- |
| hospitalTreatId    | 32   | string       | 是   | 线下就诊Id，长度上限：32位英文/16位中文   |
| hospitalPresDepaId | 32   | string       | 是   | 线下开方科室，长度上限：32位英文/16位中文 |
| hospitalPresDoctor | 32   | string       | 是   | 线下开方医生，长度上限：32位英文/16位中文 |
| presTime           |      | Long         | 是   | 开方时间，精确到ms，13位毫秒              |
| presInfos          |      | List<Object> | 是   | 处方信息                                  |

**处方信息**

| 参数名          | 长度 | 类型       | 必填 | 说明                                                         |
| --------------- | ---- | ---------- | ---- | ------------------------------------------------------------ |
| hospitalPresId  | 32   | string     | 是   | 线下处方id，长度上限：32位英文/16位中文                      |
| presType        |      | Integer    | 是   | 处方来源，1：门诊处方 2：出院带病处方                        |
| presCosts       |      | Integer    | 是   | 费用,单位分                                                  |
| presCharges     |      | Integer    | 是   | 实付费用,单位分                                              |
| presChargeState |      | Integer    | 是   | 处方收费状态 （1:未收费;2:已收费;3:已撤销(未收费撤销);4:未退费;5:已退费;6:超时失效） |
| orderText       |      | string     | 否   | 医嘱正文，是页面显示医嘱的文本，不传则按线上的拼接规则展示，线上规则：请查看病历的医嘱 |
| orders          |      | ObjectList | 是   | 医嘱列表                                                     |

**医嘱列表**

| 参数名             | 长度 | 类型    | 必填 | 说明                             |
| ------------------ | ---- | ------- | ---- | -------------------------------- |
| hospitalOrderId    | 32   | string  | 否   | 线下医嘱id                       |
| drugName           | 64   | string  | 是   | 药品名称                         |
| drugSpec           | 32   | string  | 是   | 药品规格                         |
| drugPackSpec       | 32   | string  | 是   | 包装规格或拆分规格               |
| drugPackUnits      | 8    | string  | 是   | 包装单位或拆分单位               |
| drugFreqDescribe   | 40   | string  | 否   | 频率基本描述，3/日               |
| drugDays           |      | Integer | 否   | 执行天数                         |
| drugDosage         |      | Double  | 是   | 一次使用剂量                     |
| drugUsageUnits     | 8    | string  | 是   | 一次使用单位                     |
| drugAdministration | 20   | string  | 是   | 给药途径                         |
| drugUsagPlace      | 20   | string  | 否   | 给药部位                         |
| drugTotalAmount    |      | Integer | 是   | 药品数量，发药时使用，发了多少药 |
| drugPrice          |      | Integer | 否   | 单价，单位分                     |
| drugCosts          |      | Integer | 否   | 费用，单位分                     |
| drugCharge         |      | Integer | 否   | 实付费用，单位分                 |
| drugMemo           | 128  | string  | 否   | 备注                             |


**返回参数说明** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

#### 药品处方删除[2018.09.30未提供]

**请求URL**
- https://api.best-seeing.com/v1.1/emr/prescriptions/delete_with_ids

**请求报文参数**

|  参数名   |  长度 |    类型    | 必选 |   说明   |
|-----------|------------|------|----------|----------|
| hospitalTreatId | 32 | string | 是    | 线下就诊Id |
| hospitalPresIds | 32 | List<string> | 是| 线下处方id列表，可传多个 |

**回复报文参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 无     |      |      |      |

#### 同步诊断字典[2018.09.30未提供]

**简要描述：**

用户线下提交诊断名称，维护线上诊断名称数据

**使用说明：**

提供必要的参数

**请求URL：**

- https://api.best-seeing.com/v1.0/emr/diagnose/name

**请求方式：**

- POST

**请求参数说明：** 

| 参数名             | 必选 | 类型         | 说明                                                         |
| ------------------ | ---- | ------------ | ------------------------------------------------------------ |
| hospitalDiagnoseId | 是   | string       | 线下标准诊断id                                               |
| diagnoseIcd        | 是   | string       | ICD编码                                                      |
| diagnoseAttach     | 否   | string       | 附加码                                                       |
| diagnoseName       | 是   | string       | 标准诊断名称                                                 |
| diagnoseSort       | 否   | int          | 排序编号，优先级从大到小                                     |
| diagnoseOphthal    | 是   | int          | 眼科诊断类型，0-不是眼科诊断；1-是普通眼科诊断；2-双眼视功能的眼科诊断' |
| hospitalUserId     | 否   | string       | 线下诊断操作用户id,表明创立或修改诊断名称的用户              |
| enable             | 否   | int          | 是否有效，0-停用；1-有效,默认1有效                           |
| aliasNames         | 是   | list<string> | 诊断别名                                                     |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

#### 禁用诊断字典[2018.09.30未提供]

**简要描述：**

应用场景为线下删除诊断名称，此时将会禁用对应的所有诊断和别名

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/diagnose/delete_name

**请求方式：**
- POST

**请求参数说明：** 

| 参数名             | 必选 | 类型   | 说明                        |
| ------------------ | ---- | ------ | --------------------------- |
| hospitalDiagnoseId | 是   | string | 线下诊断标准诊断Id          |
| hospitalUserId     | 否   | string | 诊断操作用户id,表明修改人id |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      含义      |          说明          |
|------|------------|----------------|------------------------|
| 6212 |        200 | 诊断名称不存在 | 要删除的诊断名称不存在 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述


#### 同步诊断前后缀字典[2018.09.30未提供]

**简要描述：**

应用场景为线下同步诊断前后缀来进行诊断库的维护

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/diagnose/append

**请求方式：**
- POST

**请求参数说明：** 

|     参数名     | 必选 |  类型  |                           说明                           |
|----------------|------|--------|----------------------------------------------------------|
| appendName     | 是   | string | 附属信息，即前后缀名称，平台将根据名称作为唯一性标识查询 |
| appendType     | 是   | string | 附属信息类型，前缀=1, 后缀=2                             |
| diagnoseSort   | 否   | int    | 排序编号，优先级从大到小                                 |
| hospitalUserId | 否   | string | 用户id,表明创立或修改附属信息的用户                      |
| enable         | 否   | int    | 是否有效，0-停用；1-有效,默认1有效                       |
| appendMemo     | 否   | string | 备注                                                     |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

#### 删除诊断前后缀字典[2018.09.30未提供]

**简要描述：**

应用场景为线下删除诊断前后缀

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/diagnose/delete_append

**请求方式：**
- POST

**请求参数说明：** 

|     参数名     | 必选 |   类型  |                           说明                           |
|----------------|------|---------|----------------------------------------------------------|
| appendName     | 是   | string  | 附属信息，即前后缀名称，平台将根据名称作为唯一性标识查询 |
| appendType     | 是   | Integer | 诊断类型：前缀=1, 后缀=2                                 |
| hospitalUserId | 否   | string  | 诊断操作用户id,表明修改人id                              |

**返回参数说明：** 

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |       含义       |           说明           |
|------|------------|------------------|--------------------------|
| 6213 |        200 | 诊断前后缀不存在 | 要删除的诊断前后缀不存在 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 结束就诊

**简要描述：**

结束本次就诊，结束就诊后本次就诊的数据不允许再进行修改。
本协议没有传输结束就诊时间、医生、科室，时间使用本协议调用时间，医生与科室使用本次就诊医生与科室。

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/emr/treatment/finish

**请求方式：**
- POST

**请求参数说明：** 

|     参数名      | 必选 |  类型  |    说明    |
|-----------------|------|--------|------------|
| treatId         | 否   | long   | 线上就诊id |
| hospitalTreatId | 是   | string | 线下就诊Id |

**返回参数说明：** 

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      含义      |      说明      |
|------|------------|----------------|----------------|
| 6201 |        200 | 就诊信息不存在 | 就诊信息不存在 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述


## 六、ERP相关

### 查询类

#### 查询患者配镜单列表

**简要描述：**

为接入用户提供了根据病人id与收费状态查询线上配镜单的功能。

**使用说明：**

提供必要的参数

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBills

**请求方式：**
POST

**请求参数说明：** 

|   参数名    | 必选 |  类型  |                     说明                     |
|-------------|------|--------|----------------------------------------------|
| hospitalPid | 是   | string | 病人id                                       |
| result      | 否   | int    | 1-待付款;2-已付款;3-已撤销;4-待退费;5-已退费 |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | list   | 返回数据 |

| 参数名 | 类型 |    说明    |
|--------|------|------------|
| orders | list | 配镜单列表 |

orders中的对象格式

|   参数名    |  类型  |                       说明                       |
|-------------|--------|--------------------------------------------------|
| pid         | long   | 线上病人id                                       |
| hospitalPid | string | 线上病人id                                       |
| saleTime    | long   | 销售时间, unixtime格式                           |
| saleId      | long   | 配镜单号                                         |
| status      | int    | 状态1-待付款;2-已付款;3-已撤销;4-待退费;5-已退费 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      说明      |
|------|------------|----------------|
| 6103 |        200 | 患者信息不存在 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 配镜单详情####

**简要描述：**

为接入用户提供了查询配镜单详情的功能

**使用说明：**

提供必要的参数

**额外说明:**

本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBillsItems/{tradeId}

**请求方式：**
GET

**请求参数说明：** 

| 参数名  | 必选 | 类型 |      说明      |
|---------|------|------|----------------|
| tradeId | 是   | Long | 销售单配镜单ID |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

|    参数名    | 类型 |      说明      |
|--------------|------|----------------|
| saleItemList | list | 销售单细目详情 |

saleItemList

|     参数名     |   类型  |                  说明                 |
|----------------|---------|---------------------------------------|
| saleNo         | string  | 销售单号                              |
| id             | long    | 细目id                                |
| goodName       | string  | 商品名称                              |
| goodCode       | string  | 商品编码                              |
| price          | double  | 原单价                                |
| currentPrice   | double  | 现单价： 销售单价                     |
| number         | int     | 数量                                  |
| totalPrice     | double  | 原总价                                |
| realPrice      | double  | 实际总价                              |
| financialPrice | double  | 财务价格                              |
| odos           | int     | 定做眼别：默认:0;0-无眼别;1-OD;2-OS   |
| purchase       | int     | 订购标志：0;0-不需定购;1-需定购;      |
| process        | int     | 加工标志 默认:0;0-不需加工;1-需内加工 |
| remark         | string  | 备注                                  |
| hasFavor       | Integer | 是否有优惠  默认:0;0-没有;1-有        |
| favorfee       | Integer | 优惠金额  单位分                      |
| apportion      | Integer | 优惠分摊金额 单位分                   |
| purcPropety    | string  | 定做属性                              |
| isDel          | integer | 删除标记 默认:0;0-不删除;1-删除       |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

| 值 | HTTP状态码 | 说明 |
|----|------------|------|
|    |            |      |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 定做商品查询

**简要描述：**

为接入用户提供了查询定做商品的功能，该接口为定做商品批量入库接口提供了销售单细目id的查询

**使用说明：**

提供必要的参数

**额外说明:**
无

**请求URL：**
- https://api.best-seeing.com/v1.1/erp/bookGoods/{saleNo}


**请求方式：**
GET

**请求参数说明：** 

| 参数名 | 必选 |  类型  | 说明 |
|--------|------|--------|------|
| saleNo | 是   | string |      |

**返回参数说明：**

| 参数名 |  类型  |     说明     |
|--------|--------|--------------|
| code   | string | 状态码       |
| msg    | string | 状态信息     |
| data   | object | 返回数据集合 |

data内容

|  参数名  | 类型 |     说明     |
|----------|------|--------------|
| goodList | list | 返回数据集合 |

goodList 内容

|  参数名  |  类型  |               说明              |
|----------|--------|---------------------------------|
| goodId   | long   | 商品id                          |
| goodName | string | 商品名称                        |
| goodCode | string | 商品编码                        |
| number   | int    | 数量                            |
| remark   | string | 定做商品备注                    |
| odos     | int    | 眼别：默认:0;0-无眼别;1-OD;2-OS |
| property | string | 定做商品参数                    |
| itemId   | Long   | 定做销售单id                    |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

| 值 | HTTP状态码 | 说明 |
|----|------------|------|
|    |            |      |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 定做商品状态查询

**简要描述：**

提供定做商品分摊后（已收费的）的列表查询，以支持一个销售单中定做商品入库可以跟踪到第小的颗粒度。

**使用说明：**

提供必要的参数

**额外说明:**
无

**请求URL：**
- https://api.best-seeing.com/v1.1/erp/bookGoods/detail/{saleNo}


**请求方式：**
GET

**请求参数说明：** 

| 参数名 | 必选 |  类型  | 说明 |
|--------|------|--------|------|
| saleNo | 是   | string |      |

**返回参数说明：**

| 参数名 |  类型  |     说明     |
|--------|--------|--------------|
| code   | string | 状态码       |
| msg    | string | 状态信息     |
| data   | object | 返回数据集合 |

data内容

|  参数名  | 类型 |     说明     |
|----------|------|--------------|
| goodList | list | 返回数据集合 |

goodList 内容

|  参数名   |  类型  |               说明              |
|-----------|--------|---------------------------------|
| goodId    | long   | 商品id                          |
| goodName  | string | 商品名称                        |
| goodCode  | string | 商品编码                        |
| number    | int    | 数量：永远是1                   |
| remark    | string | 定做商品备注                    |
| odos      | int    | 眼别：默认:0;0-无眼别;1-OD;2-OS |
| property  | string | 定做商品参数                    |
| saleId    | Long   | 定做销售单id                    |
| stateId   | Long   | 物资状态id                      |
| isInStore | int    | 是否已经入库：0没入库 1：已入库 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

| 值 | HTTP状态码 | 说明 |
|----|------------|------|
|    |            |      |


### 操作类

#### 定做商品预校验（温州眼视光医院专用）

**简要描述：**

为接入用户提供了提供了批发定做商品前的参数逻辑校验工作，判断要入库前数量商品等是否匹配（具体商品可以少，但不能超）。

**使用说明：**

提供必要的参数

**额外说明:**

本接口是校验一下某笔销售单细目中定做商品的数量是否满足入库需求，比如销售单子单中只开了3件定做A商品，若传一开始传超过3件A商品或者已经到货了2件A商品，超过大于1件A商品都会不通过校验。

** 请求URL：**
- https://api.best-seeing.com/v1.1/erp/bookGoods/check

**请求方式：**
POST

**请求参数说明：** 

|         参数名          | 必选 |  类型  |      说明      |
|-------------------------|------|--------|----------------|
| supplyNo                | 否   | string | 供货单号       |
| inDepotId               | 否   | long   | 入库的仓库id   |
| inRemark                | 否   | string | 入库备注       |
| supplierNo              | 否   | string | 供应商编号     |
| inUserId                | 否   | long   | 线上制单人id   |
| inHospitalUserJobnumber | 否   | string | 线下制单人工号 |
| goodsList               | 是   | list   | 商品列表       |

商品列表说明

|    参数名     |   类型  | 必填 |       说明      |
|---------------|---------|------|-----------------|
| goodCode      | string  | 是   | 商品编码        |
| number        | Integer | 是   | 入库数量        |
| purchasePrice | Double  | 是   | 入库时进价      |
| validDate     | long    | 否   | 有效期 unixtime |
| batchNo       | string  | 否   | 生产批号        |
| factory       | string  | 否   | 生产商编号      |
| registerNo    | string  | 是   | 注册证号        |
| tradeId       | Long    | 否   | 订单号，不必传  |
| itemId        | Long    | 是   | 销售单子表id    |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

``` java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |            说明            |
|------|------------|----------------------------|
| 6334 |        200 | 商品对应的配镜单不存在     |
| 6335 |        200 | 商品数量不正确             |
| 6336 |        200 | 商品编码不正确             |
| 6337 |        200 | 没有定做需要               |
| 6338 |        200 | 超过需要数量               |
| 6339 |        200 | 定做采购制单人不存在       |
| 6340 |        200 | 批发入库的部门不存在       |
| 6341 |        200 | 未付款商品无法定做采购入库 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 定做商品批量入库（温州眼视光医院专用）

**简要描述：**

为接入用户提供了批量将定做商品插入到仓库中的功能

**使用说明：**

提供必要的参数

**额外说明:**

本接口是批量进行定做商品的入库

**请求URL：**
- https://api.best-seeing.com/v1.1/erp/bookGoods/in

**请求方式：**
POST

**请求参数说明：** 

|         参数名          | 必选 |  类型  |                                       说明                                      |
|-------------------------|------|--------|---------------------------------------------------------------------------------|
| supplyNo                | 是   | string | 供货单号                                                                        |
| billDepaId              | 是   | long   | 采购部门ID，由采购部门id默认值来传(新Erp多出来的字段，为一个采购部门ID的默认值) |
| inDepotId               | 是   | long   | 入库的仓库id                                                                    |
| inRemark                | 否   | string | 入库备注                                                                        |
| supplierNo              | 是   | string | 供应商编号                                                                      |
| billAgent               | 是   | Long   | 代理商Id                                                                        |
| inUserId                | 否   | long   | 线上制单人id                                                                    |
| inHospitalUserJobnumber | 是   | string | 线下制单人工号                                                                  |
| goodsList               | 是   | list   | 商品列表                                                                        |

商品列表说明

|    参数名     |   类型  | 必填 |        说明       |
|---------------|---------|------|-------------------|
| goodCode      | string  | 是   | 商品编码          |
| number        | Integer | 是   | 入库数量          |
| purchasePrice | Double  | 是   | 入库时进价        |
| validDate     | long    | 否   | 有效期 unixtime   |
| batchNo       | string  | 否   | 生产批号          |
| factory       | string  | 否   | 生产商名称        |
| registerNo    | string  | 是   | 注册证号          |
| tradeId       | long    | 否   | 订单号            |
| productDate   | long    | 否   | 生产日期 unixtime |
| remark        | string  | 否   | 入库备注          |
| itemId        | long    | 是   | 销售单子表id      |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

| 参数名 | 类型 | 说明 |
|--------|------|------|
|        |      |      |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      说明      |
|------|------------|----------------|
| 6321 |        200 | 仓库不存在     |
| 6322 |        200 | 供应商不存在   |
| 6323 |        200 | 制单人不存在   |
| 6324 |        200 | 商品列表为空   |
| 6325 |        200 | 商品数量不正确 |
| 6326 |        200 | 商品编码不正确 |
| 6327 |        200 | 销售单不存在   |
| 6328 |        200 | 存在未销售     |

**备注** 

- 更多返回错误代码请看首页的错误代码描述


#### 定做商品批量入库

**简要描述：**

为接入用户提供了批量将定做商品插入到仓库中的功能，以定做商品状态查询的结果做为单位进行入库。

**使用说明：**

提供必要的参数

**额外说明:**

本接口是批量进行定做商品的入库

**请求URL：**
- https://api.best-seeing.com/v1.2/erp/bookGoods/in

**请求方式：**
POST

**请求参数说明：** 

|         参数名          | 必选 |  类型  |                                       说明                                      |
|-------------------------|------|--------|---------------------------------------------------------------------------------|
| supplyNo                | 是   | string | 供货单号                                                                        |
| billDepaId              | 是   | long   | 采购部门ID，由采购部门id默认值来传(新Erp多出来的字段，为一个采购部门ID的默认值) |
| inDepotId               | 是   | long   | 入库的仓库id                                                                    |
| inRemark                | 否   | string | 入库备注                                                                        |
| supplierNo              | 是   | string | 供应商编号                                                                      |
| billAgent               | 是   | Long   | 代理商Id                                                                        |
| inUserId                | 否   | long   | 线上制单人id                                                                    |
| inHospitalUserJobnumber | 是   | string | 线下制单人工号                                                                  |
| goodsList               | 是   | list   | 商品列表                                                                        |

商品列表说明

|    参数名     |   类型  | 必填 |        说明       |
|---------------|---------|------|-------------------|
| goodCode      | string  | 是   | 商品编码          |
| purchasePrice | Double  | 是   | 入库时进价        |
| validDate     | long    | 否   | 有效期 unixtime   |
| batchNo       | string  | 否   | 生产批号          |
| factory       | string  | 否   | 生产商名称        |
| registerNo    | string  | 是   | 注册证号          |
| tradeId       | long    | 否   | 订单号            |
| productDate   | long    | 否   | 生产日期 unixtime |
| remark        | string  | 否   | 入库备注          |
| saleId      | long    | 否 | 销售单id      |
| stateId        | long    | 是   | 物资状态id：跟踪定做商品的入库状态 |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

| 参数名 | 类型 | 说明 |
|--------|------|------|
|        |      |      |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```


#### 批量采购入库####

**简要描述：**

为接入用户提供了批量将商品插入到仓库中的功能

**使用说明：**

提供必要的参数

**额外说明:**

本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/goods/in

**版本说明**

| 版本号 |                            说明                            |
|--------|------------------------------------------------------------|
|    1.0 | [温医专用](http://192.68.75.22/index.php?s=/1&page_id=139) |
|    1.1 | [公用](http://192.68.75.22/index.php?s=/1&page_id=139)     |

**请求方式：**
POST

**请求参数说明：** 

|         参数名          | 必选 |  类型  |      说明      |
|-------------------------|------|--------|----------------|
| supplyNo                | 是   | string | 供货单号       |
| inDepotId               | 是   | long   | 入库的仓库id   |
| inRemark                | 否   | string | 入库备注       |
| supplierNo              | 是   | string | 供应商编号     |
| billAgent               | 是   | Long   | 代理商Id       |
| inUserId                | 否   | long   | 线上制单人id   |
| inHospitalUserJobnumber | 是   | string | 线下制单人工号 |
| goodsList               | 是   | list   | 商品列表       |

商品列表说明

|    参数名     |   类型  | 必填 |        说明       |
|---------------|---------|------|-------------------|
| goodCode      | string  | 是   | 商品编码          |
| number        | Integer | 是   | 入库数量          |
| purchasePrice | Double  | 是   | 入库时进价        |
| validDate     | long    | 否   | 有效期 unixtime   |
| batchNo       | string  | 否   | 生产批号          |
| factory       | string  | 否   | 生产商名称        |
| registerNo    | string  | 是   | 注册证号          |
| productDate   | long    | 否   | 生产日期 unixtime |
| remark        | string  | 否   | 备注              |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

| 参数名 | 类型 | 说明 |
|--------|------|------|
|        |      |      |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |      说明      |
|------|------------|----------------|
| 6321 |        200 | 仓库不存在     |
| 6322 |        200 | 供应商不存在   |
| 6323 |        200 | 制单人不存在   |
| 6324 |        200 | 商品列表为空   |
| 6325 |        200 | 商品数量不正确 |
| 6326 |        200 | 商品编码不正确 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 收费前置校验####

**简要描述：**

该接口是医院进行收费前，先调用此接口访问平台，该笔订单是否允许收费。

**使用说明：**

提供必要的参数

**额外说明:**

本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBill/payCheck/{tradeId}

**请求方式：**
- GET

**请求参数说明：** 

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
|        |      |      |      |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

| 参数名 |  类型  |              说明              |
|--------|--------|--------------------------------|
| isPass | int    | 是否通过校验: 0:未通过 1：通过 |
| reason | string | 未通过的原因                   |

data内容标准示例

| isPass |     reason     |
|--------|----------------|
|      1 | 该单可以付款   |
|      0 | 该单已经付款   |
|      0 | 该单已撤销作废 |
|      0 | 该单正在退费中 |
|      0 | 该单已退费     |

**返回示例**

```java
{
"code":1000,
"msg":"调用成功",
"data":{}
}
```

**错误码**

#### 收费成功上报

**简要描述：**

该接口是线下完成收费后，将收费成功状态告诉平台。

**使用说明：**
提供必要的参数

**额外说明:**
本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBill/payStatus

**请求方式：**
POST

**请求参数说明：** 

| 参数名  |  类型  | 必填 |                   说明                   |
|---------|--------|------|------------------------------------------|
| tradeId | long   | 是   | 订单表的charId                           |
| message | string | 否   | 操作结果描述                             |
| type    | int    | 是   | 收费类型: 1-视光销售单;2-挂号;3-药品处方 |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |               说明               |
|------|------------|----------------------------------|
| 6324 |        200 | 收费状态同步的请求的销售单不存在 |
| 6325 |        200 | 单据已作废，无法继续收费         |
| 6326 |        200 | 单据待退费，无法继续收费         |
| 6327 |        200 | 单据已退费，无法继续收费         |
| 6328 |        200 | 单据已付费，无法继续收费         |
| 6329 |        200 | 非待缴费状态不允许修改收费状态   |
| 6330 |        200 | 商品有调价，不允许修改收费状态   |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 退费前置校验（温州眼视光医院专用）

**简要描述:**

为租户提供退费前的查询功能，以确定当前这个销售单是否可以退费（所有的商品已经退回仓库）。

**使用说明：**

提供必要的参数

**额外说明:**

本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBill/refundCheck/{tradeId}

**请求方式：**
- GET

**请求参数说明：** 

路径参数

| 参数名  | 类型 | 必填 |         说明         |
|---------|------|------|----------------------|
| tradeId | long | 是   | 结算单ID或线下订单ID |

报文参数 

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 无     |      |      |      |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**错误码**

| 值   | HTTP状态码 | 说明                                                         |
| ---- | ---------- | ------------------------------------------------------------ |
| 6331 | 200        | 销售单不存在                                                 |
| 6332 | 200        | 销售单制单人不存在或销售人部门信息不存在（销售部门应医院要求去掉了校验） |
| 6333 | 200        | 非退费状态不允许操作                                         |
| 6342 | 200        | 订单不存在                                                   |

返回示例

```java
{
"code":6331,
"msg":"销售单不存在",
"data":{}
}
```



#### 退费状态上报（温州眼视光医院专用）

**简要描述：**

为接入用户提供了将收费状态变为退费同步到线上去更新销售单的状态，如果线下退费失败的，请千万不要调用本接口。

**使用说明：**

提供必要的参数

**额外说明:**

本接口由温医特殊的业务视光批发衍生，并不能保证每个租户都会使用到这个接口

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/saleBill/refund

**请求方式：**
POST

**请求参数说明：** 

| 参数名  | 类型 | 必填 |         说明         |
|---------|------|------|----------------------|
| tradeId | long | 是   | 结算单ID或线下订单ID |


**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

data内容

| 参数名 | 类型 | 说明 |
|--------|------|------|

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

|  值  | HTTP状态码 |                   说明                   |
|------|------------|------------------------------------------|
| 6331 |        200 | 销售单不存在                             |
| 6332 |        200 | 销售单制单人不存在或销售人部门信息不存在 |
| 6333 |        200 | 非退费状态不允许操作                     |
| 6342 |        200 | 订单不存在                               |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

### 事件类：（线上->线下）###

#### 事件获取接口####

**简要描述：**

该接口是线下用户主动获取线上事件消息的接口，每次调用都可以获取到一个线上事件队列里的一个消息。此接口的建议使用方式是采用定时器不断去轮询获取，至于间隔推荐5ms-20ms。

根据事件信息的类型和对应业务数据进行不同处理：

|   事件类型   |      事件编码      |    业务数据    |       调用医院接口       | 需要回调的接口 |
|--------------|--------------------|----------------|--------------------------|----------------|
| 卡查询患者   | CARD_QUERY_PATIENT | 卡信息（卡号） | 根据卡号查询患者         | 卡信息同步     |
| 订单状态查询 | ORDER_STATUS_QUERY | 销售单id       | 查询订单状态             | 订单状态同步   |
| 优惠查询     | DISCOUNT_QUERY     | 线下患者id     | 查询是否有视光矫正费缴费 | 优惠信息同步   |
| 新增订单     | ADD_NEW_ORDER      | 订单信息       | 订单信息同步             | 无             |
| 订单作废     | ORDER_INVALID      | 线下订单号     | 订单作废                 | 无             |

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/rolling

**请求方式：**
- POST

**请求参数说明：**

| 参数名 | 类型 |                    说明                   |
|--------|------|-------------------------------------------|
| type   | int  | 从哪个队列获取，1 表示正常队列 0 失败队列 |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | number | 状态码   |
| msg    | string | 状态信息 |
| data   | JSON   | 返回数据 |

**data内容**

| 参数名  |  类型  |    说明    |
|---------|--------|------------|
| id      | string | 事件记录id |
| type    | string | 事件类型   |
| bizData | json   | 业务数据   |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**bizData数据列表**

以下根据不同的type所返回的不同bizData的值。

##### 刷卡读取患者信息事件

当 data中的type=CARD_QUERY_PATIENT 的时候，bizData数据内容如下

|  参数名  |  类型  |         说明        |
|----------|--------|---------------------|
| cardInfo | string | 卡信息              |
| type     | string | 1：磁条卡 2：芯片卡 |

##### 新增订单事件

当data中的 type=ADD_NEW_ORDER 的时候，bizData数据内容如下

| 参数名   | 类型   | 说明                |
| -------- | ------ | ------------------- |
| orderInfo | object | 订单信息              |

orderInfo

|      参数名      |   类型  |                      说明                     |
|------------------|---------|-----------------------------------------------|
| totalAmount      | Integer | 总金额,单位是分                               |
| hospitalPid      | string  | 线下患者id                                    |
| hospitalDrCode   | string  | 开单线下医生工号                              |
| hospitalDeptCode | string  | 开单线下部门编号                              |
| tradeId          | long    | 订单号                                        |
| tradeType        | int     | 订单类型 : 1-视光销售单  2-挂号; 3-药品医嘱。 |

##### 查询订单事件

当data中的 type=ORDER_STATUS_QUERY 的时候，bizData数据内容如下


|  参数名   | 类型 |                      说明                     |
|-----------|------|-----------------------------------------------|
| tradeId   | long | 线上订单id                                    |
| tradeType | int  | 订单类型 : 1-视光销售单  2-挂号; 3-药品医嘱。 |

##### 查询优惠信息事件

当data中的 type=DISCOUNT_QUERY 的时候，bizData数据内容如下


|   参数名    | 类型 |    说明    |
|-------------|------|------------|
| hospitalPid | long | 线下病人id |

##### 订单作废事件 

当data中的 type= ORDER_INVALID 的时候，bizData数据内容如下

|      参数名      |  类型  |                      说明                     |
|------------------|--------|-----------------------------------------------|
| tradeId          | long   | 订单号                                        |
| tradeType        | int    | 订单类型 : 1-视光销售单  2-挂号; 3-药品医嘱。 |
| hospitalDrCode   | string | 开单线下医生工号                              |
| hospitalDeptCode | string | 开单线下部门编号                              |

##### 验光数据产生事件

当data中的 type= ADD_NEW_OPTOMETRY 的时候，bizData数据内容如下

|       参数名        |  类型  |                     说明                     |
|---------------------|--------|----------------------------------------------|
| optometryTreatData  | object | 验光的就诊相关信息                           |
| emrPresData         | object | 视光处方数据                                 |
| computer            | object | 电脑验光数据                                 |
| Retinoscopy         | object | 主觉验光数据，这里居然是**大写**！！！！留意 |
| subjective          | object | 检影验光                                     |
| presbyopicadd       | object | 近附加                                       |
| emrCornealCurvature | object | 角膜曲率                                     |

optometryTreatData格式

|      参数名       |  类型  |    说明    |
|-------------------|--------|------------|
| doctorId          | long   | 线上医生id |
| hospitalDoctorId  | string | 线下医生id |
| deptId            | long   | 线上部门id |
| hospitalDeptId    | string | 线下部门id |
| treatId           | long   | 线上就诊id |
| hospitalTreatId   | string | 线下就诊id |
| patientId         | long   | 病人id     |
| hospitalPatientId | string | 线下病人id |

emrPresData格式

|     参数名     |     类型     |           说明           |
|----------------|--------------|--------------------------|
| framepres      | object       | 框架眼镜处方             |
| contactpres    | object       | 隐形眼镜处方             |
| rgppres        | object       | 线上部门id               |
| orthokpres     | list<object> | ok镜处方                 |
| orthokparas    | list<object> | ok镜参数                 |
| others         | list<object> | 其他处方                 |
| hasOther       | bool         | 是否曾经开过其他处方标志 |
| hospitalDoctId | string       | 线下开方医生id           |
| doctId         | long         | 开方医生id               |
| changeTime     | long         | 处方修改时间             |

framepres格式

|        参数名         |  类型  |     说明    |
|-----------------------|--------|-------------|
| opto_far_pd           | string | 瞳距-远用   |
| opto_near_pd          | string | 瞳距-近用   |
| opto_od_pd            | string | 瞳距-单眼OD |
| opto_os_pd            | string | 瞳距-单眼OS |
| opto_od_ph            | string | 瞳高-OD     |
| opto_os_ph            | string | 瞳高-OS     |
| opto_pd_rem           | string | 瞳距-备注   |
| opto_far_od_sphere    | string | 远用OD-球镜 |
| opto_far_od_cylinder  | string | 远用OD-柱镜 |
| opto_far_od_axis      | string | 远用OD-轴向 |
| opto_far_od_prism     | string | 远用OD-棱镜 |
| opto_far_od_vision    | string | 远用OD-视力 |
| opto_far_od_memo      | string | 远用OD-备注 |
| opto_far_os_sphere    | string | 远用OS-球镜 |
| opto_far_os_cylinder  | string | 远用OS-柱镜 |
| opto_far_os_axis      | string | 远用OS-轴向 |
| opto_far_os_prism     | string | 远用OS-棱镜 |
| opto_far_os_vision    | string | 远用OS-视力 |
| opto_far_os_memo      | string | 远用OS-备注 |
| opto_near_od_sphere   | string | 近用OD-球镜 |
| opto_near_od_cylinder | string | 近用OD-柱镜 |
| opto_near_od_axis     | string | 近用OD-轴向 |
| opto_near_od_prism    | string | 近用OD-棱镜 |
| opto_near_od_vision   | string | 近用OD-视力 |
| opto_near_od_memo     | string | 近用OD-备注 |
| opto_near_os_sphere   | string | 近用OS-球镜 |
| opto_near_os_cylinder | string | 近用OS-柱镜 |
| opto_near_os_axis     | string | 近用OS-轴向 |
| opto_near_os_prism    | string | 近用OS-棱镜 |
| opto_near_os_vision   | string | 近用OS-视力 |
| opto_near_os_memo     | string | 近用OS-备注 |
| hospitalOptoChanUser  | string | 线下医生id  |

contactpres格式

|        参数名        |  类型  |       说明      |
|----------------------|--------|-----------------|
| opto_od_sphere       | string | 隐形眼镜OD-球镜 |
| opto_od_cylinder     | string | 隐形眼镜OD-柱镜 |
| opto_od_axis         | string | 隐形眼镜OD-轴向 |
| opto_od_memo         | string | 隐形眼镜OD-备注 |
| opto_os_sphere       | string | 隐形眼镜OS-球镜 |
| opto_os_cylinder     | string | 隐形眼镜OS-柱镜 |
| opto_os_axis         | string | 隐形眼镜OS-轴向 |
| opto_os_memo         | string | 隐形眼镜OS-备注 |
| hospitalOptoChanUser | string | 线下医生id      |

rgppres格式

|       参数名       |  类型  |    说明   |
|--------------------|--------|-----------|
| rgp_od_brand_id    | Long   | OD-品牌id |
| rgp_od_brand       | string | OD-品牌   |
| rgp_od_material_id | Long   | OD-材质id |
| rgp_od_material    | string | OD-材质   |
| rgp_od_curve       | string | OD-基弧   |
| rgp_od_curve2      | string | OD-基弧2  |
| rgp_od_diameter    | string | OD-直径   |
| rgp_od_degree      | string | OD-度数   |
| rgp_od_degree2     | string | OD-度数2  |
| rgp_od_rem         | string | OD-备注   |
| rgp_os_brand_id    | Long   | OS-品牌id |
| rgp_os_brand       | string | OS-品牌   |
| rgp_os_material_id | Long   | OS-材质id |
| rgp_os_material    | string | OS-材质   |
| rgp_os_curve       | string | OS-基弧   |
| rgp_os_curve2      | string | OS-基弧2  |
| rgp_os_diameter    | string | OS-直径   |
| rgp_os_degree      | string | OS-度数   |
| rgp_os_degree2     | string | OS-度数2  |
| rgp_os_rem         | string | OD-备注   |
| hospitalChanUser  | string |线下医生id   |


orthokpres 格式

|        参数名        |   类型  |                   说明                  |
|----------------------|---------|-----------------------------------------|
| orth_times           | Integer | 哪次试戴，第几次试镜得结果，从1开始记的 |
| orth_od_brand_id     | string  | OD-品牌id，右眼镜片品牌id               |
| orth_od_brand        | string  | OD-品牌，右眼镜片品牌名称               |
| orth_od_rem          | string  | OD-备注                                 |
| orth_os_brand_id     | string  | OS-品牌id，左眼镜片品牌id               |
| orth_os_brand        | string  | OS-品牌，左眼镜片品牌名称               |
| orth_os_rem          | string  | OS-备注                                 |
| hospitalOrthChanUser | string  | ok镜线下医生id                          |

orthokparas格式

|     参数名     |  类型  |    说明    |
|----------------|--------|------------|
| para_prop_id   | Long   | 属性码ID   |
| para_prop_name | string | 属性名称   |
| para_choi_id   | Long   | 属性值ID   |
| para_choi_code | string | 属性值代码 |
| para_value     | string | 属性值     |

others 格式

|     参数名      |   类型  |     说明     |
|-----------------|---------|--------------|
| othe_clas_id    | Long    | 商品类别ID   |
| othe_clas_code  | string  | 商品类别代码 |
| othe_goods_id   | Long    | 商品ID       |
| othe_goods_name | string  | 商品名称     |
| othe_count      | Integer | 这商品的数量 |
| othe_goods_unit | string  | 商品单位     |
| othe_rem        | string  | 备注         |

computer格式

|      参数名      |  类型  |     说明     |
|------------------|--------|--------------|
| data_od_sphere   | string | 右眼球镜     |
| data_od_cylinder | string | 右眼柱镜     |
| data_od_axis     | string | 右眼轴向     |
| data_od_rem      | string | 右眼备注     |
| data_os_sphere   | string | 左眼球镜     |
| data_os_cylinder | string | 左眼柱镜     |
| data_os_axis     | string | 左眼轴向     |
| data_os_rem      | string | 左眼备注     |
| hospitalChanUser | string | 线下验光人id |

Retinoscopy 格式

|      参数名      |  类型  |       说明      |
|------------------|--------|-----------------|
| data_od_sphere   | string | 主觉验光OD-球镜 |
| data_od_cylinder | string | 主觉验光OD-柱镜 |
| data_od_axis     | string | 主觉验光OD-轴向 |
| data_od_prism    | string | 主觉验光OD-棱镜 |
| data_od_vision   | string | 主觉验光OD-视力 |
| data_od_memo     | string | 主觉验光OD-备注 |
| data_os_sphere   | string | 主觉验光OS-球镜 |
| data_os_cylinder | string | 主觉验光OS-柱镜 |
| data_os_axis     | string | 主觉验光OS-轴向 |
| data_os_prism    | string | 主觉验光OS-棱镜 |
| data_os_vision   | string | 主觉验光OS-视力 |
| data_os_memo     | string | 主觉验光OS-备注 |
| hospitalChanUser | string | 线下检查人id    |

subjective 格式

|      参数名      |  类型  |       说明      |
|------------------|--------|-----------------|
| data_od_sphere   | string | 检影验光OD-球镜 |
| data_od_cylinder | string | 检影验光OD-柱镜 |
| data_od_axis     | string | 检影验光OD-轴向 |
| data_od_vision   | string | 检影验光OD-视力 |
| data_od_memo     | string | 检影验光OD-备注 |
| data_os_sphere   | string | 检影验光OS-球镜 |
| data_os_cylinder | string | 检影验光OS-柱镜 |
| data_os_axis     | string | 检影验光OS-轴向 |
| data_os_vision   | string | 检影验光OS-视力 |
| data_os_memo     | string | 检影验光OS-备注 |
| hospitalChanUser | string | 线下检查人id    |

presbyopicadd 格式

|      参数名      |  类型  |     说明     |
|------------------|--------|--------------|
| dataAdd          | string | 近附加值     |
| hospitalChanUser | string | 线下检查人id |

emrCornealCurvature格式

|      参数名      |  类型  |     必填     |   说明   |
|------------------|--------|--------------|----------|
| data_od_cliffy   | string | 否           | 右眼陡峭 |
| data_od_flat     | string | 否           | 右眼平坦 |
| data_od_axis     | string | 否           | 右眼轴向 |
| data_os_cliffy   | string | 否           | 左眼陡峭 |
| data_os_flat     | string | 否           | 左眼平坦 |
| data_os_axis     | string | 否           | 左眼轴向 |
| hospitalChanUser | string | 线下检查人id |          |

#### 卡信息上报接口

**简要描述：**

当线下接收到刷卡事件后，使用本接口上报这张卡对应的患者信息。

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/patient_binding_card

**请求方式：**
- POST

**请求参数说明：**

|   参数名    |  类型  | 必选 |                               说明                               |
|-------------|--------|------|------------------------------------------------------------------|
| cardInfo    | string | 是   | 卡信息，如果是磁条卡，代表卡号，如果是芯片卡，则为刷卡出来的报文 |
| hospitalPid | string | 否   | 线下患者id，如果根据卡没有查询到，则为null                       |
| type        | int    | 是   | 卡片类型：1磁条卡 2芯片卡                                        |

**返回参数说明：**

| 参数名 | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

#### 订单状态上报

**简要描述：**

当线下接收到查询订单事件后，使用本接口上报收费订单状态。用于线上没有及时调用收费成功上报协议的补偿。

**使用环境**
适配器

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/order_status

**请求方式：**
- POST

**请求参数说明：**

|   参数名    | 类型 | 必选 |                     说明                    |
|-------------|------|------|---------------------------------------------|
| tradeId     | long | 是   | 线上订单id                                  |
| orderStatus | int  | 是   | 订单支付状态，0：未支付 1：已支付 2：已退费 |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

| 值 | HTTP状态码 | 说明 |
|----|------------|------|
|    |            |      |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

#### 优惠信息同步  

**简要描述：**

此接口用于告知线上线下的患者是否参与了优惠活动

**请求URL：**
- https://api.best-seeing.com/v1.0/erp/discount_info

**请求方式：**
- POST

**请求参数说明：**

|    参数名     |  类型  | 必选 |                          说明                         |
|---------------|--------|------|-------------------------------------------------------|
| discountCount | int    | 是   | 优惠次数，如果为0，表明没有优惠，其他数值表示优惠次数 |
| hospitalPid   | string | 是   | 线下患者id                                            |
| promoteId     | long   | 是   | 优惠活动id                                            |

**返回参数说明：**

| 参数名 |  类型  |   说明   |
|--------|--------|----------|
| code   | string | 状态码   |
| msg    | string | 状态信息 |
| data   | object | 返回数据 |

**返回示例**

```java
{
  "code":1000,
  "msg":"调用成功",
  "data":{}
}
```

**错误码**

| 值 | HTTP状态码 |      说明      |
|----|------------|----------------|
|    |            | 患者信息不存在 |

**备注** 

- 更多返回错误代码请看首页的错误代码描述

## 七、数据字典  

### 性别代码  

|值|含义|说明|
|:----:|:----:|:----:|
|0|未知||
|1|男||
|2|女||
|9|未规定项（未指明）|非男女|

### 婚姻状况  
|值|含义|说明|
|:----:|:----:|:----:|
|10|未婚||
|20|已婚||
|21|初婚||
|22|再婚||
|23|复婚||
|30|丧偶||
|40|离婚||
|90|未说明的婚姻状况||

### 文化状况  
|值|含义|说明|
|:----:|:----:|:----:|
|10|研究生||
|12|博士||
|20|本科||
|30|专科||
|40|中专||
|50|技工学校||
|60|高中||
|70|初中||
|80|小学||
|90|文盲或半文盲||


### 证件类别  
|值|含义|说明|
|:----:|:----:|:----:|
|01|居民身份证||
|02|台湾居民来往大陆通行证||
|03|港澳居民身份证||
|04|居民户口簿||
|05|护照||
|06|军官证||
|07|文职干部证||
|08|士兵证||
|09|驾驶执照||
|10|残疾证||
|11|医疗保险证||
|12|出生证明||
|99|其他||

### 就诊卡类别
|值|含义|说明|
|:----:|:----:|:----:|
|01|医院就诊卡||
|02|旧市民卡||
|03|社保卡||


