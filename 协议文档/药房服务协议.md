# 药房服务协议

## 基本信息

端口号：8008
RedisDB：2

## 公共

###计量单位选项列表

> [GET]/drug_service/common/unit_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


| 参数名  | 类型     | 必填   | 说明        |
| ---- | ------ | ---- | --------- |
| key  | String | 否    | 关键字  模糊匹配 |


#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| unit_id   | String | 否    | 单位ID |
| unit_name | String | 是    | 单位名称 |




###药品厂商选项列表

> [GET]/drug_service/common/drug_factory_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |


#### 请求报文参数



| 参数名         | 类型     | 必填   | 说明           |
| ----------- | ------ | ---- | ------------ |
| key         | String | 否    | 关键字    模糊匹配  |
| classify_id | String | 否    | 药品类别ID  精确查询 |
| drug_name   | String | 否    | 药品名称 精确查询    |


#### 回复报文参数

| 参数名            | 类型     | 必填   | 说明     |
| -------------- | ------ | ---- | ------ |
| drug_factoryid | String | 是    | 生产厂家ID |
| drug_factory   | String | 是    | 生产厂家名称 |


###药品供应商选项列表

> [GET]/drug_service/common/drug_supplier_options

####修改更新记录

| 对应版本 | 说明 |
|----------|------|
| V1.3.1   | 新增 |


#### 请求报文参数

#### RequestBody

| 参数名 |  类型  | 必填 |        说明        |
|--------|--------|------|--------------------|
| key    | String | 否   | 关键字    模糊匹配 |

#### 回复报文参数

|     参数名      |  类型  | 必填 |      说明      |
|-----------------|--------|------|----------------|
| drug_supplierid | String | 是   | 药品供应商ID   |
| drug_supplier   | String | 是   | 药品供应商名称 |

### 药房选项列表

> [GET]/drug_service/common/drug_depot_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

| 参数名 |  类型  | 必填 |        说明        |
|--------|--------|------|--------------------|
| key    | String | 否   | 关键字    模糊匹配 |

#### 回复报文参数

|   参数名   |  类型  | 必填 |    说明    |
|------------|--------|------|------------|
| depot_id   | String | 是   | 药品药房ID |
| depot_name | String | 是   | 药房名称   |


###药品类别选项列表

> [GET]/drug_service/common/drug_classfy_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数



| 参数名  | 类型     | 必填   | 说明          |
| ---- | ------ | ---- | ----------- |
| key  | String | 否    | 关键字    模糊匹配 |


#### 回复报文参数

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| classify_id   | String | 否    | 药品类别ID |
| classify_name | String | 否    | 药品类别名称 |


###药品名称选项列表

> [GET]/drug_service/common/drug_name_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### 

| 参数名         | 类型     | 必填   | 说明          |
| ----------- | ------ | ---- | ----------- |
| key         | String | 否    | 关键字    模糊匹配 |
| depot_id    | String | 否    | 药房ID 不传全部   |
| classify_id | String | 否    | 药品类别ID 不传全部 |



#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| drug_name | String | 否    | 药品名称 |



###药品规格选项列表

> [GET]/drug_service/common/drug_spec_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### 

| 参数名  | 类型     | 必填   | 说明          |
| ---- | ------ | ---- | ----------- |
| key  | String | 否    | 关键字    模糊匹配 |


#### 回复报文参数

| 参数名           | 类型     | 必填   | 说明              |
| ------------- | ------ | ---- | --------------- |
| drug_spec_str | String | 否    | 药品规格字符串  如5mg/片 |


###包装规格选项列表

> [GET]/drug_service/common/pack_spec_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数



| 参数名  | 类型     | 必填   | 说明          |
| ---- | ------ | ---- | ----------- |
| key  | String | 否    | 关键字    模糊匹配 |


#### 回复报文参数

| 参数名           | 类型     | 必填   | 说明             |
| ------------- | ------ | ---- | -------------- |
| pack_spec_str | String | 否    | 药品规格字符串  如5片/盒 |


###剂型选项列表


> [GET]/drug_service/common/drug_form_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名  | 类型     | 必填   | 说明          |
| ---- | ------ | ---- | ----------- |
| key  | String | 否    | 关键字    模糊匹配 |


#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| form_id   | String | 是    | 剂型ID |
| form_name | String | 是    | 剂型名称 |

###频次选项列表

> [GET]/drug_service/common/frequency_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名  | 类型     | 必填   | 说明          |
| ---- | ------ | ---- | ----------- |
| key  | String | 否    | 关键字    模糊匹配 |


#### 回复报文参数

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| freq_id       | String | 是    | 频次ID   |
| freq_describe | String | 是    | 执行频率描述 |



###出入库类型选项列表

> [GET]/drug_service/common/inout_mode_options

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名  | 类型      | 必填   | 说明                                 |
| ---- | ------- | ---- | ---------------------------------- |
| type | Integer | 否    | 选择类型    空或0：所有出入库类型  1：入库类型 2：出库类型 |


#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明      |
| --------- | ------ | ---- | ------- |
| mode_id   | String | 是    | 出入库类型ID |
| mode_name | String | 是    | 出入库类型描述 |


###给药途径选项列表

> [GET]/drug_service/common/route_options

给药途径,1-口服;    2-注射;    3-外用

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数



| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |


#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明   |
| ---------- | ------ | ---- | ---- |
| route_id   | String | 是    | 途径ID |
| route_name | String | 是    | 途径名称 |


###给药部位选项列表

> [GET]/drug_service/common/place_options

给药部位,0:无给药部位;1-左眼; 2-右眼; 3-双眼 4其他;

给前端只要 1-左眼; 2-右眼; 3-双眼 4其他;

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |


#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明     |
| ---------- | ------ | ---- | ------ |
| place_id   | String | 是    | 给药部位ID |
| place_name | String | 是    | 给药部位名称 |


###药品目录选项

> [GET]/drug_service/common/drug_dir_options

入库时选择药品目录用该协议
以后盘点时也会用到该协议
注意：这里是目录中的药品目录，而非库存

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 追加：批准文号   |

#### 请求报文参数

#### 

| 参数名         | 类型      | 必填   | 说明          |
| ----------- | ------- | ---- | ----------- |
| key         | String  | 否    | 关键字    模糊匹配 |
| drug_name   | String  | 是    | 药品名称        |
| classify_id | String  | 否    | 药品类别ID      |
| page_size   | Integer | 否    | 每页条数 空表示10条 |
| page_num    | Integer | 否    | 第几页 空表示第1页  |


#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                |
| -------------- | ------- | ---- | ----------------- |
| drug_id        | String  | 是    | 药品ID              |
| drug_spec_id   | String  | 是    | 药品包装规格ID          |
| drug_name      | String  | 是    | 药品名称              |
| drug_spec      | String  | 是    | 药品规格字符串 如40mg/1片  |
| drug_factory   | String  | 是    | 生产厂家名称            |
| drug_pack_info | String  | 是    | 包装规格              |
| drug_sfda_no       | String  | 是    | 批准文号      V1.3.9.2追加        |
| last_bidprice  | Integer | 否    | 最近入库价,单价，单位分      |
| price          | Integer | 是    | 包装规格处方价,销售价单价,单位分 |
| drug_enable    | Integer | 是    | 是否有效标志;0：否；1：是    |
| drug_putin     | Integer | 是    | 是否入库;0：否；1：是      |
| stock_num_str  | String  | 是    | 库存，如5盒3片、3盒、5片    |
| warn_count     | String  | 是    | 预警库存，如5盒          |
| unit_name      | String  | 是    | 单位名称 包装单位         |



### 库存选择药品列表
出库和盘点的药品列表也用该协议
药品类别和名称要级联
```url
   > [GET]/drug_service/common/stock_drug_options
```
#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### 
| 参数名              | 类型      | 必填   | 说明            |
| ---------------- | ------- | ---- | ------------- |
| depot_id         | String  | 是    | 药房id          |
| drug_name        | String  | 否    | 药品名称 不传表示全部   |
| drug_classify_id | String  | 否    | 药品类别id 不传表示全部 |
| page_size        | Integer | 否    | 每页条数 空表示10条   |
| page_num         | Integer | 否    | 第几页 空表示第1页    |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 是    | 药品目录列表 |

##### 药品目录列表

| 参数名                | 类型      | 必填   | 说明                |
| ------------------ | ------- | ---- | ----------------- |
| packspec_id        | String  | 是    | 药品包装规格ID          |
| drug_name          | String  | 是    | 药品名称              |
| drug_supplierid    | String  | 否    | 供应商名称id           |
| drug_supplier      | String  | 否    | 供应商名称             |
| drug_factory       | String  | 是    | 生产厂家名称            |
| drug_spec          | String  | 否    | 药品规格字符串  如5mg/片   |
| pack_spec          | String  | 是    | 包装规格 如40mg*4片[/盒] |
| drug_sfda_no       | String  | 是    | 批准文号              |
| batch_no           | String  | 否    | 产品批号              |
| validity           | String  | 是    | 有效期               |
| packnum            | Integer | 是    | 库存包装数量            |
| pack_unit          | String  | 是    | 包装单位              |
| splitnum           | Integer | 是    | 库存拆分数量            |
| split_unit         | String  | 是    | 拆分单位 如:片          |
| split_count        | Integer | 是    | 一个包装单位可拆分数量       |
| pack_split         | Integer | 是    | 拆分标志              |
| pack_split_price   | Double  | 是    | 拆分价格              |
| pack_last_bidprice | Double  | 是    | 最近入库价（单价 单位元）     |


###部门列表

出库报损出库时，选择部门用此协议

```url
   > [GET]/drug_service/common/dapartment_options
```

#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数



| 参数名  | 类型     | 必填   | 说明   |
| ---- | ------ | ---- | ---- |
| key  | String | 否    | 关键字  |

#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| depa_id   | String | 是    | 部门ID |
| depa_name | String | 是    | 部门名称 |


### 员工列表

出库报损出库时，选择报损人员时用此协议

```url
   > [GET]/drug_service/common/user_options
```

#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### 

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| key     | String | 否    | 关键字  |
| depa_id | String | 否    | 部门ID |

#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| user_id   | String | 是    | 员工ID |
| user_name | String | 是    | 员工名称 |


##药房基础设置-药品药房


### 药品药房列表  

> [GET]/drug_service/drug_depot/list

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### 

| 参数名       | 类型      | 必填   | 说明          |
| --------- | ------- | ---- | ----------- |
| key       | String  | 否    | 关键字         |
| page_size | Integer | 否    | 每页条数 空表示10条 |
| page_num  | Integer | 否    | 第几页 空表示第1页  |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 否    | 视光厂商列表 |

药品药房列表说明

| 参数名               | 类型      | 必填   | 说明                           |
| ----------------- | ------- | ---- | ---------------------------- |
| depot_id          | String  | 是    | 药品药房ID                       |
| depot_name        | String  | 是    | 药房名称                         |
| depot_agen_id     | String  | 是    | 所属运营机构                       |
| depot_type        | Integer | 是    | 药房类型   即药房角色 0-药库;1-药房; 2-药柜 |
| depot_phone       | String  | 否    | 药房电话                         |
| depot_address     | String  | 否    | 药房地址                         |
| depot_create_time | String  | 是    | 建立日期                         |
| depot_enable      | String  | 是    | 停启用状态   0：停用 1：有效            |


### 新增/修改药品药房

> [POST]/drug_service/drug_depot/

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### 

| 参数名           | 类型      | 必填   | 说明                          |
| ------------- | ------- | ---- | --------------------------- |
| depot_id      | String  | 否    | 药品药房ID,没有时为新建，有时为更新         |
| depot_name    | String  | 是    | 药房名称                        |
| depot_agen_id | String  | 是    | 所属运营机构                      |
| depot_type    | Integer | 是    | 药房类型  即药房角色 0-药库;1-药房; 2-药柜 |
| depot_phone   | String  | 否    | 药房电话                        |
| depot_address | String  | 否    | 药房地址                        |


#### 回复报文参数

| 参数名      | 类型     | 必填   | 说明     |
| -------- | ------ | ---- | ------ |
| depot_id | String | 是    | 药品药房ID |



### 获取药品药房详情

> [GET]/drug_service/drug_depot/{depot_id}

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名      | 类型     | 必填   | 说明     |
| -------- | ------ | ---- | ------ |
| depot_id | String | 否    | 药品药房ID |

#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |

#### 回复报文参数

| 参数名               | 类型      | 必填   | 说明                           |
| ----------------- | ------- | ---- | ---------------------------- |
| depot_id          | String  | 是    | 药品药房ID                       |
| depot_name        | String  | 是    | 药房名称                         |
| depot_agen_id     | String  | 是    | 所属运营机构                       |
| depot_type        | Integer | 是    | 药房类型   即药房角色 0-药库;1-药房; 2-药柜 |
| depot_phone       | String  | 否    | 药房电话                         |
| depot_address     | String  | 否    | 药房地址                         |
| depot_create_time | String  | 是    | 建立日期                         |
| depot_enable      | String  | 是    | 停启用状态   0：停用 1：有效            |


### 停用/启用药品药房

> [POST]/drug_service/drug_depot/enable/{depot_id}

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名      | 类型     | 必填   | 说明     |
| -------- | ------ | ---- | ------ |
| depot_id | String | 否    | 药品药房ID |

#### RequestBody

| 参数名          | 类型      | 必填   | 说明             |
| ------------ | ------- | ---- | -------------- |
| depot_enable | Integer | 是    | 是否有效；0：停用；1：有效 |

#### 回复报文参数

| 参数名      | 类型     | 必填   | 说明     |
| -------- | ------ | ---- | ------ |
| depot_id | String | 是    | 药品药房ID |


##药房基础设置-药品类别


### 药品类别列表  

> [GET]/drug_service/drug_classify/list

是否要分页

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### 

| 参数名       | 类型      | 必填   | 说明          |
| --------- | ------- | ---- | ----------- |


#### 回复报文参数

| 参数名  | 类型         | 必填   | 说明     |
| ---- | ---------- | ---- | ------ |
| list | ObjectList | 否    | 药品类别列表 |

药品类别列表说明

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| classify_name | String | 是    | 药品类别名称 |
| classify_id   | String | 是    | 药品类别ID |


### 新增/修改药品类别

> [POST]/drug_service/drug_classify/

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数



#### RequestBody

| 参数名           | 类型     | 必填   | 说明                            |
| ------------- | ------ | ---- | ----------------------------- |
| classify_id   | String | 否    | 药品类别ID,没有时为新建药品类别，有时为更新这个药品类别 |
| classify_name | String | 是    | 药品类别名称                        |


#### 回复报文参数

| 参数名         | 类型     | 必填   | 说明     |
| ----------- | ------ | ---- | ------ |
| classify_id | String | 是    | 药品类别ID |



### 获取药品类别详情

> [GET]/drug_service/drug_classify/{classify_id }

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名         | 类型     | 必填   | 说明     |
| ----------- | ------ | ---- | ------ |
| classify_id | String | 否    | 药品类别ID |

#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |

#### 回复报文参数

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| classify_id   | String | 否    | 药品类别ID |
| classify_name | String | 是    | 药品类别名称 |


###删除药品类别

> [DELETE]/drug_service/drug_classify/{classify_id}

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名         | 类型     | 必填   | 说明                  |
| ----------- | ------ | ---- | ------------------- |
| classify_id | String | 否    | 药品类别ID,没有时为新建，有时为更新 |

#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |

#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |




##药房基础设置-药品目录



### 药品目录树

> [GET]/drug_service/drug/tree

药品类别下的药品目录是一个通用名一条记录

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |

#### 回复报文参数 ObjectList

| 参数名           | 类型         | 必填   | 说明     |
| ------------- | ---------- | ---- | ------ |
| classify_id   | String     | 是    | 药品类别ID |
| classify_name | String     | 是    | 药品类别名称 |
| drug_list     | ObjectList | 是    | 药品目录列表 |

药品目录列表说明

| 参数名       | 类型     | 必填   | 说明   |
| --------- | ------ | ---- | ---- |
| drug_name | String | 是    | 药品名称 |



### 药品目录列表  

> [GET]/drug_service/drug_dir/list

一个通用名一个剂型为一条记录。如果一个药品通用名有两种剂型，则为两条记录。

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名         | 类型      | 必填   | 说明                |
| ----------- | ------- | ---- | ----------------- |
| key         | String  | 否    | 关键字  药品名 商品名 模糊匹配 |
| classify_id | String  | 否    | 药品类别ID            |
| page_size   | Integer | 否    | 每页条数 空表示10条       |
| page_num    | Integer | 否    | 第几页 空表示第1页        |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 是    | 药品目录列表 |

药品目录列表

| 参数名            | 类型     | 必填   | 说明   |
| -------------- | ------ | ---- | ---- |
| drug_name      | String | 是    | 药品名称 |
| drug_form_name | String | 是    | 剂型名称 |


### 药品信息列表  

> [GET]/drug_service/drug_info/list


| 对应版本   | 说明         |
| ------ | ---------- |
| V1.3.9.2 | 药品信息可以修改 已发生的业务数据在单据中保持不变；后台用冗余的方式；   |

每通用名每规格每厂商一条记录

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名            | 类型      | 必填   | 说明                   |
| -------------- | ------- | ---- | -------------------- |
| key            | String  | 否    | 关键字  药品名 商品名 模糊匹配    |
| drug_name      | String  | 否    | 药品名 精确匹配 点击左边的树中的药品名 |
| classify_id    | String  | 否    | 药品类别ID               |
| drug_factoryid | String  | 否    | 生产厂家ID               |
| drug_enable    | Integer | 否    | 是否有效标志;0：否；1：是  不传全部 |
| drug_putin     | Integer | 否    | 是否入库;0：否；1：是    不传全部 |
| page_size      | Integer | 否    | 每页条数 空表示10条          |
| page_num       | Integer | 否    | 第几页 空表示第1页           |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 是    | 药品目录列表 |

药品信息列表

| 参数名            | 类型      | 必填   | 说明                |
| -------------- | ------- | ---- | ----------------- |
| drug_spec_id   | String  | 是    | 药品包装规格ID          |
| drug_name      | String  | 是    | 药品名称              |
| drug_spec      | String  | 是    | 药品规格字符串 如40mg/1片  |
| drug_factory   | String  | 是    | 生产厂家名称            |
| drug_pack_info | String  | 是    | 包装规格              |
| last_bidprice  | Integer | 否    | 最近入库价,单价，单位分      |
| price          | Integer | 是    | 包装规格处方价,销售价单价,单位分 |
| drug_enable    | Integer | 是    | 是否有效标志;0：否；1：是    |
| drug_putin     | Integer | 是    | 是否入库;0：否；1：是      |


### 药品信息获取

> [GET]/drug_service/drug/{drug_spec_id}

####修改更新记录

| 对应版本   | 说明         |
| ------ | ---------- |
| V1.3.1 | 新增         |
| V1.3.2 | 修改 增加药品商品名 |

#### 请求报文参数

#### PathVariable

| 参数名          | 类型     | 必填   | 说明       |
| ------------ | ------ | ---- | -------- |
| drug_spec_id | String | 是    | 药品包装规格ID |

#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |


#### 回复报文参数

| 参数名                 | 类型      | 必填   | 说明                                  |
| ------------------- | ------- | ---- | ----------------------------------- |
| drug_spec_id        | String  | 是    | 药品包装规格ID                            |
| drug_name           | String  | 是    | 药品名称                                |
| drug_good_name      | String  | 是    | 药品商品名称                              |
| drug_spec_num       | String  | 是    | 药品规格质量值；40mg/1片中的40                 |
| drug_spec_unitid    | String  | 否    | 规格质量单位ID                            |
| drug_spec_unit      | String  | 是    | 规格质量单位；40mg/1片，中的mg                 |
| drug_bulk_num       | Integer | 否    | 40mg/1片，中的1，当为空时业务上表示为1             |
| drug_pack_unitid    | String  | 否    | 规格体积单位ID                            |
| drug_pack_unit      | String  | 是    | 规格体积单位；40mg/1片，中的片                  |
| drug_factoryid      | String  | 是    | 生产厂家ID                              |
| drug_factory        | String  | 是    | 生产厂家名称                              |
| drug_sfda_type      | Integer | 是    | 批准文号类型；0:国药准字；1:国药试字；               |
| drug_sfda_no        | String  | 是    | 批准文号；业务长度为9，请验证                     |
| drug_classify_id    | String  | 是    | 药品类别ID                              |
| drug_classify_name  | String  | 是    | 药品类别名称                              |
| drug_form_id        | Integer | 否    | 剂型ID                                |
| drug_form_name      | String  | 是    | 剂型名称                                |
| drug_char_id        | String  | 是    | 收费类别ID                              |
| drug_char_code      | String  | 是    | 收费类别代码                              |
| drug_char_name      | String  | 是    | 收费类别名称                              |
| drug_warn_days      | Integer | 是    | 预警天数                                |
| drug_adminis_route  | Integer | 是    | 默认用量用法-给药途径,1-口服;2-注射;3-外用;         |
| drug_adminis_place  | Integer | 是    | 默认用量用法-给药部位,0:无给药部位;1-左眼;2-右眼;3-双眼; |
| drug_doseage        | String  | 是    | 默认用量用法-单次使用剂量                       |
| drug_doseage_unitid | String  | 否    | 默认用量用法-单次剂量单位ID                     |
| durg_doseage_unit   | String  | 是    | 默认用量用法-单次剂量单位                       |
| drug_freq_id        | String  | 否    | 默认用量用法-频率频次ID                       |
| drug_frequency      | String  | 是    | 默认用量用法-频率频次内容                       |
| drug_enable         | Integer | 是    | 是否有效标志;0：否；1：是                      |
| drug_pack           | Object  | 是    | 销售信息-包装规格                           |
| drug_putin          | Integer | 是    | 是否入库;0：否；1：是                        |

##### 销售信息-包装规格

| 参数名                | 类型      | 必填   | 说明                                       |
| ------------------ | ------- | ---- | ---------------------------------------- |
| pack_spec          | String  | 是    | 包装规格,如：40mg*14片[/盒]（不包含盒）                |
| pack_spec_unitid   | String  | 是    | 包装规格单位ID,上面例子中盒的ID                       |
| pack_spec_unit     | String  | 是    | 包装规格单位,上面例子中的盒                           |
| pack_split         | Integer | 是    | 拆分标志,0-不拆分;1-支持拆分                        |
| pack_split_unitid  | String  | 否    | 拆分单位ID                                   |
| pack_split_unit    | String  | 是    | 拆分单位                                     |
| pack_split_count   | Integer | 否    | 拆分数量,一个包装规格拆分的数量                         |
| pack_last_bidprice | Integer | 否    | 最近入库价,单价，单位分，每次有新的药品入库时，都要维护相关药品包装规格的最近入库价 |
| pack_price         | Integer | 是    | 包装规格处方价,销售价单价,单位分，如果是拆分的，那么是拆分后的单价       |
| pack_split_price   | Integer | 否    | 拆分规格处方价，单位分                              |
| pack_warn_count    | Integer | 否    | 预警库存数量,以包装规格进行计算，不管是否拆分                  |
| pack_sale_type     | Integer | 是    | 处方支持，0:支持拆分规格销售; 1:支持包装规格和拆分规格同时销售;      |




### 新增/修改药品信息

> [POST]/drug_service/drug/

####修改更新记录

| 对应版本   | 说明         |
| ------ | ---------- |
| V1.3.1 | 新增         |
| V1.3.2 | 修改 增加药品商品名 |
| V1.3.9.2 | 修改 药品基础信息允许修改 增加处方价“修改”，一旦修改成功，立即生效。 |

#### 请求报文参数


#### RequestBody

| 参数名                 | 类型      | 必填   | 说明                                  |
| ------------------- | ------- | ---- | ----------------------------------- |
| drug_spec_id        | String  | 否    | 药品包装规格ID,没有时为新建，有时为更新               |
| drug_name           | String  | 是    | 药品名称                                |
| drug_good_name      | String  | 是    | 药品商品名称                              |
| drug_spec_num       | String  | 是    | 药品规格质量值；40mg/1片中的40                 |
| drug_spec_unitid    | String  | 是    | 规格质量单位ID                            |
| drug_spec_unit      | String  | 是    | 规格质量单位；40mg/1片，中的mg     不用传         |
| drug_bulk_num       | String  | 否    | 40mg/1片，中的1，当为空时业务上表示为1             |
| drug_pack_unitid    | String  | 否    | 规格体积单位ID                            |
| drug_pack_unit      | String  | 是    | 规格体积单位；40mg/1片，中的片     不用传          |
| drug_factoryid      | String  | 是    | 生产厂家ID                              |
| drug_factory        | String  | 是    | 生产厂家名称        不用传                   |
| drug_sfda_type      | Integer | 是    | 批准文号类型；0:国药准字；1:国药试字；3:进口药品注册证号 4:医疗器械注册证编号               |
| drug_sfda_no        | String  | 是    | 批准文号；业务长度为9，请验证                     |
| drug_classify_id    | String  | 是    | 药品类别ID                              |
| drug_classify_name  | String  | 是    | 药品类别名称       不用传                    |
| drug_form_id        | Integer | 是    | 剂型ID                                |
| drug_form_name      | String  | 是    | 剂型名称      不用传                       |
| drug_char_id        | String  | 是    | 收费类别ID                              |
| drug_char_code      | String  | 是    | 收费类别代码    不用传                       |
| drug_char_name      | String  | 是    | 收费类别名称    不用传                       |
| drug_warn_days      | Integer | 是    | 预警天数                                |
| drug_adminis_route  | Integer | 是    | 默认用量用法-给药途径,1-口服;2-注射;3-外用;         |
| drug_adminis_place  | Integer | 是    | 默认用量用法-给药部位,0:无给药部位;1-左眼;2-右眼;3-双眼; |
| drug_doseage        | String  | 是    | 默认用量用法-单次使用剂量                       |
| drug_doseage_unitid | String  | 否    | 默认用量用法-单次剂量单位ID                     |
| durg_doseage_unit   | String  | 是    | 默认用量用法-单次剂量单位                       |
| drug_freq_id        | String  | 否    | 默认用量用法-频率频次ID                       |
| drug_frequency      | String  | 是    | 默认用量用法-频率频次内容                       |
| drug_enable         | Integer | 是    | 是否有效标志;0：否；1：是                      |
| drug_pack           | Object  | 是    | 销售信息-包装规格                           |
| drug_putin          | Integer | 是    | 是否入库;0：否；1：是                        |

##### 销售信息-包装规格

| 参数名                | 类型      | 必填   | 说明                                       |
| ------------------ | ------- | ---- | ---------------------------------------- |
| pack_spec          | String  | 是    | 包装规格,如：40mg*14片[/盒]（不包含盒）                |
| pack_spec_unitid   | String  | 是    | 包装规格单位ID,上面例子中盒的ID                       |
| pack_spec_unit     | String  | 是    | 包装规格单位,上面例子中的盒     不用传                   |
| pack_split         | Integer | 是    | 拆分标志,0-不拆分;1-支持拆分                        |
| pack_split_unitid  | String  | 否    | 拆分单位ID                                   |
| pack_split_unit    | String  | 否    | 拆分单位    不用传                              |
| pack_split_count   | Integer | 否    | 拆分数量,一个包装规格拆分的数量                         |
| pack_last_bidprice | Integer | 否    | 最近入库价,单价，单位分，每次有新的药品入库时，都要维护相关药品包装规格的最近入库价 |
| pack_price         | Integer | 是    | 包装规格处方价,销售价单价,单位分，如果是拆分的，那么是拆分后的单价       |
| pack_split_price   | Integer | 否    | 拆分规格处方价，单位分                              |
| pack_warn_count    | Integer | 否    | 预警库存数量,以包装规格进行计算，不管是否拆分                  |
| pack_sale_type     | Integer | 是    | 处方支持，0:支持拆分规格销售; 1:支持包装规格和拆分规格同时销售;      |


#### 回复报文参数

| 参数名     | 类型     | 必填   | 说明     |
| ------- | ------ | ---- | ------ |
| drug_id | String | 否    | 药品ID   |
| pack_id | String | 否    | 包装规格ID |


### 药品启停用

> [POST]/drug_service/drug/disable/{drug_id }

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| drug_id | String | 否    | 药品ID |

#### RequestBody

| 参数名         | 类型      | 必填   | 说明              |
| ----------- | ------- | ---- | --------------- |
| drug_enable | Integer | 是    | 启停用标志;0：停用；1：启用 |


#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |




## 药品库存锁药和解锁

### 根据药品规格进行库存锁库

```url
[POST]/drug_service/business/drugSpec/lock
```

说明：
1. 使用先入先出规则

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品库存表(drug_stock_all)

#### 请求报文参数


##### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

##### 药品医嘱列表

| 参数名          | 类型      | 必填   | 说明               |
| ------------ | ------- | ---- | ---------------- |
| drug_pack_id | Long    | 是    | 药品包装规格ID         |
| drug_split   | Integer | 是    | 拆分标志;0:不拆分; 1:拆分 |
| drug_num     | Integer | 是    | 数量               |

#### 回复报文参数 ObjectList

| 参数名     | 类型   | 必填   | 说明     |
| ------- | ---- | ---- | ------ |
| stoc_id | Long | 是    | 药品库存ID |

### 根据药品规格进行锁库解锁

```url
[POST]/drug_service/business/drugSpec/unlock
```

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品库存表(drug_stock_all)

#### 请求报文参数


##### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

##### 药品医嘱列表

| 参数名          | 类型      | 必填   | 说明               |
| ------------ | ------- | ---- | ---------------- |
| drug_pack_id | Long    | 是    | 药品包装规格ID         |
| drug_split   | Integer | 是    | 拆分标志;0:不拆分; 1:拆分 |
| drug_num     | Integer | 是    | 数量               |

#### 回复报文参数 ObjectList

| 参数名     | 类型   | 必填   | 说明     |
| ------- | ---- | ---- | ------ |
| stoc_id | Long | 是    | 药品库存ID |

##库存信息


### 库存信息列表  

> [GET]/drug_service/drug_stock/list

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 药品信息可以变更，旧信息冗余查询  |

#### 请求报文参数

#### RequestBody

| 参数名             | 类型      | 必填   | 说明                         |
| --------------- | ------- | ---- | -------------------------- |
| depot_id        | String  | 否    | 药品药房ID 不传表示全部              |
| classify_id     | String  | 否    | 药品类别ID  不传表示全部             |
| drug_name       | String  | 否    | 药品名称                       |
| pack_spec       | String  | 否    | 包装规格,如：40mg*14片[/盒] 不传表示全部 |
| drug_factoryid  | String  | 否    | 生产厂家ID  不传表示全部             |
| drug_supplierid | String  | 否    | 供应商ID  不传表示全部              |
| page_size       | Integer | 是    | 每页条数 空表示10条                |
| page_num        | Integer | 是    | 第几页 空表示第1页                 |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明       |
| --------- | ---------- | ---- | -------- |
| page_num  | Integer    | 是    | 当前页      |
| page_size | Integer    | 是    | 每页的数量    |
| total     | Integer    | 是    | 总记录数     |
| pages     | Integer    | 是    | 总页数      |
| list      | ObjectList | 是    | 药品库存信息列表 |

库存信息列表

| 参数名              | 类型         | 必填   | 说明               |
| ---------------- | ---------- | ---- | ---------------- |
| depot_id         | String     | 是    | 药品药房ID           |
| depot_name       | String     | 是    | 药房名称             |
| drug_id          | String     | 是    | 药品ID             |
| drug_name        | String     | 是    | 药品名称             |
| drug_spec        | String     | 是    | 药品规格字符串 如40mg/1片 |
| batch_stock_list | ObjectList | 是    | 该药品库存信息列表        |


药品库存信息列表

| 参数名                | 类型         | 必填   | 说明                          |
| ------------------ | ---------- | ---- | --------------------------- |
| drug_spec_id       | String     | 是    | 药品包装规格ID                    |
| drug_factoryid     | String     | 否    | 生产厂家ID                      |
| drug_factory       | String     | 是    | 生产厂家名称                      |
| pack_spec          | String     | 是    | 包装规格,如：40mg*14片[/盒]         |
| drug_sfda_no       | String     | 是    | 批准文号                        |
| price              | Integer    | 是    | 包装规格处方价,销售价单价,单位分           |
| stock_str          | String     | 是    | 库存字符串  如 30盒1片  (是拼接好后的字符串) |
| drug_supplier_list | ObjectList | 是    | 供应商列表                       |


供应商列表

| 参数名           | 类型     | 必填   | 说明    |
| ------------- | ------ | ---- | ----- |
| drug_supplier | String | 是    | 供应商名称 |


### 药品批次详情

> [GET]/drug_service/drug_stock/batch_info

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 药品信息可以变更，旧信息冗余查询  |

#### 请求报文参数



#### RequestBody

| 参数名          | 类型      | 必填   | 说明                   |
| ------------ | ------- | ---- | -------------------- |
| depot_id     | String  | 是    | 药品药房ID               |
| drug_spec_id | String  | 是    | 药品包装规格ID             |
| batch_no     | String  | 否    | 产品批号                 |
| state        | Integer | 否    | 状态  0正常 1 已冻结   不传全部 |
| page_size    | Integer | 否    | 每页条数 空表示10条          |
| page_num     | Integer | 否    | 第几页 空表示第1页           |

#### 回复报文参数

| 参数名        | 类型         | 必填   | 说明                  |
| ---------- | ---------- | ---- | ------------------- |
| depot_id   | String     | 是    | 药品药房ID              |
| depot_name | String     | 是    | 药房名称                |
| drug_name  | String     | 是    | 药品名称                |
| pack_spec  | String     | 是    | 包装规格,如：40mg*14片[/盒] |
| page_num   | Integer    | 是    | 当前页                 |
| page_size  | Integer    | 是    | 每页的数量               |
| total      | Integer    | 是    | 总记录数                |
| pages      | Integer    | 是    | 总页数                 |
| list       | ObjectList | 是    | 药品批次信息列表            |

药品批次信息列表说明

| 参数名                | 类型         | 必填   | 说明                          |
| ------------------ | ---------- | ---- | --------------------------- |
| drug_spec_id       | String     | 是    | 药品包装规格ID                    |
| batch_no           | String     | 是    | 产品批号                        |
| pack_spec          | String     | 是    | 包装规格,如：40mg*14片[/盒]         |
| batch_validity_str | String     | 是    | 有效期                         |
| drug_spec          | String     | 是    | 药品规格字符串 如40mg/1片            |
| stock_Str          | String     | 是    | 库存字符串  如 30盒1片  (是拼接好后的字符串) |
| state              | Integer    | 是    | 状态  0正常 1 已冻结               |
| in_batch_list      | ObjectList | 是    | 药品 入库批次信息列表                 |



药品 入库批次信息列表说明

| 参数名             | 类型     | 必填   | 说明      |
| --------------- | ------ | ---- | ------- |
| batch_id        | String | 是    | 入库批次    |
| arrival_date    | String | 是    | 入库日期    |
| batch_price     | String | 是    | 入库单据 进价 |
| arrival_num_str | String | 是    | 入库数量字符串 |


### 冻结或解冻药品批次

> [POST]/drug_service/drug_stock/freeze

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### RequestBody

| 参数名          | 类型      | 必填   | 说明                |
| ------------ | ------- | ---- | ----------------- |
| drug_spec_id | String  | 是    | 药品包装规格ID          |
| batch_no     | String  | 是    | 产品批号              |
| state        | Integer | 否    | 冻结或解冻  0 解冻 1-冻结; |


#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |




### 药品进销存详情

> [GET]/drug_service/drug_stock/inout_info

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 药品信息可以修正，冗余查询历史数据   |

#### 请求报文参数



#### RequestBody

| 参数名          | 类型      | 必填   | 说明                      |
| ------------ | ------- | ---- | ----------------------- |
| depot_id     | String  | 是    | 药品药房ID                  |
| drug_spec_id | String  | 是    | 药品包装规格ID                |
| key          | String  | 否    | 查询关键字   产品批号或单据编号  模糊查询 |
| begin_date   | String  | 否    | 发生开始日期                  |
| end_date     | String  | 否    | 发生结束日期                  |
| bill_mode    | Integer | 是    | 出入库方式  1-采购入库;2-采购冲红出库  |
| page_size    | Integer | 否    | 每页条数 空表示10条             |
| page_num     | Integer | 否    | 第几页 空表示第1页              |

#### 回复报文参数

| 参数名        | 类型         | 必填   | 说明                  |
| ---------- | ---------- | ---- | ------------------- |
| depot_id   | String     | 是    | 药品药房ID              |
| depot_name | String     | 是    | 药房名称                |
| drug_name  | String     | 是    | 药品名称                |
| pack_spec  | String     | 是    | 包装规格,如：40mg*14片[/盒] |
| page_num   | Integer    | 是    | 当前页                 |
| page_size  | Integer    | 是    | 每页的数量               |
| total      | Integer    | 是    | 总记录数                |
| pages      | Integer    | 是    | 总页数                 |
| list       | ObjectList | 是    | 进销存信息列表             |

进销存信息列表说明

| 参数名                | 类型     | 必填   | 说明       |
| ------------------ | ------ | ---- | -------- |
| inout_date         | String | 是    | 出入库时间    |
| bizid              | String | 是    | 业务单据ID   |
| bill_bizno         | String | 是    | 业务单据号    |
| batch_no           | String | 是    | 产品批号     |
| bill_mode_str      | String | 是    | 出入库方式    |
| batch_validity_str | String | 是    | 有效期      |
| batch_price        | String | 是    | 入库单价 进价  |
| inout_num_str      | String | 是    | 出入库数量字符串 |



###库存告警列表

> [GET]/drug_service/drug_stock/num_warn_list

数量低于下限的告警

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数



#### RequestBody

| 参数名       | 类型      | 必填   | 说明           |
| --------- | ------- | ---- | ------------ |
| depot_id  | String  | 否    | 药品药房ID  不传全部 |
| drug_name | String  | 否    | 药品名称 不传全部    |
| page_size | Integer | 否    | 每页条数 空表示10条  |
| page_num  | Integer | 否    | 第几页 空表示第1页   |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 是    | 告警信息列表 |

告警信息列表说明

| 参数名          | 类型     | 必填   | 说明                  |
| ------------ | ------ | ---- | ------------------- |
| depot_name   | String | 是    | 药房名称                |
| drug_name    | String | 是    | 药品名称                |
| drug_spec    | String | 是    | 药品规格,如：0.25g/片      |
| pack_spec    | String | 是    | 包装规格,如：40mg*14片[/盒] |
| real_num_str | String | 是    | 实际库存数量字符串           |
| warn_num_str | String | 是    | 报警库存数量字符串           |
| drug_factory | String | 是    | 生产厂家名称              |



###有效期告警列表

> [GET]/drug_service/drug_stock/valid_warn_list

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### RequestBody

| 参数名       | 类型      | 必填   | 说明           |
| --------- | ------- | ---- | ------------ |
| depot_id  | String  | 否    | 药品药房ID  不传全部 |
| drug_name | String  | 否    | 药品名称 不传全部    |
| page_size | Integer | 否    | 每页条数 空表示10条  |
| page_num  | Integer | 否    | 第几页 空表示第1页   |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 是    | 告警信息列表 |

告警信息列表说明

| 参数名                | 类型     | 必填   | 说明                  |
| ------------------ | ------ | ---- | ------------------- |
| depot_name         | String | 是    | 药房名称                |
| drug_name          | String | 是    | 药品名称                |
| drug_spec          | String | 是    | 药品规格,如：0.25g/片      |
| pack_spec          | String | 是    | 包装规格,如：40mg*14片[/盒] |
| batch_no           | String | 是    | 产品批号                |
| real_num_str       | String | 是    | 实际库存数量字符串           |
| drug_factory       | String | 是    | 生产厂家名称              |
| batch_validity_str | String | 是    | 有效期                 |
| left_day_num       | String | 是    | 剩余天数                |



###告警数量预览

> [GET]/drug_service/drug_stock/num_preview


####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### RequestBody

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |


#### 回复报文参数

| 参数名               | 类型      | 必填   | 说明      |
| ----------------- | ------- | ---- | ------- |
| stock_warn_num    | Integer | 是    | 库存告警数量  |
| validity_warn_num | Integer | 是    | 有效期告警数量 |



##药品入库管理


###入库单列表

> [GET]/drug_service/drug_arrival/list


####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数


#### RequestBody

| 参数名             | 类型      | 必填   | 说明                    |
| --------------- | ------- | ---- | --------------------- |
| depot_id        | String  | 否    | 药品药房ID  不传全部          |
| begin_date      | String  | 否    | 入库开始日期                |
| end_date        | String  | 否    | 入库结束日期                |
| drug_supplierid | String  | 是    | 供应商ID                 |
| arrival_no      | String  | 是    | 供应商ID                 |
| state           | Integer | 否    | 状态  1-已入库;2-已冲红; 不传全部 |
| page_size       | Integer | 否    | 每页条数 空表示10条           |
| page_num        | Integer | 否    | 第几页 空表示第1页            |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明    |
| --------- | ---------- | ---- | ----- |
| page_num  | Integer    | 是    | 当前页   |
| page_size | Integer    | 是    | 每页的数量 |
| total     | Integer    | 是    | 总记录数  |
| pages     | Integer    | 是    | 总页数   |
| list      | ObjectList | 是    | 入库单列表 |

入库单列表说明

| 参数名           | 类型      | 必填   | 说明               |
| ------------- | ------- | ---- | ---------------- |
| arrival_id    | String  | 是    | 入库单ID            |
| intime        | String  | 是    | 入库日期             |
| arrival_no    | String  | 是    | 入库单号             |
| intype        | Integer | 是    | 入库方式 1:采购入库      |
| drug_supplier | String  | 是    | 供应商              |
| amount        | String  | 是    | 数量               |
| arrival_price | Double  | 是    | 入库金额  进价合计 单位元   |
| arrival_user  | String  | 是    | 管理员  制单人         |
| state         | Integer | 是    | 状态  1-已入库;2-已冲红; |




###入库单详情

> [GET]/drug_service/drug_arrival/{arrival_id}

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 药品信息可以修改 已发生的业务数据在单据中保持不变；后台用冗余的方式； 【入库管理】-“详情”页，表头显示发票号，明细中显示批准文号；  |


#### 请求报文参数


#### PathVariable

| 参数名        | 类型     | 必填   | 说明    |
| ---------- | ------ | ---- | ----- |
| arrival_id | String | 是    | 到货单ID |


#### 回复报文参数

| 参数名               | 类型         | 必填   | 说明               |
| ----------------- | ---------- | ---- | ---------------- |
| arrival_id        | String     | 是    | 入库单ID            |
| arrival_no        | String     | 是    | 入库单号             |
| drug_spec_id      | String     | 是    | 药品包装规格ID         |
| intime            | String     | 是    | 入库日期             |
| intype            | Integer    | 是    | 入库方式 1:采购入库      |
| arrival_user      | String     | 是    | 制单人              |
| drug_depot_name   | String     | 是    | 入库药库  名称         |
| arrival_invoice   | String     | 是    | 发票号      V1.3.9.2  |
| drug_supplier     | String     | 是    | 供应商名称            |
| rem               | String     | 否    | 备注               |
| arrival_price     | Double     | 是    | 入库金额  进价合计 单位元   |
| arrival_drug_list | ObjectList | 是    | 入库药品列表           |
| state             | String     | 是    | 状态  1-已入库;2-已冲红; |

入库药品列表说明

| 参数名             | 类型      | 必填   | 说明                         |
| --------------- | ------- | ---- | -------------------------- |
| arrival_item_id | String  | 是    | 入库单细目ID                    |
| drug_spec_id    | String  | 是    | 药品包装规格ID                   |
| drug_name       | String  | 是    | 药品名称                       |
| drug_spec       | String  | 是    | 药品规格                       |
| drug_sfda_no       | String  | 是    | 批准文号      V1.3.9.2追加        |
| drug_pack_spec  | String  | 是    | 药品包装规格                     |
| factory         | String  | 是    | 生产厂商                       |
| sale_price      | Double  | 是    | 处方价 单位元                    |
| batch_batchno   | String  | 是    | 产品批号                       |
| batch_validity  | String  | 是    | 有效期                        |
| count           | Integer | 是    | 入库数量，不管是否拆分这儿的数量都是包装规格的数量； |
| unit            | String  | 是    | 单位 不管是否拆分这儿的单价都是包装规格的单位；   |
| arrival_price   | Double  | 是    | 入库价  （单价 单位元）              |



### 入库单细目详情

> [GET]/drug_service/drug_arrival/item/{drug_spec_id}

#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名          | 类型     | 必填   | 说明       |
| ------------ | ------ | ---- | -------- |
| drug_spec_id | String | 是    | 药品包装规格ID |
| V1.3.9.2 |  增加“商品名”与药品信息基础信息保持一致。 |

#### 回复报文参数

| 参数名                 | 类型      | 必填   | 说明                                  |
| ------------------- | ------- | ---- | ----------------------------------- |
| drug_spec_id        | String  | 是    | 药品包装规格ID                            |
| drug_name           | String  | 是    | 药品名称                                |
| drug_pro_name       | String  | 是    | 商品名称    V1.3.9.2     |
| drug_spec           | String  | 是    | 药品规格 如40mg/片                        |
| drug_spec_num       | String  | 是    | 药品规格质量值；40mg/1片中的40                 |
| drug_spec_unitid    | String  | 否    | 规格质量单位ID                            |
| drug_spec_unit      | String  | 是    | 规格质量单位；40mg/1片，中的mg                 |
| drug_bulk_num       | Integer | 否    | 40mg/1片，中的1，当为空时业务上表示为1             |
| drug_pack_unitid    | String  | 否    | 规格体积单位ID                            |
| drug_pack_unit      | String  | 是    | 规格体积单位；40mg/1片，中的片                  |
| drug_factoryid      | String  | 是    | 生产厂家ID                              |
| drug_factory        | String  | 是    | 生产厂家名称                              |
| drug_sfda_type      | Integer | 是    | 批准文号类型；0:国药准字；1:国药试字；               |
| drug_sfda_no        | String  | 是    | 批准文号；业务长度为9，请验证                     |
| drug_classify_id    | String  | 是    | 药品类别ID                              |
| drug_classify_name  | String  | 是    | 药品类别名称                              |
| drug_form_id        | Integer | 否    | 剂型ID                                |
| drug_form_name      | String  | 是    | 剂型名称                                |
| drug_char_id        | String  | 是    | 收费类别ID                              |
| drug_char_code      | String  | 是    | 收费类别代码                              |
| drug_char_name      | String  | 是    | 收费类别名称                              |
| drug_warn_days      | Integer | 是    | 预警天数                                |
| drug_adminis_route  | Integer | 是    | 默认用量用法-给药途径,1-口服;2-注射;3-外用;         |
| drug_adminis_place  | Integer | 是    | 默认用量用法-给药部位,0:无给药部位;1-左眼;2-右眼;3-双眼; |
| drug_doseage        | String  | 是    | 默认用量用法-单次使用剂量                       |
| drug_doseage_unitid | String  | 否    | 默认用量用法-单次剂量单位ID                     |
| drug_doseage_unit   | String  | 是    | 默认用量用法-单次剂量单位                       |
| drug_freq_id        | String  | 否    | 默认用量用法-频率频次ID                       |
| drug_frequency      | String  | 是    | 默认用量用法-频率频次内容                       |
| drug_enable         | Integer | 是    | 是否有效标志;0：否；1：是                      |
| drug_pack           | Object  | 是    | 销售信息-包装规格                           |

##### 销售信息-包装规格

| 参数名                | 类型      | 必填   | 说明                                       |
| ------------------ | ------- | ---- | ---------------------------------------- |
| pack_id            | String  | 否    | 包装规格ID                                   |
| pack_spec          | String  | 是    | 包装规格,如：40mg*14片[/盒]（不包含盒）                |
| pack_spec_unitid   | String  | 是    | 包装规格单位ID,上面例子中盒的ID                       |
| pack_spec_unit     | String  | 是    | 包装规格单位,上面例子中的盒                           |
| pack_split         | Integer | 是    | 拆分标志,0-不拆分;1-支持拆分                        |
| pack_split_unitid  | String  | 否    | 拆分单位ID                                   |
| pack_split_unit    | String  | 是    | 拆分单位                                     |
| pack_split_count   | Integer | 否    | 拆分数量,一个包装规格拆分的数量                         |
| pack_last_bidprice | Integer | 否    | 最近入库价,单价，单位分，每次有新的药品入库时，都要维护相关药品包装规格的最近入库价 |
| pack_price         | Integer | 是    | 包装规格处方价,销售价单价,单位分，如果是拆分的，那么是拆分后的单价       |
| pack_split_price   | Integer | 否    | 拆分规格处方价，单位分                              |
| pack_warn_count    | Integer | 否    | 预警库存数量,以包装规格进行计算，不管是否拆分                  |
| pack_sale_type     | Integer | 是    | 处方支持，0:支持拆分规格销售; 1:支持包装规格和拆分规格同时销售;      |



### 新增入库单

> [POST]/drug_service/drug_arrival


#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |
| V1.3.9.2 | 在明细中新增显示批准文号（比如 进口药品注册号a12345678）；表头增加“发票号”  药品信息更改，追加冗余字段：药品名 药品规格 包装规格 生产厂家  |

#### 请求报文参数


#### RequestBody

| 参数名               | 类型         | 必填   | 说明     |
| ----------------- | ---------- | ---- | ------ |
| drug_depot        | String     | 是    | 入库药库   |
| drug_supplierid   | String     | 是    | 供应商    |
| arrival_invoice   | String     | 是    | 发票号 V1.3.9.2新增   |
| rem               | String     | 否    | 备注     |
| arrival_drug_list | ObjectList | 是    | 入库药品列表 |

入库药品列表说明

| 参数名            | 类型      | 必填   | 说明                             |
| -------------- | ------- | ---- | ------------------------------ |
| drug_id        | String  | 是    | 药品ID                           |
| packspec_id    | String  | 是    | 药品包装规格ID                       |
| count          | Integer | 是    | 入库数量，不管是否拆分这儿的数量都是包装规格的数量；     |
| arrival_price  | Double  | 是    | 入库单价，单位元，不管是否拆分这儿的单价都是包装规格的单位； |
| batch_batchno  | String  | 是    | 产品批号                           |
| batch_validity | String  | 是    | 有效期                            |
| warn_count     | Integer | 是    | 预警库存数量，以包装规格进行计算，不管是否拆分        |


#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明      |
| ---------- | ------ | ---- | ------- |
| arrival_id | String | 是    | 采购入库单ID |
| arrival_no | String | 是    | 采购入库单号  |



###入库单冲红

> [POST]/drug_service/drug_arrival/red/{arrival_id}


####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名        | 类型     | 必填   | 说明    |
| ---------- | ------ | ---- | ----- |
| arrival_id | String | 是    | 到货单ID |


#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |




###根据批号获取批号信息
> [GET]/drug_service/drug_arrival/batch_no_info

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.1 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名         | 类型     | 必填   | 说明       |
| ----------- | ------ | ---- | -------- |
| packspec_id | String | 是    | 药品包装规格ID |
| batch_no    | String | 是    | 批号       |

#### 回复报文参数

| 参数名         | 类型     | 必填   | 说明       |
| ----------- | ------ | ---- | -------- |
| packspec_id | String | 否    | 药品包装规格ID |
| batch_no    | String | 否    | 批号       |
| validity    | String | 否    | 有效期      |




##药品出库

### 药品新增出库单协议

```url
[POST]/drug_service/business/bizout
```

说明：
1. 退货出库时，供应商不能为空；报损出加时，报损单位与报损人不能为空。
2. 锁库的药房不允许操作。



#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |
| V1.3.9.2 |  1、出库管理中的出库方式需要增加一种出库方式：“领用出库”； 2、选择“领用出库”时，跳出领用人，领用人字段为文本框；药品信息更改，追加冗余字段：药品名 药品规格 包装规格 生产厂家 |

#### 影响的表

药品业务出库表(drug_bizout_bill) 
药品业务出库子表(drug_bizout_billitem) 
药房库存表(drug_stock)
药品出入库单表(drug_inout_bill) 
药品出入库单子表(drug_inout_billitem) 

#### 请求报文

| 参数名             | 长度   | 类型         | 必填   | 说明                  |
| --------------- | ---- | ---------- | ---- | ------------------- |
| depot_id        |      | Long       | 是    | 出库药房                |
| out_type        |      | Integer    | 是    | 出库方式;3-退货出库;7-报损出库; 11-领用出库;（V1.3.9.2 ） |
| drug_supplierid |      | Long       | 否    | 供应商  退货出库 必填        |
| breakage_depaid |      | Long       | 否    | 报损单位    报损出库必填      |
| breakage_userid |      | Long       | 否    | 报损人      报损出库必填     |
| breakage_user   |      | String     | 否    | 报损人姓名     报损出库必填    |
| breakage_collarid |      | Long       | 否    | 领用人      领用出库必填  V1.3.9.2    |
| breakage_collar   |      | String     | 否    | 领用人姓名     领用出库必填 V1.3.9.2    |
| bizout_rem      | 128  | String     | 否    | 备注                  |
| bizout_items    |      | ObjectList | 是    | 出库药品列表              |

##### 出库药品列表

| 参数名         | 类型      | 必填   | 说明       |
| ----------- | ------- | ---- | -------- |
| packspec_id | String  | 是    | 药品包装规格ID |
| batch_no    | String  | 是    | 批号       |
| out_num     | Integer | 是    | 出库包装数量   |
| out_price   | Integer | 是    | 出库单价,单位分 |


#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明    |
| --------- | ------ | ---- | ----- |
| bizout_id | Long   | 是    | 出库单ID |
| bizout_no | String | 是    | 出库单号  |


###出库单列表 

> [GET]/drug_service/business/bizout/list

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名        | 类型      | 必填   | 说明                    |
| ---------- | ------- | ---- | --------------------- |
| key        | String  | 否    | 关键字    出库单号或供应商       |
| depot_id   | String  | 是    | 药品药房ID  不传全部          |
| begin_date | String  | 否    | 出库开始日期                |
| end_date   | String  | 否    | 出库结束日期                |
| state      | Integer | 否    | 状态  1-已出库;2-已冲红; 不传全部 |
| page_size  | Integer | 否    | 每页条数 空表示10条           |
| page_num   | Integer | 否    | 第几页 空表示第1页            |


#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明    |
| --------- | ---------- | ---- | ----- |
| page_num  | Integer    | 是    | 当前页   |
| page_size | Integer    | 是    | 每页的数量 |
| total     | Integer    | 是    | 总记录数  |
| pages     | Integer    | 是    | 总页数   |
| list      | ObjectList | 是    | 出库单列表 |

出库单列表说明

| 参数名           | 类型      | 必填   | 说明                    |
| ------------- | ------- | ---- | --------------------- |
| bizout_id     | String  | 是    | 出库单ID                 |
| bizout_no     | String  | 是    | 出库单号                  |
| out_type      | String  | 是    | 出库方式   3-退货出库;7-报损出库; |
| out_num       | String  | 是    | 出库数量                  |
| out_fee       | Double  | 是    | 出库金额    总价 单位：元       |
| out_time      | String  | 是    | 出库时间                  |
| drug_supplier | String  | 是    | 供应商                   |
| bizout_user   | String  | 是    | 制单人                   |
| state         | Integer | 是    | 状态  1-已出库;2-已冲红;      |

### 出库单详情 

> [GET]/drug_service/business/bizout/{bizout_id}

#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### PathVariable

| 参数名       | 类型     | 必填   | 说明    |
| --------- | ------ | ---- | ----- |
| bizout_id | String | 是    | 出库单ID |
| V1.3.9.2 | 药品信息可以修改 已发生的业务数据在单据中保持不变；后台用冗余的方式； 在【出库管理】-详情页中，显示领用出库及领用人信息。  |

#### 回复报文参数

| 参数名           | 类型         | 必填   | 说明                    |
| ------------- | ---------- | ---- | --------------------- |
| bizout_id     | String     | 是    | 出库单ID                 |
| bizout_no     | String     | 是    | 出库单号                  |
| depot_name    | String     | 是    | 药房名称                  |
| out_type      | String     | 是    | 出库方式   3-退货出库;7-报损出库; 11-领用出库;（V1.3.9.2 ） |
| out_num       | String     | 是    | 出库数量                  |
| out_fee       | Double     | 是    | 出库金额    总价 单位：元       |
| out_time      | String     | 是    | 出库时间                  |
| out_rem       | String     | 是    | 出库备注                  |
| drug_supplier | String     | 是    | 供应商                   |
| breakage_collar |   String  | 是   | 领用人姓名 V1.3.9.2    |
| breakage_depa | String     | 否    | 报损单位                  |
| breakage_user | String     | 否    | 报损人                   |
| bizout_user   | String     | 是    | 制单人                   |
| state         | Integer    | 是    | 状态 0:已出库;1:已冲红        |
| bizout_items  | ObjectList | 是    | 出库商品列表                |


出库商品列表说明

| 参数名            | 类型      | 必填   | 说明                         |
| -------------- | ------- | ---- | -------------------------- |
| drug_name      | String  | 是    | 药品名称                       |
| drug_spec      | String  | 是    | 药品规格                       |
| drug_pack_spec | String  | 是    | 药品包装规格                     |
| drug_factory   | String  | 是    | 生产厂商                       |
| batch_no       | String  | 是    | 产品批号                       |
| validity       | String  | 是    | 有效期                        |
| out_num        | Integer | 是    | 出库数量，不管是否拆分这儿的数量都是包装规格的数量； |
| unit           | String  | 是    | 单位 不管是否拆分这儿的单价都是包装规格的单位；   |
| out_price      | Double  | 是    | 出库单价  （单价 单位元）             |
| out_totle      | Double  | 是    | 出库金额   (总价 单位元)            |




### 药品出库单打印

> [GET]/drug_service/business/bizout/print/pdf/{bizout_id}

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### PathVariable

| 参数名       | 类型     | 必填   | 说明    |
| --------- | ------ | ---- | ----- |
| bizout_id | String | 是    | 出库单ID |

#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| pdf流 |      |      |      |



### 药品出库单冲红

```url
[POST]/drug_service/business/bizout/RCW/{bizout_id}
```

说明：
1. 只有正常入库的单子才可以冲红。
2. 锁库的药房不允许操作。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品业务出库表(drug_bizout_bill) 
药品业务出库子表(drug_bizout_billitem) 
药房库存表(drug_stock)
药品出入库单表(drug_inout_bill) 
药品出入库单子表(drug_inout_billitem) 

#### 请求报文参数


#### PathVariable

| 参数名       | 类型   | 必填   | 说明    |
| --------- | ---- | ---- | ----- |
| bizout_id | Long | 是    | 出库单ID |


#### 回复报文参数

| 参数名       | 类型     | 必填   | 说明    |
| --------- | ------ | ---- | ----- |
| bizout_id | Long   | 是    | 出库单ID |
| bizout_no | String | 是    | 出库单号  |

##库存盘点


###盘点单列表 
> [GET]/drug_service/business/inventory/list

需要包含锁库状态

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名        | 类型      | 必填   | 说明                       |
| ---------- | ------- | ---- | ------------------------ |
| key        | String  | 否    | 关键字：盘点单号                 |
| depot_id   | String  | 是    | 药品药房ID                   |
| inve_state | Integer | 是    | 盘点状态 0:盘点中;1:已完成盘点;2:已作废 |
| inve_type  | Integer | 是    | 盘点类型                     |
| begin_date | String  | 否    | 出库开始日期                   |
| end_date   | String  | 否    | 出库结束日期                   |
| page_size  | Integer | 否    | 每页条数 空表示10条              |
| page_num   | Integer | 否    | 第几页 空表示第1页               |

#### 回复报文参数

| 参数名        | 类型         | 必填   | 说明                 |
| ---------- | ---------- | ---- | ------------------ |
| page_num   | Integer    | 是    | 当前页                |
| page_size  | Integer    | 是    | 每页的数量              |
| depot_lock | Integer    | 是    | 药房锁库状态 0:不锁; 1:锁库; |
| total      | Integer    | 是    | 总记录数               |
| pages      | Integer    | 是    | 总页数                |
| list       | ObjectList | 是    | 盘点单列表              |


######盘点列表

| 参数名            | 类型      | 必填   | 说明                                      |
| -------------- | ------- | ---- | --------------------------------------- |
| inventory_id   | String  | 是    | 盘点单ID                                   |
| inventory_no   | String  | 是    | 盘点单号，如：PD201804030001                   |
| inventory_type | Integer | 是    | 盘点类型：月度盘点  0:临时盘点;1:季度盘点;2:半年盘点;3:年终盘点; |
| make_time      | String  | 是    | 盘点日期：20180417                           |
| make_user      | String  | 是    | 盘点人：施秋梅                                 |
| inventory_fee  | Double  | 否    | 盈亏合计                                    |
| state          | Integer | 否    | 状态                                      |



###药房锁盘开启/关闭
```url
[POST]/drug_service/business/invelock/{depot_id}
```
#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |
#### 影响的表

药房库存表(drug_stock)
#### PathVariable

| 参数名      | 类型     | 必填   | 说明   |
| -------- | ------ | ---- | ---- |
| depot_id | String | 是    | 药房ID |
#### 请求报文参数

#### RequestBody

| 参数名        | 类型     | 必填   | 说明            |
| ---------- | ------ | ---- | ------------- |
| depot_lock | String | 是    | 是否锁；0：解锁；1：上锁 |
#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
|      |      |      |      |





###盘点单详情 
```url
[GET]/drug_service/business/inventory/{inventory_id}
```
####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |
| V1.3.9.2 | 药品信息可以修改 已发生的业务数据在单据中保持不变；后台用冗余的方式；   |

#### PathVariable

| 参数名          | 类型     | 必填   | 说明    |
| ------------ | ------ | ---- | ----- |
| inventory_id | String | 是    | 盘点单ID |

#### 回复报文参数

| 参数名             | 类型         | 必填   | 说明                    |
| --------------- | ---------- | ---- | --------------------- |
| inventory_id    | String     | 是    | 盘点单ID                 |
| inventory_no    | String     | 是    | 盘点单号，如：PD201804030001 |
| inventory_type  | Integer    | 是    | 盘点类型：月度盘点             |
| depot_name      | String     | 是    | 盘点仓库：仓库1              |
| make_time       | String     | 是    | 盘点日期：20180417         |
| make_user       | String     | 是    | 盘点人：施秋梅               |
| state           | Integer    | 否    | 盘点状态                  |
| inventory_rem   | String     | 否    | 备注：看有盈亏再算账            |
| inventory_items | ObjectList | 否    | 盘点药品列表                |
###### 盘点药品列表

| 参数名                | 类型      | 必填   | 说明                  |
| ------------------ | ------- | ---- | ------------------- |
| item_id            | String  | 是    | 盘点细目id              |
| drug_name          | String  | 是    | 药品名                 |
| drug_spec          | String  | 是    | 药品规格                |
| drug_pack_spec     | String  | 是    | 药品包装规格              |
| supplier           | String  | 是    | 供应商名称               |
| factory            | String  | 是    | 生产厂家名称              |
| batch_no           | String  | 是    | 产品批号                |
| validity           | String  | 是    | 有效期                 |
| stock_num_str      | String  | 是    | 账面库存：库存包装数量+库存拆分数量  |
| packnum            | Integer | 是    | 库存包装数量              |
| pack_unit          | String  | 是    | 包装单位                |
| splitnum           | Integer | 是    | 库存拆分数量              |
| split_unit         | String  | 是    | 拆分单位 如:片            |
| real_num_str       | String  | 是    | 实际库存：实际包装数量+实际拆分数量  |
| item_real_packnum  | Integer | 是    | 实际包装数量              |
| item_real_splitnum | Integer | 是    | 实际拆分数量              |
| item_totle         | Integer | 是    | 成本盈亏金额，单位分          |
| item_differ        | Integer | 是    | 库存差量（只显示几盒或几片的值）    |
| split_count        | Integer | 是    | 一个包装单位可拆分数量         |
| pack_split         | Integer | 是    | 拆分标志   0-不拆分;1-支持拆分 |
| pack_split_price   | Double  | 是    | 拆分价格                |
| pack_last_bidprice | Double  | 是    | 最近入库价（单价 单位元）       |



### 药品盘点单保存

```url
[POST]/drug_service/business/inventory/
```

说明：
1. 到目前为止，都只有新增的保存。暂时没有修改
2. 只有锁盘的仓库才能进行盘点。
3. 调整库存，完成出库单的生成。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |
| V1.3.9.2 | 药品信息更改，追加冗余字段：药品名 药品规格 包装规格 生产厂家  |

#### 影响的表

药品盘点表(drug_depot_inventory)
药品盘点子表(drug_depot_inventoryitem)

#### 请求报文参数

#### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

#### PathVariable

| 参数名          | 类型   | 必填   | 说明                |
| ------------ | ---- | ---- | ----------------- |
| inventory_id | Long | 否    | 盘点单ID，有时为修改，没时为新增 |

##### RequestBody

| 参数名             | 类型         | 必填   | 说明                                     |
| --------------- | ---------- | ---- | -------------------------------------- |
| inventory_type  | Intger     | 是    | 盘点类型,默认:0;0:临时盘点;1:季度盘点;2:半年盘点;3:年终盘点; |
| depot_id        | Long       | 是    | 盘点药房                                   |
| inventory_rem   | String     | 否    | 备注（128位）                               |
| inventory_items | ObjectList | 是    | 盘点药品列表                                 |



 盘点药品列表

| 参数名           | 类型      | 必填   | 说明       |
| ------------- | ------- | ---- | -------- |
| packspec_id   | Long    | 是    | 药品包装规格ID |
| validity      | String  | 是    | 有效期      |
| batch_no      | String  | 是    | 产品批号     |
| packnum       | Integer | 否    | 库存包装数量   |
| splitnum      | Integer | 否    | 库存拆分数量   |
| real_packnum  | Integer | 否    | 实际包装数量   |
| real_splitnum | Integer | 否    | 实际拆分数量   |

#### 回复报文参数

| 参数名          | 类型     | 必填   | 说明    |
| ------------ | ------ | ---- | ----- |
| inventory_id | Long   | 是    | 盘点单ID |
| inventory_no | String | 是    | 盘点单号  |



### 药品盘点单确认

```url
[POST]/drug_service/business/inventory/confirm/{inventory_id}
```

说明：

两种情况：
1.新增后直接确认
2.打开原有保存后的盘点单进销确认

1. 只有未完成或未作废的盘点单才允许修改。
2. 只有锁盘的仓库才能进行盘点。
3. 调整库存，完成出库单的生成。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |
| V1.3.9.2 | 药品信息更改，追加冗余字段：药品名 药品规格 包装规格 生产厂家  |

#### 影响的表

药品盘点表(drug_depot_inventory)
药品盘点子表(drug_depot_inventoryitem)

#### 请求报文参数

#### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

#### PathVariable

| 参数名          | 类型   | 必填   | 说明                |
| ------------ | ---- | ---- | ----------------- |
| inventory_id | Long | 否    | 盘点单ID，有时为修改，没时为新增 |

##### RequestBody

| 参数名             | 类型         | 必填   | 说明                                     |
| --------------- | ---------- | ---- | -------------------------------------- |
| inventory_type  | Intger     | 是    | 盘点类型,默认:0;0:临时盘点;1:季度盘点;2:半年盘点;3:年终盘点; |
| depot_id        | Long       | 是    | 盘点药房                                   |
| inventory_rem   | String     | 否    | 备注（128位）                               |
| inventory_items | ObjectList | 是    | 盘点药品列表                                 |


 盘点药品列表

| 参数名           | 类型      | 必填   | 说明                                |
| ------------- | ------- | ---- | --------------------------------- |
| item_id       | Long    | 否    | 盘点单子ID,空时指新增一个盘点的药品，不为空时更新原来的盘点药品 |
| packspec_id   | Long    | 是    | 药品包装规格ID                          |
| batch_no      | String  | 否    | 产品批号                              |
| validity      | String  | 是    | 有效期                               |
| packnum       | Integer | 是    | 库存包装数量                            |
| splitnum      | Integer | 是    | 库存拆分数量                            |
| real_packnum  | Integer | 是    | 实际包装数量                            |
| real_splitnum | Integer | 是    | 实际拆分数量                            |
| totle         | Integer | 是    | 成本盈亏金额，单位分                        |

#### 回复报文参数

| 参数名          | 类型     | 必填   | 说明    |
| ------------ | ------ | ---- | ----- |
| inventory_id | Long   | 是    | 盘点单ID |
| inventory_no | String | 是    | 盘点单号  |





### 盘点单作废

```url
[POST]/drug_service/business/inventory/cancel/{inventory_id}
```

说明：


#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品盘点表(drug_depot_inventory)

#### 请求报文参数

#### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

#### PathVariable

| 参数名          | 类型   | 必填   | 说明    |
| ------------ | ---- | ---- | ----- |
| inventory_id | Long | 是    | 盘点单ID |

#### 回复报文参数

| 参数名          | 类型   | 必填   | 说明    |
| ------------ | ---- | ---- | ----- |
| inventory_id | Long | 是    | 盘点单ID |


### 盘点单删除

```url
[DELETE]/drug_service/business/inventory/{inventory_id}
```

说明：

1.盘点中盘点单不允许删除

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品盘点表(drug_depot_inventory)

#### 请求报文参数

#### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

#### PathVariable

| 参数名          | 类型   | 必填   | 说明    |
| ------------ | ---- | ---- | ----- |
| inventory_id | Long | 是    | 盘点单ID |

#### 回复报文参数

| 参数名          | 类型   | 必填   | 说明    |
| ------------ | ---- | ---- | ----- |
| inventory_id | Long | 是    | 盘点单ID |



### 药品盘点单完成盘点协议

```url
[POST]/drug_service/business/inventory/finish/{inve_id}
```

说明：
1. 只有未完成或未作废的盘点单才允许完成。
2. 只有锁盘的仓库才能进行操作。
3. 调整库存，完成出库单的生成。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

药品盘点表(drug_depot_inventory)

#### 请求报文参数

#### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

#### PathVariable

| 参数名          | 类型   | 必填   | 说明    |
| ------------ | ---- | ---- | ----- |
| inventory_id | Long | 是    | 盘点单ID |


#### 回复报文参数

| 参数名          | 类型     | 必填   | 说明    |
| ------------ | ------ | ---- | ----- |
| inventory_id | Long   | 是    | 盘点单ID |
| inventory_no | String | 是    | 盘点单号  |


##药品发药


###发/退药列表
```url
[GET]/drug_service/business/dispense/list
```

   待发药的列表，待退药的列表，已发药的列表，已退药的列表都用该协议


####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |
| V1.3.9.4 | 新增   |

#### 请求报文参数

#### RequestBody

| 参数名           | 类型      | 必填   | 说明                                     |
| ------------- | ------- | ---- | -------------------------------------- |
| key           | String  | 否    | 搜索关键字                                  |
| dispense_type | String  | 是    | 选择类型 1:未发药（待发药） 2:已发药 3:未退药（待退药） 4:已退药 |
| page_size     | Integer | 否    | 每页条数 空表示10条                            |
| page_num      | Integer | 否    | 第几页 空表示第1页                             |

#### 回复报文参数

| 参数名       | 类型         | 必填   | 说明      |
| --------- | ---------- | ---- | ------- |
| page_num  | Integer    | 是    | 当前页     |
| page_size | Integer    | 是    | 每页的数量   |
| total     | Integer    | 是    | 总记录数    |
| pages     | Integer    | 是    | 总页数     |
| list      | ObjectList | 是    | 待发/退药集合 |



##### 待发/退药集合说明

| 参数名            | 类型      | 必填   | 说明                             |
| -------------- | ------- | ---- | ------------------------------ |
| pres_id        | String  | 是    | 处方id                           |
| patient_id     | String  | 是    | 患者id                           |
| patient_name   | String  | 是    | 患者姓名                           |
| patient_age    | String  | 是    | 患者年龄                           |
| patient_gender | Integer | 是    | 患者性别   性别代码 0 未知 1男  2 女       |
| visi_time      | String  | 是    | 就诊时间                           |
| state   | Integer  | 是    | 状态 1待发药    2 已发药  3待退药  4:已退药   5待发药已退费 |


###待发药信息详情

```url
[GET]/drug_service/business/dispense/{pres_id}
```

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |



#### 回复报文参数

| 参数名               | 类型         | 必填   | 说明                             |
| ----------------- | ---------- | ---- | ------------------------------ |
| pres_id           | String     | 是    | 处方id                           |
| patient_id        | String     | 是    | 患者id                           |
| patient_name      | String     | 是    | 患者姓名                           |
| patient_age       | String     | 是    | 患者年龄                           |
| patient_gender    | String     | 是    | 患者性别                           |
| patient_phone     | String     | 是    | 患者手机号                          |
| visi_no           | String     | 是    | 接诊号                            |
| visi_time         | String     | 是    | 接诊时间                           |
| visi_depa         | String     | 是    | 接诊科室                           |
| visi_doctor       | String     | 是    | 接诊医生                           |
| diagnose          | String     | 是    | 诊断                             |
| allergic          | String     | 否    | 过敏史 没有返回空                      |
| prescription_attr | Integer    | 是    | 处方属性 0:普通处方(该版本只支持普通处方)        |
| state   | Integer  | 是    | 状态 1待发药    2 已发药  3待退药  4:已退药   5待发药已退费 |
| prescription_list | ObjectList | 是    | 处方信息                           |



##### prescription_info  处方信息

| 参数名                | 类型      | 必填   | 说明                         |
| ------------------ | ------- | ---- | -------------------------- |
| order_id            | String  | 是    | 医嘱id                       |
| drug_id            | String  | 是    | 药品id                       |
| drug_name          | String  | 是    | 药品名称                       |
| prescription_type  | Integer | 是    | 处方类型 0:西药                  |
| drug_spec_str      | String  | 是    | 药品规格字符串 如5mg/片             |
| drug_factory       | String  | 是    | 药品生产厂商                     |
| pack_spec_id       | String  | 是    | 包装规格id                     |
| pack_spec_str      | String  | 是    | 包装规格字符串 如5片/盒              |
| drug_adminis_route | String  | 是    | 用法 1-口服;    2-注射;    3-外用; |
| drug_dosage        | String  | 是    | 单次使用计量 例如:1粒               |
| drug_frequency     | String  | 是    | 频次                         |
| drug_total_amount  | String  | 是    | 处方数量                       |
| drug_charge        | String  | 是    | 金额（元）                      |
| drug_memo          | String  | 否    | 备注                         |
| drug_state         | Integer | 是    | 发药状态 1:未发药;2:已发药;3:待退药;4:已退药              |



###已发药信息详情

```url
[GET]/drug_service/business/dispense/already/{pres_id}
```

待退药和已退药也用该信息


####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |



#### 回复报文参数

| 参数名               | 类型         | 必填   | 说明                             |
| ----------------- | ---------- | ---- | ------------------------------ |
| pres_id           | String     | 是    | 处方id                           |
| patient_id        | String     | 是    | 患者id                           |
| patient_name      | String     | 是    | 患者姓名                           |
| patient_age       | String     | 是    | 患者年龄                           |
| patient_gender    | String     | 是    | 患者性别                           |
| patient_phone     | String     | 是    | 患者手机号                          |
| visi_no           | String     | 是    | 接诊号                            |
| visi_time         | String     | 是    | 接诊时间                           |
| visi_depa         | String     | 是    | 接诊科室                           |
| visi_doctor       | String     | 是    | 接诊医生                           |
| diagnose          | String     | 是    | 诊断                             |
| allergic          | String     | 否    | 过敏史 没有返回空                      |
| prescription_attr | Integer    | 是    | 处方属性 0:普通处方(该版本只支持普通处方)        |
| dispense_user     | String     | 否    | 发药人                            |
| dispense_time     | String     | 否    | 发药时间                           |
| applyrefund_time  | String     | 否    | 申请退药时间                         |
| applyrefund_user  | String     | 否    | 申请退药医生                         |
| return_user     | String     | 否    | 退药人                            |
| state   | Integer  | 是    | 状态 1待发药    2 已发药  3待退药  4:已退药   5待发药已退费 |
| prescription_list | ObjectList | 是    | 处方信息                           |



##### prescription_info  处方信息

| 参数名                | 类型      | 必填   | 说明                         |
| ------------------ | ------- | ---- | -------------------------- |
| drug_id            | String  | 是    | 药品id                       |
| drug_name          | String  | 是    | 药品名称                       |
| prescription_type  | Integer | 是    | 处方类型 0:西药                  |
| drug_spec_str      | String  | 是    | 药品规格字符串 如5mg/片             |
| drug_factory       | String  | 是    | 药品生产厂商                     |
| pack_spec_id       | String  | 是    | 包装规格id                     |
| pack_spec_str      | String  | 是    | 包装规格字符串 如5片/盒              |
| drug_total_amount  | String  | 是    | 处方数量                       |
| drug_adminis_route | String  | 是    | 用法 1-口服;    2-注射;    3-外用; |
| drug_dosage        | String  | 是    | 单次使用计量 例如:1粒               |
| drug_frequency     | String  | 是    | 频次                         |
| drug_days     | Integer  | 是    | 用药天数                         |
| batch_list  | ObjectList  | 是    | 批号列表                       |

批号列表说明

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| batch_no      | String | 是    | 产品批号   |
| validity      | String | 是    | 有效期    |
| drug_depot    | String | 是    | 发药药房名称 |
| drug_num      | String | 是    | 发药数量 包含单位  如 1盒   ， 1盒5片 |
| state      | Integer | 是    | 发药状态 2 已发药  3待退药  4:退药成功   |
| return_date      | String | 是    | 退药时间  yyyy-mm-dd hh:mm:ss  |


###获取下一个待发药

```url
[GET]/drug_service/business/dispense/next
```

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数



| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |



#### 回复报文参数

| 参数名               | 类型         | 必填   | 说明                             |
| ----------------- | ---------- | ---- | ------------------------------ |
| next_pres_id           | String     | 是    | 处方id  |

没有下一个抛出异常


###系统发药预览

```url
[GET]/drug_service/business/dispense/sys_dispense_preview
```

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |
| V1.3.9.4 | 新增 1、全部冻结时：已缴费处于待发药状态的药品不显示。2、单批次冻结时：发药管理-发药页不出现该批次的药品信息；（1.3.9.4追加）  |

#### 请求报文参数


| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |

#### 回复报文参数(ObjectList)

| 参数名           | 类型         | 必填   | 说明             |
| ------------- | ---------- | ---- | -------------- |
| order_id      | String     | 是    | 医嘱id           |
| drug_name     | String     | 是    | 药品名称           |
| pack_spec_id  | String     | 是    | 包装规格id         |
| drug_spec_str | String     | 是    | 药品规格字符串 如5mg/片 |
| drug_factory  | String     | 是    | 药品生产厂商         |
| pack_spec_str | String     | 是    | 包装规格字符串 如5片/盒  |
| drug_amount   | Integer    | 是    | 处方数量           |
| unit          | String     | 是    | 处方单位           |
| batch_list    | ObjectList | 是    | 发药批次           |


##### batch_list  发药批次

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| batch_no      | String | 是    | 产品批号   |
| validity      | String | 是    | 有效期    |
| drug_depot_id | String | 是    | 发药药房id |
| drug_depot    | String | 是    | 发药药房名称 |
| drug_num      | String | 是    | 发药数量   |

加单位

###手工发药预览

```url
[GET]/drug_service/business/dispense/hand_dispense_preview
```

####修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |
| V1.3.9.4 | 新增 1、全部冻结时：已缴费处于待发药状态的药品不显示。2、单批次冻结时：发药管理-发药页不出现该批次的药品信息；（1.3.9.4追加）  |

#### 请求报文参数

#### RequestBody

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |

#### 回复报文参数(ObjectList)

| 参数名           | 类型         | 必填   | 说明             |
| ------------- | ---------- | ---- | -------------- |
| order_id      | String     | 是    | 医嘱id           |
| drug_name     | String     | 是    | 药品名称           |
| pack_spec_id  | String     | 是    | 包装规格id         |
| drug_spec_str | String     | 是    | 药品规格字符串 如5mg/片 |
| drug_factory  | String     | 是    | 药品生产厂商         |
| pack_spec_str | String     | 是    | 包装规格字符串 如5片/盒  |
| drug_amount   | Integer    | 是    | 处方数量           |
| unit          | String     | 是    | 处方单位           |
| batch_list    | ObjectList | 是    | 发药批次           |


##### batch_list  发药批次

| 参数名           | 类型     | 必填   | 说明            |
| ------------- | ------ | ---- | ------------- |
| batch_no      | String | 是    | 产品批号          |
| validity      | String | 是    | 有效期           |
| drug_depot_id | String | 是    | 发药药房id        |
| drug_depot    | String | 是    | 发药药房名称        |
| drug_price    | Double | 是    | 最近入库价         |
| stock_num_str | String | 是    | 当前库存 例如 10盒1片 |



### 药房药品处方发药协议

```url
[POST]/drug_service/business/dispense/{pres_id}
```

说明：
1. 只有已经收费的且未发药的处方才可以发药。
2. 锁库时不允许操作。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

医嘱处方主表(emr_orde_prescription)
药房库存表(drug_stock)
药品库存表(drug_stock_all)
药品出入库单表(drug_inout_bill) 
药品出入库单子表(drug_inout_billitem) 

#### 请求报文

##### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

##### PathVariable

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| pres_id | Long | 是    | 处方ID |

##### RequestBody

ObjectList 结构

| 参数名        | 类型         | 必填   | 说明   |
| ---------- | ---------- | ---- | ---- |
| order_id   | Long       | 是    | 医嘱ID |
| stoc_infos | ObjectList | 是    | 出库调用 |

##### 出库调用信息

| 参数名      | 类型      | 必填   | 说明     |
| -------- | ------- | ---- | ------ |
| depot_id | Long    | 是    | 药房药库ID |
| batch_no | String  | 是    | 产品批号   |
| drug_num | Integer | 是    | 数量     |


#### 回复报文参数

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| pres_id | Long | 是    | 处方ID |



###退药预览

```url
[GET]/drug_service/business/dispense/refund/preview/{pres_id}
```

#### 修改更新记录

| 对应版本   | 说明   |
| ------ | ---- |
| V1.3.2 | 新增   |

#### 请求报文参数

#### PathVariable

| 参数名     | 类型     | 必填   | 说明   |
| ------- | ------ | ---- | ---- |
| pres_id | String | 是    | 处方id |

#### 回复报文参数ObjectList

| 参数名           | 类型         | 必填   | 说明             |
| ------------- | ---------- | ---- | -------------- |
| pres_id       | String     | 是    | 处方id           |
| drug_id       | String     | 是    | 药物id           |
| drug_name     | String     | 是    | 药物名称           |
| drug_spec_str | String     | 是    | 药品规格字符串 如5mg/片 |
| drug_factory  | String     | 是    | 药物生产厂商         |
| pack_spec_id  | String     | 是    | 包装规格id         |
| pack_spec_str | String     | 是    | 包装规格字符串 如5片/盒  |
| drug_amount   | String     | 是    | 处方数量           |
| batch_list    | ObjectList | 是    | 发药批次           |


##### batch_list  发药批次

| 参数名           | 类型     | 必填   | 说明     |
| ------------- | ------ | ---- | ------ |
| batch_no      | String | 是    | 产品批号   |
| validity      | String | 是    | 有效期    |
| drug_depot    | String | 是    | 发药药房名称 |
| drug_depot_id | String | 是    | 发药药房id |
| drug_price    | Double | 是    | 处方价    |
| drug_num      | String | 是    | 退药数量   |



### 药房药品处方退药

```url
[POST]/drug_service/business/refund/{pres_id}
```

说明：
1. 只有待退费，未退药的处方才可以进行退药。
2. 锁库时不允许操作。

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.2 | 新增   |

#### 影响的表

医嘱处方主表(emr_orde_prescription)
药房库存表(drug_stock)
药品库存表(drug_stock_all)
药品出入库单表(drug_inout_bill) 
药品出入库单子表(drug_inout_billitem) 

#### 请求报文

##### RequestHeader

| 参数名                 | 类型   | 必填   | 说明                 |
| ------------------- | ---- | ---- | ------------------ |
| Env.HEAD_TENANT_KEY | Long | 是    | 租户ID，实现值是：tenantId |

##### PathVariable

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| pres_id | Long | 是    | 处方ID |

#### 回复报文参数

| 参数名     | 类型   | 必填   | 说明   |
| ------- | ---- | ---- | ---- |
| pres_id | Long | 是    | 处方ID |


##药品厂商 

### 药品厂商列表  

> [GET]/drug_service/opto/fact/list


####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增 增加证件过期到期提醒时间 |

#### 请求报文参数

| 参数名        | 类型      | 必填   | 说明                        |
| ---------- | ------- | ---- | ------------------------- |
| key        | String  | 否    | 关键字                       |
| mfr_enable | Integer | 否    | 是否有效 0：停用1：有效  传空全部       |
| mfr_type   | Integer | 否    | 厂商类型    1:供应商;2:生产商; 传空全部 |
| page_size  | Integer | 否    | 每页条数 空表示10条               |
| page_num   | Integer | 否    | 第几页 空表示第1页                |

#### 回复报文参数Object

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| page_num  | Integer    | 是    | 当前页    |
| page_size | Integer    | 是    | 每页的数量  |
| total     | Integer    | 是    | 总记录数   |
| pages     | Integer    | 是    | 总页数    |
| list      | ObjectList | 否    | 药品厂商列表 |

药品厂商列表说明

| 参数名          | 类型      | 必填   | 说明                          |
| ------------ | ------- | ---- | --------------------------- |
| mfr_id       | String  | 是    | 厂商ID                        |
| mfr_code     | String  | 是    | 厂商编码                        |
| mfr_name     | String  | 是    | 厂商名称                        |
| mfr_type     | Integer | 是    | 厂商类型  1:供应商;2:生产商;3:供应商入生产商 |
| mfr_enable   | Integer | 是    | 是否有效 0：停用1：有效               |
| expire_state | Integer | 是    | 过期状态 0：正常 1即将到期 2已经过期       |



### 药品厂商——基本信息保存

> [POST]/drug_service/opto/fact/base

####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增 增加证件过期到期提醒时间 |


#### 请求报文参数

| 参数名                          | 类型      | 必填   | 说明                         |
| ---------------------------- | ------- | ---- | -------------------------- |
| mfr_code                     | String  | 是    | 厂商编码                       |
| mfr_name                     | String  | 是    | 厂商名称                       |
| mfr_type                     | Integer | 是    | 厂商类型 1:供应商;2:生产商;3:供应商入生产商 |
| mfr_enable                   | Integer | 是    | 是否有效 0：停用1：有效              |
| mfr_taxrate                  | Integer | 否    | 税率                         |
| mfr_area_code                | String  | 否    | 地市区代码                      |
| mfr_compaddress              | String  | 否    | 公司详细地址                     |
| mfr_remind_time              | Integer | 否    | 证件有效期到期时间             单位天  |
| mfr_biz_licence_code         | String  | 否    | 工商营业执照号                    |
| mfr_biz_licence_validity_str | String  | 否    | 工商营业执照有效期                  |
| mfr_biz_licence_photo        | String  | 否    | 工商营业执照照片，文件资源ID            |
| mfr_licence_code             | String  | 否    | 医疗器械经营许可证号                 |
| mfr_licence_validity_str     | String  | 否    | 医疗器械经营许可证有效期               |
| mfr_licence_photo            | String  | 否    | 医疗器械经营许可证照片，文件资源ID         |
| mfr_production               | String  | 否    | 医疗器械生产许可证号                 |
| mfr_produ_validity_str       | String  | 否    | 医疗器械生产许可证有效期               |
| mfr_produ_photo              | String  | 否    | 医疗器械生产许可证证照片，文件资源ID        |

#### 回复报文参数

| 参数名    | 类型     | 必填   | 说明   |
| ------ | ------ | ---- | ---- |
| mfr_id | String | 是    | 厂商ID |



###药品厂商——基本信息修改

> [POST]/drug_service/opto/fact/base/update

需要把
`mfr_biz_licence_expire` '工商营业执照有效期到期提醒标志,默认:0;0:未提醒;1:已提醒;',
  `mfr_biz_licence_overdue`  '工商营业执照有效期过期提醒标志,默认:0;0:未提醒;1:已提醒;',
  `mfr_licence_expire`  '医疗器械经营许可证有效期到期提醒标志,默认:0;0:未提醒;1:已提醒;',
  `mfr_licence_overdue`  '医疗器械经营许可证有效期过期提醒标志,默认:0;0:未提醒;1:已提醒;',
  `mfr_production_expire`  '医疗器械生产许可证有效期到期提醒标志,默认:0;0:未提醒;1:已提醒;',
  `mfr_production_overdue`  '医疗器械生产许可证有效期过期提醒标志,默认:0;0:未提醒;1:已提醒;',
都改为 0 未提醒

####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增 增加证件过期到期提醒时间 |

#### 请求报文参数

| 参数名                          | 类型      | 必填   | 说明                        |
| ---------------------------- | ------- | ---- | ------------------------- |
| mfr_id                       | String  | 是    | 厂商ID                      |
| mfr_code                     | String  | 是    | 厂商编码                      |
| mfr_name                     | String  | 是    | 厂商名称                      |
| mfr_type                     | Integer | 是    | 厂商类型  1:供应商;2:生产商;        |
| mfr_enable                   | Integer | 是    | 是否有效 0：停用1：有效             |
| mfr_taxrate                  | Integer | 否    | 税率                        |
| mfr_area_code                | String  | 否    | 地市区代码                     |
| mfr_compaddress              | String  | 否    | 公司详细地址                    |
| mfr_remind_time              | Integer | 否    | 证件有效期到期时间             单位天 |
| mfr_biz_licence_code         | String  | 否    | 工商营业执照号                   |
| mfr_biz_licence_validity_str | String  | 否    | 工商营业执照有效期                 |
| mfr_biz_licence_photo        | String  | 否    | 工商营业执照照片，文件资源ID           |
| mfr_licence_code             | String  | 否    | 医疗器械经营许可证号                |
| mfr_licence_validity_str     | String  | 否    | 医疗器械经营许可证有效期              |
| mfr_licence_photo            | String  | 否    | 医疗器械经营许可证照片，文件资源ID        |
| mfr_production               | String  | 否    | 医疗器械生产许可证号                |
| mfr_produ_validity_str       | String  | 否    | 医疗器械生产许可证有效期              |
| mfr_produ_photo              | String  | 否    | 医疗器械生产许可证证照片，文件资源ID       |

#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
|      |      |      |      |


### 药品厂商获取

> [GET]/drug_service/opto/fact



####修改更新记录

| 对应版本   | 说明              |
| ------ | --------------- |
| V1.3.3 | 新增 增加证件过期到期提醒时间 |

#### 请求报文参数

| 参数名    | 类型     | 必填   | 说明   |
| ------ | ------ | ---- | ---- |
| mfr_id | String | 是    | 厂商ID |


#### 回复报文参数

| 参数名                          | 类型         | 必填   | 说明                        |
| ---------------------------- | ---------- | ---- | ------------------------- |
| mfr_code                     | String     | 是    | 厂商编码                      |
| mfr_name                     | String     | 是    | 厂商名称                      |
| mfr_type                     | Integer    | 是    | 厂商类型  1:供应商;2:生产商;        |
| mfr_enable                   | Integer    | 是    | 是否有效 0：停用1：有效             |
| mfr_taxrate                  | Integer    | 否    | 税率 3 17 0                 |
| mfr_prov_code                | String     | 否    | 省代码                       |
| mfr_city_code                | String     | 否    | 市代码                       |
| mfr_coun_code                | String     | 否    | 区代码                       |
| mfr_compaddress              | String     | 否    | 公司详细地址                    |
| mfr_taxno                    | String     | 否    | 税号                        |
| mfr_address                  | String     | 否    | 单位地址                      |
| mfr_tel                      | String     | 否    | 公司电话                      |
| mfr_bank                     | String     | 否    | 开户行                       |
| mfr_bankcard                 | String     | 否    | 账号                        |
| mfr_remind_time              | Integer    | 否    | 证件有效期到期时间             单位天 |
| mfr_biz_licence_code         | String     | 否    | 工商营业执照号                   |
| mfr_biz_licence_validity_str | String     | 否    | 工商营业执照有效期                 |
| mfr_biz_licence_validity_state | String     | 否    | 工商营业执照有效期状态  0正常 1即将到期 2已经过期 |
| mfr_biz_licence_photo        | String     | 否    | 工商营业执照照片，文件资源ID           |
| mfr_biz_licence_photo_url    | String     | 否    | 工商营业执照照片url路径             |
| mfr_licence_code             | String     | 否    | 医疗器械经营许可证号                |
| mfr_licence_validity_str     | String     | 否    | 医疗器械经营许可证有效期              |
| mfr_licence_validity_state     | String     | 否    | 医疗器械经营许可证有效期状态  0正常 1即将到期 2已经过期 |
| mfr_licence_photo            | String     | 否    | 医疗器械经营许可证照片，文件资源ID        |
| mfr_licence_photo_url        | String     | 否    | 医疗器械经营许可证照片url路径          |
| mfr_production               | String     | 否    | 医疗器械生产许可证号                |
| mfr_produ_validity_str       | String     | 否    | 医疗器械生产许可证有效期              |
| mfr_produ_validity_state       | String     | 否    | 医疗器械生产许可证有效期状态  0正常 1即将到期 2已经过期 |
| mfr_produ_photo              | String     | 否    | 医疗器械生产许可证证照片，文件资源ID       |
| mfr_produ_photo_url          | String     | 否    | 医疗器械生产许可证证照片url路径         |
| list                         | ObjectList | 否    | 联系人列表                     |

联系人列表说明

| 参数名            | 类型     | 必填   | 说明    |
| -------------- | ------ | ---- | ----- |
| link_id        | String | 否    | 联系人ID |
| link_man       | String | 是    | 联系人   |
| link_prov_code | String | 否    | 省代码   |
| link_city_code | String | 否    | 市代码   |
| link_coun_code | String | 否    | 区代码   |
| link_address   | String | 否    | 详细地址  |
| link_tel       | String | 否    | 联系电话  |
| link_phone     | String | 否    | 手机号码  |
| link_fax       | String | 否    | 传真    |
| link_email     | String | 否    | 邮箱    |
| link_rem       | String | 否    | 备注    |


