#公共协议

登录，登出等公共协议的设计

## 协议一览表

| 名称     | 地址与操作                      | 描述   |
| ------ | -------------------------- | ---- |
| 用户登录   | [POST]/authent/login       |      |
| 租户令牌登录 | [POST]/authent/token/login |      |


##协议内容

### 租户用户登录

> [POST]/authent/login

#### 修改更新记录

|  对应版本  | 说明 |
|------------|------|
| V1.3.3 | 修改 增加是否有新消息 |

#### 请求报文参数

| 参数名       | 类型     | 必填   | 说明             |
| --------- | ------ | ---- | -------------- |
| account   | String | 是    | 账号，可以是手机号码、工号等 |
| password  | String | 是    | 密码             |
| auth_id   | String | 否    | 验证码id          |
| auth_code | String | 否    | 验证码            |

header中填写

| 参数名        | 类型     | 必填   | 说明                 |
| ---------- | ------ | ---- | ------------------ |
| tenantId   | Long   | 是    | 租户号                |
| os         | String | 是    | 客户端操作系统，包含操作系统与版本号 |
| device     | String | 是    | 当前设备名称，如iOS的手机设备名称 |
| user_agent | String | 是    | 浏览器 类型             |

#### 回复报文参数

| 参数名             | 类型         | 必填   | 说明              |
| --------------- | ---------- | ---- | --------------- |
| fail_times      | Integer    | 是    | 登录失败次数          |
| token           | String     | 是    | 令牌，用于标志用户登录的有效性 |
| user_id         | String     | 是    | 用户唯一id          |
| name            | String     | 是    | 用户姓名            |
| tenant_name     | String     | 是    | 租户名称            |
| view_bidprice     | Integer     | 是    | 是否有查看进价权限 0无1有            |
| new_msg     | Integer     | 是    | 是否有新消息 0无1有            |
| reso_list       | ObjectList | 是    | 资源列表            |
| work_list       | ObjectList | 是    | 工作站列表           |
| depot_list      | ObjectList | 是    | 管理仓库列表          |
| sale_depot_list | ObjectList | 是    | 销售仓库列表          |
| opto_list       | LongList   | 是    | 处方列表            |
| account_list       | ObjectList   | 是    | 收费账号列表            |



工作站列表说明

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| work_id   | Integer    | 是    | 工作站ID  |
| work_code | String     | 是    | 工作站代码  |
| work_name | String     | 是    | 工作站名称  |
| func_list | ObjectList | 是    | 功能权限列表 |

功能权限列表说明

| 参数名         | 类型      | 必填   | 说明       |
| ----------- | ------- | ---- | -------- |
| func_id     | Long    | 是    | 模块功能ID   |
| func_code   | String  | 是    | 功能代码     |
| func_name   | String  | 是    | 模块功能名称   |
| func_module | Integer | 是    | 模块还是功能标志 |
| func_parent | Long    | 否    | 父级模块ID   |

科室列表说明

| 参数名       | 类型      | 必填   | 说明                         |
| --------- | ------- | ---- | -------------------------- |
| reso_id   | String  | 是    | 资源ID                       |
| reso_type | Integer | 是    | 支撑的资源类型(1-科室；2-设备；3-柜台与仓库) |
| reso_name | String  | 是    | 资源名称                       |

管理仓库或销售仓库列表说明

| 参数名           | 类型      | 必填   | 说明                |
| ------------- | ------- | ---- | ----------------- |
| depo_id       | String  | 是    | 仓库id              |
| depo_name     | String  | 是    | 仓库名称              |
| depo_purchase | Integer | 是    | 是否允许采购入库 ;0:否;1:是 |
| depo_sell     | Integer | 是    | 是否允许销售 ;0:否;1:是   |



收费账号列表说明

| 参数名           | 类型      | 必填   | 说明                |
| ------------- | ------- | ---- | ----------------- |
| account_id       | String  | 是    | 账号id              |
| account_name     | String  | 是    | 账号名称              |

 

### 租户令牌登录

> [POST]/authent/token/login

#### 修改更新记录

|  对应版本  | 说明 |
|------------|------|
| V1.3.3 | 修改 增加是否有新消息 |

#### 请求报文参数

| 参数名      | 类型     | 必填   | 说明              |
| -------- | ------ | ---- | --------------- |
| tenantId | Long   | 是    | 租户号             |
| token    | String | 是    | 令牌，用于标志用户登录的有效性 |

#### 回复报文参数

| 参数名             | 类型         | 必填   | 说明              |
| --------------- | ---------- | ---- | --------------- |
| token           | String     | 是    | 令牌，用于标志用户登录的有效性 |
| user_id         | String     | 是    | 用户唯一id          |
| name            | String     | 是    | 用户姓名            |
| tenant_name     | String     | 是    | 租户名称            |
| view_bidprice     | Integer     | 是    | 是否有查看进价权限 0无1有            |
| new_msg     | Integer     | 是    | 是否有新消息 0无1有            |
| reso_list       | ObjectList | 是    | 资源列表            |
| work_list       | ObjectList | 是    | 工作站列表           |
| depot_list      | ObjectList | 是    | 管理仓库列表          |
| sale_depot_list | ObjectList | 是    | 销售仓库列表          |
| opto_list       | LongList   | 是    | 处方列表            |
| account_list       | ObjectList   | 是    | 收费账号列表            |

工作站列表说明

| 参数名       | 类型         | 必填   | 说明     |
| --------- | ---------- | ---- | ------ |
| work_id   | Integer    | 是    | 工作站ID  |
| work_code | String     | 是    | 工作站代码  |
| work_name | String     | 是    | 工作站名称  |
| func_list | ObjectList | 是    | 功能权限列表 |

功能权限列表说明

| 参数名         | 类型      | 必填   | 说明       |
| ----------- | ------- | ---- | -------- |
| func_id     | Long    | 是    | 模块功能ID   |
| func_code   | String  | 是    | 功能代码     |
| func_name   | String  | 是    | 模块功能名称   |
| func_module | Integer | 是    | 模块还是功能标志 |
| func_parent | Long    | 否    | 父级模块ID   |

科室列表说明

| 参数名       | 类型      | 必填   | 说明                         |
| --------- | ------- | ---- | -------------------------- |
| reso_id   | String  | 是    | 资源ID                       |
| reso_type | Integer | 是    | 支撑的资源类型(1-科室；2-设备；3-柜台与仓库) |
| reso_name | String  | 是    | 资源名称                       |

管理仓库或销售仓库列表说明

| 参数名           | 类型      | 必填   | 说明                |
| ------------- | ------- | ---- | ----------------- |
| depo_id       | String  | 是    | 仓库id              |
| depo_name     | String  | 是    | 仓库名称              |
| depo_purchase | Integer | 是    | 是否允许采购入库 ;0:否;1:是 |
| depo_sell     | Integer | 是    | 是否允许销售 ;0:否;1:是   |



收费账号列表说明

| 参数名           | 类型      | 必填   | 说明                |
| ------------- | ------- | ---- | ----------------- |
| account_id       | String  | 是    | 账号id              |
| account_name     | String  | 是    | 账号名称              |

### 租户用户登出

> [POST]/logout

#### 请求报文参数

| 参数名   | 类型     | 必填   | 说明              |
| ----- | ------ | ---- | --------------- |
| token | String | 是    | 令牌，用于标志用户登录的有效性 |

#### 回复报文参数

| 参数名  | 类型   | 必填   | 说明   |
| ---- | ---- | ---- | ---- |
| 无    |      |      |      |



### 平台管理用户登录

> [POST]/platform/authent/login

#### 请求报文参数

| 参数名      | 类型     | 必填   | 说明             |
| -------- | ------ | ---- | -------------- |
| account  | String | 是    | 账号，可以是手机号码、工号等 |
| password | String | 是    | 密码             |

header中填写

| 参数名        | 类型     | 必填   | 说明                 |
| ---------- | ------ | ---- | ------------------ |
| tenantId   | Long   | 是    | 租户号                |
| os         | String | 是    | 客户端操作系统，包含操作系统与版本号 |
| device     | String | 是    | 当前设备名称，如iOS的手机设备名称 |
| user_agent | String | 是    | 浏览器 类型             |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明              |
| ---------- | ------ | ---- | --------------- |
| token      | String | 是    | 令牌，用于标志用户登录的有效性 |
| user_id    | String | 是    | 用户唯一id          |
| name       | String | 是    | 用户姓名            |
| job_number | String | 是    | 工号              |



### 上传图片

```http
[POST]/tenant_service/tenant/upload_picture
```

#### 请求报文参数

|     参数名     |  类型  | 必填 |                    说明                   |
|----------------|--------|------|-------------------------------------------|
| file_size      | Long   | 否   | 文件内容长度                              |
| file_extension | String | 是   | 文件扩展名(不带“.“)                       |
| file_type      | String | 是   | 文件类型，Content-Type                    |
| file_signature | String | 否   | 文件的签名值MD5,Base64编码                |
| work_id        | Long   | 否   | 工作站ID，用户在哪个工作站中上传的        |
| factory_id     | String | 否   | 厂商id                                    |
| business_id    | String | 否   | 业务标志，意义由上传类型确定；9时为商品ID 10时为运营机构ID |
| source_type    | Integer| 是   | 上传类型 1:logo;</br>2:法人身份证正面;</br>3.法人身份证背面;</br>4:营业执照;</br>5.用户头像</br>6.医生签名</br>7.厂商营业执照</br>8.厂商生产许可证；</br>9.商品目录注册证号文件 </br>10.微信支付支付用证书    </br> 11:租户用户批量导入上传文件;
 </br>12-厂商表的工商营业执照号照片文件; |


### 官网租户试用申请

```url
[POST]/tenant_service/website/tenant_trial_application
```

#### 修改更新记录

|  对应版本  | 说明 |
|------------|------|
| BOSSV1.0.2 | 新增 |

#### 请求报文参数

##### RequestHeader


|  参数名  |  类型  | 必填 |   说明  |
|----------|--------|------|---------|
| tenantId | String | 是   | 固定值0 |

##### RequestBody

|       参数名       |   类型  | 必填 |                                  说明                                  |
|--------------------|---------|------|------------------------------------------------------------------------|
| appl_name          | String  | 是   | 机构名称                                                               |
| appl_linkman_name  | String  | 是   | 联系人                                                                 |
| appl_linkman_phone | String  | 是   | 联系人手机                                                             |
| appl_type          | Integer | 是   | 机构类型;1-集团；2-集团下属医院；3-独立专科医院；4-眼科诊所;5-综合医院 |
| appl_message       | String  | 否   | 留言信息                                                               |

#### 回复报文参数

| 参数名  |  类型  | 必填 |  说明  |
|---------|--------|------|--------|
| appl_id | String | 是   | 申请ID |

### 用户心跳状态协议

```url
[POST]/sys_service/user/keep_alive
```

说明:
1. 当token已经失效时返回错误。
2. 请务必每个token间隔一分钟就调用本接口一次。
3. 实现时请在redis使用hash结构进行数据的维护:
    key使用的是 UserKeepAlive, 
    hashkey 使用令牌，
    hashValue是一个json结构的字段串，串内以用户登录记录表的数据为主，再加上接收到本次心跳请求的时间

#### 修改更新记录

|    对应业务    | 说明 |
|----------------|------|
| WEBV1.3.1.1 | 新增 |


##### RequestHeader

|   参数名   |  类型  | 必填 |        说明        |
|------------|--------|------|--------------------|
| tenant_id  | Long   | 是   | 租户ID             |
| token      | String | 是   | 令牌               |
| client_ip  | String | 是   | 登录时的客户端IP   |
| user_agent | String | 否   | 浏览器的User-Agent |
| os         | String | 否   | 操作系统           |
| device     | String | 否   | 设备               |

#### 请求报文参数
|   参数名   |  类型  | 必填 |        说明        |
|------------|--------|------|--------------------|
|   无   |   |  |               |


#### 回复报文参数

|    参数名     |   类型  | 必填 |        说明        |
|---------------|---------|------|--------------------|
| tenant_id     | String  | 是   | 租户ID             |
| user_id       | String  | 是   | 用户ID             |
| survival_time | Integer | 是   | 已存活时间，单位秒 |

### 获取版本号协议

```url
[POST]/sys_service/version/get
```

#### 修改更新记录

|    对应业务    | 说明 |
|----------------|------|
| BOSS1.0.3 | 新增 |

#### 请求报文参数
|   参数名   |  类型  | 必填 |        说明        |
|------------|--------|------|--------------------|
|   无   |   |  |               |


#### 回复报文参数（String）

版本号内容