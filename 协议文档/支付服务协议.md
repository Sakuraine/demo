# 第三方收费系统协议

## 基本信息

端口号：14006
RedisDB：4

## 协议内容

### 微信H5支付

```http
[POST]/gtpay/wechat/h5pay
```

说明：
1. 微信H5的支付

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.6 | 新增   |

#### 影响的表


#### 请求报文参数

| 参数名          | 类型      | 必填   | 说明           |
| ------------ | ------- | ---- | ------------ |
| chargeId     | Long    | 是    | 收费单ID        |
| agencyId     | Long    | 是    | 运营机构         |
| tenantId     | Long    | 是    | 租户id         |
| userId       | Long    | 是    | 用户ID         |
| isSupportCre | Boolean | 是    | 是否支持信用卡      |
| wapUrl       | String  | 是    | 网站URL地址/外网地址 |
| wapName      | String  | 是    | WAP 网站名      |

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |



### 微信公众号统一下单

```http
[POST]/gtpay/wechat/pubpay
```

说明：
1. 微信公众号统一下单

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.6 | 新增   |

#### 影响的表


#### 请求报文参数

| 参数名       | 类型     | 必填   | 说明                              |
| --------- | ------ | ---- | ------------------------------- |
| chargeId  | Long   | 是    | 收费单ID                           |
| agencyId  | Long   | 是    | 运营机构                            |
| tenantId  | Long   | 是    | 租户id                            |
| userId    | Long   | 是    | 用户ID                            |
| tradeType | enum   | 是    | 微信支付类型，分别有JSAPI，NATIVE，APP，MWEB |
| openId    | String | 是    | 用户与公众号间的标识                      |
| clientIp  | String | 是    | 客户端ip                           |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明                                 |
| ---------- | ------ | ---- | :--------------------------------- |
| isSuccess  | String | 是    | 消息                                 |
| tradeType  | enum   | 是    | 支付状态                               |
| prepayId   | String | 是    | 微信生成的预支付会话标识，用于后续接口调用中使用，该值有效期为2小时 |
| outTradeNo | String | 是    | 商户订单号                              |
| errorCode  | String | 是    | 错误码                                |
| errorMsg   | String | 是    | 错误信息                               |
| nonceStr   | Stirng | 是    | 随机字符串                              |
| signType   | String | 是    | 签名方式                               |


### 微信支付签名获取

```http
[POST]/gtpay/wechat/paysign
```

说明：
1. 微信支付签名获取（可以用于js-sdk,app支付）

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.6 | 新增   |

#### 影响的表


#### 请求报文参数

| 参数名       | 类型      | 必填   | 说明                              |
| --------- | ------- | ---- | ------------------------------- |
| agencyId  | Long    | 是    | 运营机构                            |
| tenantId  | Long    | 是    | 租户id                            |
| appId     | Long    | 是    | 公众号id                           |
| timeStamp | Boolean | 是    | 时间戳，秒级                          |
| nonceStr  | String  | 是    | 随机字符串                           |
| prepayId  | String  | 是    | 微信生成的预支付会话标识                    |
| signType  | String  | 是    | 签名类型                            |
| tradeType | enum    | 是    | 微信支付类型，分别有JSAPI，NATIVE，APP，MWEB |

#### 回复报文参数

| 参数名     | 类型     | 必填   | 说明        |
| ------- | ------ | ---- | :-------- |
| paySign | String | 是    | 生成用于支付的签名 |


### 微信支付结果查询

```http
[POST]/gtpay/wechat/paysuccess
```

说明：
1. 微信支付结果查询，成功去更新结算单的状态

#### 修改更新记录

| 对应业务      | 说明   |
| --------- | ---- |
| WEBV1.3.6 | 新增   |

#### 影响的表


#### 请求报文参数

| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构  |
| tenantId | Long   | 是    | 租户id  |
| tradNo   | String | 否    | 支付订单号 |
| chargeId | Long   | 是    | 结算单ID |
| userId   | Long   | 是    | 用户ID  |

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
| tradeNo         | String | 是    | 内部订单号 交易订单号           |
| outTradeNo      | String | 是    | 外部订单号                 |
| tradeStatus     | String | 是    | String类型的原生交易状态       |
| totalAmount     | String | 是    | 总金额                   |
| sendPayDate     | Date   | 是    | 支付时间                  |
| buyerUserId     | String | 是    | 支付宝为买家帐号，微信为订单购买人id   |
| buyerLogonId    | String | 是    | 买家在支付宝的用户id 微信为openid |
| tradeQueryState | enum   | 是    | 交易状态                  |
| memo            | String | 是    | 备注                    |


### 微信扫手机码付款

```http
[POST]/gtpay/wechat/qrpay
```
#### 请求报文参数

| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| out_trade_no | Long   | 是    | 结算单ID  |
| qr_code | String   | 是    | 条码  |
| subject   | String | 否    | 结算单标题 |
| timeout_express | String   | 否    | 超时时间 |
| amount   | Long   | 是    | 结算单金额（分）  |
| agencyId | Long   | 是    | 运营机构  |
| tenantId | Long   | 是    | 租户id  |
| fee_earners | Long   | 是    | 用户ID  |
| tenantId | Long   | 是    | 租户id  |
|paytradeno|String | 是|内部订单号 交易订单号 |
|channel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
| pay_state         | Integer | 是    | 支付状态         |
| trade_no      | String | 是    | 内部订单号 交易订单号                 |
| buyer_user     | String | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id       |
| express_time     | String | 是    | 超时时间                   |
| buyer_logon_id     | String   | 是    | 买家在支付宝的用户id 微信为openid         |
| message    | String | 是    | 信息 |
| pay_success_time | Long   | 是    | 支付成功时的时间，单位秒                 |


###验证微信支付信息

```http
[GET]/gtpay/whchat/verifyWXPayInfo/{agencyId}
```

#### 请求报文参数
#####RequestHeader
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
|          | Boolean | 是    | 验证成功与否         |


###操作验证微信的回调信息

```http
[POST]/gtpay/whchat/checkWXCallbackData
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| data | Map   | 是    | 回调object中的map  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
|          | String | 是    | 验证结果，示例：<xml><return_code><![CDATA[FAIL]]></return_code><return_msg><![CDATA[验签失败]]></return_msg></xml>          |


###通知支付服务，租户的微信公从号及支付信息发送变更

```http
[POST]/gtpay/whchat/flushTenantConfigure
```

#### 请求报文参数
#####RequestHeader
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |

###微信扫码付

```http
[POST]/gtpay/whchat/tradeQRPay
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| qrCode | String   | 是    | 条码  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
| userId | Long   | 是    | 操作人Id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |

###微信退款

```http
[POST]/gtpay/whchat/tradeRefund
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
| userId | Long   | 是    | 操作人Id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |


###微信退款直接？

```http
[POST]/gtpay/whchat/tradeRefundDirect
```
说明：
上面是自己查单据，这里已经有单据直接退款，个人理解。。。

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| WxTradeNo| String   | 是    | 交易渠道订单号  |
| RefundFee| Long   | 是    | 退费金额（分）  |
| ChargeFee| Long   | 是    | 收费金额（分）  |
| chargeId | Long   | 是    | 收费结算单ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| refundCharid | Long   | 是    | 退费结算单针对的收费结算单id  |
| userId | Long   | 是    | 患者ID  |

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |

###微信退款信息查询

```http
[GET]/gtpay/whchat/tradeRefundQuery/{chargeId}/{agencyId}
```

#### 请求报文参数
#####RequestHeader
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |
| chargeId | Long   | 是    | 收费结算单ID  |

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| code            | String  | 是    | 返回结果                          |
| msg            | String  | 是    | 消息                          |
| tradeNo     | String  | 是    | 内部交易单号                       |
| outTradeNo     | String  | 是    | 外部对应订单号                       |
| outRequestNo     | String  | 是    | 退款标识                       |
| refundReason | String | 是    | 退款原因                        |
| totalAmount    | String  | 是    | 订单金额 |
| refundAmount   | String  | 是    | 退款金额   |
| refoundState | enum    | 是    | 退款状态，SUCCESS,退款成功，REFUNDCLOSE,退款关闭，PROCESSING,退款处理中，CHANGE，退款异常     |

###微信订单交易查询

```http
[GET]/gtpay/whchat/tradeQuery/{chargeId}/{agencyId}/{tradePaychannel}
```

#### 请求报文参数
#####RequestHeader
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |
| chargeId | Long   | 是    | 收费结算单ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| tradeNo         | String | 是    | 内部订单号 交易订单号           |
| outTradeNo      | String | 是    | 外部订单号                 |
| tradeStatus     | String | 是    | String类型的原生交易状态       |
| totalAmount     | String | 是    | 总金额                   |
| sendPayDate     | Date   | 是    | 支付时间                  |
| buyerUserId     | String | 是    | 支付宝为买家帐号，微信为订单购买人id   |
| buyerLogonId    | String | 是    | 买家在支付宝的用户id 微信为openid |
| tradeQueryState | enum   | 是    | 交易状态                  |
| memo            | String | 是    | 备注                    |


###微信订单撤销

```http
[POST]/gtpay/whchat/tradeCancel
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| userId | Long   | 是    | 患者ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
|           | Boolean  | 是    | 成功与否                          |

###微信订单关闭

```http
[POST]/gtpay/whchat/tradeClose
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| userId | Long   | 是    | 患者ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
|           | Boolean  | 是    | 成功与否                          |

##支付宝相关接口

### 支付宝扫手机码付款

```http
[POST]/gtpay/alipay/qrpay
```
#### 请求报文参数

| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| out_trade_no | Long   | 是    | 结算单ID  |
| qr_code | String   | 是    | 条码  |
| subject   | String | 否    | 结算单标题 |
| timeout_express | String   | 否    | 超时时间 |
| amount   | Long   | 是    | 结算单金额（分）  |
| agencyId | Long   | 是    | 运营机构  |
| tenantId | Long   | 是    | 租户id  |
| fee_earners | Long   | 是    | 用户ID  |
| tenantId | Long   | 是    | 租户id  |
|paytradeno|String | 是|内部订单号 交易订单号 |
|channel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
| pay_state         | Integer | 是    | 支付状态         |
| trade_no      | String | 是    | 内部订单号 交易订单号                 |
| buyer_user     | String | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id       |
| express_time     | String | 是    | 超时时间                   |
| buyer_logon_id     | String   | 是    | 买家在支付宝的用户id 微信为openid         |
| message    | String | 是    | 信息 |
| pay_success_time | Long   | 是    | 支付成功时的时间，单位秒                 |

### 支付宝手机网页支付

```http
[POST]/gtpay/alipay/wappay
```

说明:
1. 本接口不会进行结算单相关数据库操作，在调用本操作时请保证完成结算单与收费单的状态维护。
2. 本接口要求存储与支付宝通讯的数据记录，方便追溯。
3. 本接口会返回进行后续操作的表单数据，并不是完成了支付操作。

#### 请求报文参数

| 参数名          | 类型      | 必填   | 说明           |
| ------------ | ------- | ---- | ------------ |
| out_trade_no     | String    | 是    | 外部订单号        |
| subject     | String    | 是    | 支付标题         |
| body     | String    | 是    | 支付内容        |
| timeout_express       | String    | 否    | 超时时间         |
| amount | Long | 是    | 金额      |
| agency_id | Long   | 是    | 运营机构  |
| tenant_id | Long   | 是    | 租户id  |
| quit_url       | String  | 是    | 点击取消支付后跳转的页面 |
| result_url      | String  | 是    | 完成支付后跳转的页面      |

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| body            | String  | 是    | 返回内容                          |

###验证支付宝信息

```http
[GET]/gtpay/alipay/verifyAliPayInfo/{agencyId}
```

#### 请求报文参数
#####RequestHeader
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
|          | Boolean | 是    | 验证成功与否         |


###检查支付宝回调通知

```http
[POST]/gtpay/alipay/checkNotifySign
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| callBackMap | Map   | 是    | 回调返回的map  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
|          | String | 是    | 验证结果，示例：<xml><return_code><![CDATA[FAIL]]></return_code><return_msg><![CDATA[验签失败]]></return_msg></xml>          |


###创建支付接口

```http
[POST]/gtpay/alipay/tradeCreate
```

#### 请求报文参数

| 参数名       | 类型     | 必填   | 说明                              |
| --------- | ------ | ---- | ------------------------------- |
| tenantId  | Long   | 是    | 租户id                            |
| chargeId  | Long   | 是    | 收费单ID                           |
| agencyId  | Long   | 是    | 运营机构                            |
| userId    | Long   | 是    | 用户ID                            |
| buyerId    | String | 是    | 买家id                      |

#### 回复报文参数

| 参数名        | 类型     | 必填   | 说明                                 |
| ---------- | ------ | ---- | :--------------------------------- |
| isSuccess  | boolean | 是    | 标志位                                 |
| tradeType  | enum   | 是    | 支付状态                               |
| prepayId   | String | 是    | 微信生成的预支付会话标识，用于后续接口调用中使用，该值有效期为2小时 |
| tradeNo | String | 是    | 内部订单号                              |
| outTradeNo | String | 是    | 商户订单号                              |
| Url | String | 是    | 当为Navite时为二维码链接，当h5时，是跳转链接                              |
| errorCode  | String | 是    | 错误码                                |
| errorMsg   | String | 是    | 错误信息                               |
| nonceStr   | Stirng | 是    | 随机字符串                              |
| signType   | String | 是    | 签名方式                               |


###当租户的支付宝信息修改后需要通知该接口

```http
[GET]/gtpay/alipay/flushTenantConfigure/{agencyId}
```

#### 请求报文参数
#####PathVariable
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| agencyId | Long   | 是    | 运营机构ID  |

###条码支付接口

```http
[POST]/gtpay/alipay/tradeQRPay
```
要点：
1.支付场景 条码支付，取值：bar_code 声波支付，取值：wave_code    (目前只支持条码支付)所以此处默认为条码支付
2.如有需要可提供增加参数(商品描述/该笔订单允许的最晚付款时间/支付场景)等参数

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| qrCode | String   | 是    | 条码  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
| userId | Long   | 是    | 操作人Id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态  1/授权支付成功2/已发起支付，待支付3/支付失败4/未知异常                      |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |

###退款接口

```http
[POST]/gtpay/alipay/tradeRefund
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| agencyId | Long   | 是    | 运营机构ID  |
| tenantId | Long   | 是    | 租户id  |
| userId | Long   | 是    | 操作人Id  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |


###支付宝退款直接

```http
[POST]/gtpay/alipay/tradeRefundDirect
```
说明：
上面是自己查单据，这里已经有单据直接退款

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 退费结算单id  |
| amount| Long   | 是    | 退费金额（分）  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| userId | Long   | 是    | 患者ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|
| refundCharid | Long   | 是    | 退费结算单针对的收费结算单id  |

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| msg            | String  | 是    | 消息                          |
| payResultState | Integer | 是    | 支付状态                        |
| buyerUserId    | String  | 是    | 买家支付宝账号 微信退款时该字段为空 去获取支付人id |
| buyerLogonId   | String  | 是    | 买家在支付宝的用户id 微信为openid       |
| paytradeno     | String  | 是    | 交易订单号                       |
| paySuccessTime | Long    | 是    | 支付成功时的时间，单位秒                |

###退款查询接口

```http
[GET]/gtpay/alipay/tradeRefundQuery
```

#### 请求报文参数
#####RequestParam
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| chargeId | Long   | 是    | 收费结算单ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
| code            | String  | 是    | 返回结果                          |
| msg            | String  | 是    | 消息                          |
| tradeNo     | String  | 是    | 内部交易单号                       |
| outTradeNo     | String  | 是    | 外部对应订单号                       |
| outRequestNo     | String  | 是    | 退款标识                       |
| refundReason | String | 是    | 退款原因                        |
| totalAmount    | String  | 是    | 订单金额 |
| refundAmount   | String  | 是    | 退款金额   |
| refoundState | enum    | 是    | 退款状态，SUCCESS,退款成功，REFUNDCLOSE,退款关闭，PROCESSING,退款处理中，CHANGE，退款异常     |


###订单撤销

```http
[POST]/gtpay/alipay/tradeCancel
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| userId | Long   | 是    | 患者ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
|           | Boolean  | 是    | 成功与否                          |

###订单关闭

```http
[POST]/gtpay/alipay/tradeClose
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
| userId | Long   | 是    | 患者ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名            | 类型      | 必填   | 说明                          |
| -------------- | ------- | ---- | :-------------------------- |
|           | Boolean  | 是    | 成功与否                          |


###统一收单线下交易查询

```http
[POST]/gtpay/alipay/tradeQuery
```

#### 请求报文参数
| 参数名      | 类型     | 必填   | 说明    |
| -------- | ------ | ---- | ----- |
| chargeId | Long   | 是    | 收费结算单ID  |
| tenantId | Long   | 是    | 租户id  |
| agencyId | Long   | 是    | 运营机构ID  |
|tradePaychannel| enum | 是| 收费通道，有Cash，Hospital，AliPayPCWeb，AliPayPhoneWeb，AliPayPhoneQR，AliPayDynamicQR，BankCard，WechPayPhoneQR|

#### 回复报文参数

| 参数名             | 类型     | 必填   | 说明                    |
| --------------- | ------ | ---- | :-------------------- |
| tradeNo         | String | 是    | 内部订单号 交易订单号           |
| outTradeNo      | String | 是    | 外部订单号                 |
| tradeStatus     | String | 是    | String类型的原生交易状态       |
| totalAmount     | String | 是    | 总金额                   |
| sendPayDate     | Date   | 是    | 支付时间                  |
| buyerUserId     | String | 是    | 支付宝为买家帐号，微信为订单购买人id   |
| buyerLogonId    | String | 是    | 买家在支付宝的用户id 微信为openid |
| tradeQueryState | enum   | 是    | 交易状态                  |
| memo            | String | 是    | 备注                    |  |